   1:			;
   2:			;
   3:			; Z80 Nuova Elettronica Monitor 390 su eprom 2532 (4k)
   4:			;
   5:			; Disassemblato e ricostruito da Piergiorgio Betti <pbetti@lpconsul.net>
   6:			; 2005 01 26
   7:			
   8:			
   9:			; Defines for the i/o ports
  10:			;
  11:			; *** LX529 VIDEO BOARD:
  12:	0080          	CRTBASE		equ	$80
  13:				; RAM0 for ascii chars & semi6. Combined with RAM1 and RAM2 for graphics
  14:	0080          	CRTRAM0DAT	equ	CRTBASE		; RAM0 access: PIO0 port A data register
  15:	0082          	CRTRAM0CNT	equ	CRTBASE+2	; RAM0 access: PIO0 port A control register
  16:				; Printer port
  17:	0081          	CRTPRNTDAT	equ	CRTBASE+1	; PRINTER (output): PIO0 port B data register
  18:	0083          	CRTPRNTCNT	equ	CRTBASE+3	; PRINTER (output): PIO0 port B control register
  19:								; STROBE is generated by hardware
  20:				; RAM1 for graphics. (pixel index by RAM0+RAM1+RAM2)
  21:	0084          	CRTRAM1DAT	equ	CRTBASE+4	; RAM1 access: PIO1 port A data register
  22:	0086          	CRTRAM1CNT	equ	CRTBASE+6	; RAM1 access: PIO1 port A control register
  23:				; Keyboard port (negated). Bit 7 is for strobe
  24:	0085          	CRTKEYBDAT	equ	CRTBASE+5	; KEYBOARD (input): PIO1 port B data register
  25:	0087          	CRTKEYBCNT	equ	CRTBASE+7	; KEYBOARD (input): PIO1 port B control register
  26:	0007          	KEYBSTRBBIT	equ	7		; Strobe bit
  27:				; RAM2 for graphics. (pixel index by RAM0+RAM1+RAM2)
  28:	0088          	CRTRAM2DAT	equ	CRTBASE+8	; RAM2 access: PIO2 port A data register
  29:	008A          	CRTRAM2CNT	equ	CRTBASE+10	; RAM2 access: PIO2 port A control register
  30:				; Service/User port
  31:	0089          	CRTSERVDAT	equ	CRTBASE+9	; Service (i/o): PIO2 port B data register
  32:	008B          	CRTSERVCNT	equ	CRTBASE+11	; Service (i/o): PIO2 port B control register
  33:	0000          	PRNTBUSYBIT	equ	0		; Printer BUSY bit
  34:	0001          	CRTWIDTHBIT	equ	1		; Set 40/80 chars per line
  35:								; Other bits available to user
  36:				; RAM3 control chars/graphics attributes
  37:	008E          	CRTRAM3PORT	equ	CRTBASE+14	; RAM3 port
  38:	0000          	CRTBLINKBIT	equ	0		; Blink
  39:	0001          	CRTREVRSBIT	equ	1		; Reverse
  40:	0002          	CRTUNDERBIT	equ	2		; Underline
  41:	0003          	CRTHILITBIT	equ	3		; Highlight
  42:	0004          	CRTMODEBIT	equ	4		; ASCII/GRAPHIC mode
  43:				; Beeper port
  44:	008F          	CRTBEEPPORT	equ	CRTBASE+15	; Beeper port
  45:				; 6545 CRT controller ports
  46:	008C          	CRT6545ADST	equ	CRTBASE+12	; Address & Status register
  47:	008D          	CRT6545DATA	equ	CRTBASE+13	; Data register
  48:			;
  49:			; *** LX390 FDC CONTROLLER:
  50:	00D0          	FDCBASE	equ	$d0
  51:	00D0          	FDCCMDSTATR	equ	FDCBASE		; Command and status register
  52:	00D1          	FDCTRAKREG	equ	FDCBASE+1	; Track register
  53:	00D2          	FDCSECTREG	equ	FDCBASE+2	; Sector register
  54:	00D7          	FDCDATAREG	equ	FDCBASE+7	; Data register *** Verificare che sia $d7
  55:	00D6          	FDCDRVRCNT	equ	FDCBASE+6	; Driver select/control register
  56:	0080          	FSECLEN		equ	$80		; 128 bytes sector
  57:	80D7          	FRWWORD		equ	((FSECLEN * $100) + FDCDATAREG) ; $80d7 in other words
  58:			;
  59:			; alternate printer port
  60:	0003          	ALTPRNPRT	equ	$03
  61:			; Ram addresses labels
  62:	0026          	KBDBYTE		equ	$0026
  63:	0027          	CIOBYTE		equ	$0027
  64:	0029          	COLBUF		equ	$0029
  65:	0028          	RAM3BUF		equ	$0028
  66:	002A          	RAM0BUF		equ	$002a
  67:	002B          	RAM1BUF		equ	$002b
  68:	002C          	RAM2BUF		equ	$002c
  69:	0047          	MIOBYTE		equ	$0047
  70:	0048          	CURPBUF		equ	$0048
  71:	0049          	CURPBUFH	equ	$0049
  72:	3040          	GRAM0BUF	equ	$3040
  73:	3041          	GRAM1BUF	equ	$3041
  74:	3042          	GRAM2BUF	equ	$3042
  75:	3043          	GRAM3BUF	equ	$3043
  76:	0010          	CRTTABUF	equ	$0010
  77:	0043          	FCMDBUF		equ	$0043
  78:	0044          	FSTABUF		equ	$0044
  79:	004A          	FTRKBUF		equ	$004a
  80:	0045          	FRDPBUF		equ	$0045
  81:	0042          	FSECBUF		equ	$0042
  82:	0040          	FDRVBUF		equ	$0040
  83:	0041          	FNTRBUF		equ	$0041
  84:			
  85:			;
  86:			; aliases
  87:	FC39          	IOCACK		equ	INICRTCUR
  88:	FC75          	IOCVT		equ	CHOME
  89:	FC86          	IOCFF		equ	CLRSCR
  90:	FCD6          	IOCSI		equ	CLREOL
  91:	FCFF          	IOCDC1		equ	RESATTR
  92:	FD9B          	IOCDC4		equ	LINDN
  93:			
  94:	F000          		org $f000
  95:			
  96:	F000  C330F6  	JBOOT:	jp     BOOT            ; 00F000 C3 30 F6	- BOOT
  97:	F003  C366F8  	JCONIN:	jp     CONIN           ; 00F003 C3 66 F8	- WBOOT
  98:	F006  C310FB  	JCONOU:	jp     CONOUT           ; 00F006 C3 10 FB	- CONST
  99:	F009  C3C2F4  	JMTRK0:	jp     MTRAK0           ; 00F009 C3 C2 F4	- CONIN
 100:	F00C  C398F4  	JCURTR:	jp     ICURTRBUF           ; 00F00C C3 98 F4	- CONOUT
 101:	F00F  C389F4  	JNXTTR:	jp     INXTTRBUF           ; 00F00F C3 89 F4	- LIST
 102:	F012  C38EF4  	JSECBF:	jp     SAVSECBUF           ; 00F012 C3 8E F4	- PUNCH
 103:	F015  C393F4  	JREADB:	jp     INIRDPBUF           ; 00F015 C3 93 F4	- READER
 104:	F018  C30DF5  	JREADS:	jp     FREADSEC           ; 00F018 C3 0D F5	- HOME
 105:	F01B  C314F5  	JWRITS:	jp     FWRITSEC           ; 00F01B C3 14 F5	- SELDSK
 106:	F01E  C3AFF4  	JFSTAT:	jp     GFDCSTAT           ; 00F01E C3 AF F4	- SETTRK
 107:	F021  C39DF4  	JFDCMD:	jp     SFDCCMD           ; 00F021 C3 9D F4	- SETSEC
 108:	F024  C3B9F4  	JTRKOF:	jp     FTRKOFF           ; 00F024 C3 B9 F4	- SETDMA
 109:	F027  C3DCF4  	JFSEEK:	jp     FSEEK           ; 00F027 C3 DC F4	- READ
 110:	F02A  C350F4  	JDRVSL:	jp     DRVSEL           ; 00F02A C3 50 F4	- WRITE
 111:	F02D  C36CFE  	JDISPN:	jp     DISPNORTR           ; 00F02D C3 6C FE	- LISTST
 112:	F030  C3FDF6  	JUSRCM:	jp     UCREJ           ; 00F030 C3 FD F6	- SECTRAN
 113:			;; Questi *DOVREBBERO* essere i 17 entry point del CPM
 114:			;; ... ma non lo sono....
 115:	F033  C361F4  	JCPMBO:	jp     CPMBOOT           ; 00F033 C3 61 F4
 116:	F036  C3DEF6  	JGETHN:	jp     GETHNUM           ; 00F036 C3 DE F6
 117:	F039  C3B9FA  	JCHKKB:	jp     CHKKBD           ; 00F039 C3 B9 FA
 118:	F03C  C375FA  	JPRNCH:	jp     PRNCHR           ; 00F03C C3 75 FA
 119:	F03F  C3C0FF  		jp     $ffc0           ; 00F03F C3 C0 FF
 120:	F042  00      		nop                    ; 00F042 00
 121:	F043  00      		nop                    ; 00F043 00
 122:			;;
 123:			;; DISPGR - Display a full graphic char frpm GRAMBUF
 124:			;
 125:	F044          	DISPGR:
 126:	F044  DB8C    		in     a,(CRT6545ADST)         ; 00F044 DB 8C
 127:	F046  CB7F    		bit    7,a             ; 00F046 CB 7F
 128:	F048  28FA    		jr     z,DISPGR         ; 00F048 28 FA
 129:	F04A  214030  		ld     hl,GRAM0BUF        ; 00F04A 21 40 30
 130:	F04D  7E      		ld     a,(hl)          ; 00F04D 7E
 131:	F04E  D380    		out    (CRTRAM0DAT),a         ; 00F04E D3 80
 132:	F050  23      		inc    hl              ; 00F050 23
 133:	F051  7E      		ld     a,(hl)          ; 00F051 7E
 134:	F052  D384    		out    (CRTRAM1DAT),a         ; 00F052 D3 84
 135:	F054  23      		inc    hl              ; 00F054 23
 136:	F055  7E      		ld     a,(hl)          ; 00F055 7E
 137:	F056  D388    		out    (CRTRAM2DAT),a         ; 00F056 D3 88
 138:	F058  23      		inc    hl              ; 00F058 23
 139:	F059  7E      		ld     a,(hl)          ; 00F059 7E
 140:	F05A  D38E    		out    (CRTRAM3PORT),a         ; 00F05A D3 8E
 141:	F05C  AF      		xor    a               ; 00F05C AF
 142:	F05D  D38D    		out    (CRT6545DATA),a         ; 00F05D D3 8D
 143:	F05F  C9      		ret                    ; 00F05F C9
 144:			;;
 145:			;; SET DISPLAY CURSOR ADDRESS EXTENDED
 146:			;; I'm unable to map 6545 (nor 6845) register $12 and $13
 147:			;; since register range is R0-R17 ($0-$11)
 148:			;
 149:	F060          	SDCUAE:
 150:	F060  3E0E    		ld     a,$0e           ; 00F060 3E 0E
 151:	F062  D38C    		out    (CRT6545ADST),a         ; 00F062 D3 8C
 152:	F064  7C      		ld     a,h             ; 00F064 7C
 153:	F065  D38D    		out    (CRT6545DATA),a         ; 00F065 D3 8D
 154:	F067  3E0F    		ld     a,$0f           ; 00F067 3E 0F
 155:	F069  D38C    		out    (CRT6545ADST),a         ; 00F069 D3 8C
 156:	F06B  7D      		ld     a,l             ; 00F06B 7D
 157:	F06C  D38D    		out    (CRT6545DATA),a         ; 00F06C D3 8D
 158:	F06E          	SDCUAE1:
 159:	F06E  3E12    		ld     a,$12           ; 00F06E 3E 12
 160:	F070  D38C    		out    (CRT6545ADST),a         ; 00F070 D3 8C
 161:	F072  7C      		ld     a,h             ; 00F072 7C
 162:	F073  D38D    		out    (CRT6545DATA),a         ; 00F073 D3 8D
 163:	F075  3E13    		ld     a,$13           ; 00F075 3E 13
 164:	F077  D38C    		out    (CRT6545ADST),a         ; 00F077 D3 8C
 165:	F079  7D      		ld     a,l             ; 00F079 7D
 166:	F07A  D38D    		out    (CRT6545DATA),a         ; 00F07A D3 8D
 167:	F07C  1808    		jr     CRTPRGEND           ; 00F07C 18 08
 168:			;;
 169:			;; SCUROF - turn off cursor
 170:			;
 171:	F07E          	SCUROF:	
 172:	F07E  3E0A    		ld     a,$0a           ; 00F07E 3E 0A
 173:	F080  D38C    		out    (CRT6545ADST),a         ; 00F080 D3 8C
 174:	F082  3E20    		ld     a,$20           ; 00F082 3E 20
 175:	F084  D38D    		out    (CRT6545DATA),a         ; 00F084 D3 8D
 176:			;;
 177:			;; CRTPRGEND
 178:			;; resets 6545 register pointer
 179:			;
 180:	F086          	CRTPRGEND:	
 181:	F086  3E1F    		ld     a,$1f           ; 00F086 3E 1F
 182:	F088  D38C    		out    (CRT6545ADST),a         ; 00F088 D3 8C
 183:	F08A  C9      		ret                    ; 00F08A C9
 184:			;;
 185:			;; SCURON - turn on cursor
 186:			;
 187:	F08B          	SCURON:
 188:	F08B  3E0A    		ld     a,$0a           ; 00F08B 3E 0A
 189:	F08D  D38C    		out    (CRT6545ADST),a         ; 00F08D D3 8C
 190:	F08F  AF      		xor    a               ; 00F08F AF
 191:	F090  D38D    		out    (CRT6545DATA),a         ; 00F090 D3 8D
 192:	F092  18F2    		jr     CRTPRGEND           ; 00F092 18 F2
 193:			;;
 194:			;; GETKBD - wait for a key and return in A
 195:			;
 196:	F094          	GETKBD:
 197:					; wait for strobe clean
 198:	F094  DB85    		in     a,(CRTKEYBDAT)         ; 00F094 DB 85
 199:	F096  2F      		cpl                    ; 00F096 2F
 200:	F097  CB7F    		bit    7,a             ; 00F097 CB 7F
 201:	F099  20F9    		jr     nz,GETKBD        ; 00F099 20 F9
 202:					; wait for keypress
 203:	F09B  DB85    	GKLP0:	in     a,(CRTKEYBDAT)         ; 00F09B DB 85
 204:	F09D  2F      		cpl                    ; 00F09D 2F
 205:	F09E  CB7F    		bit    7,a             ; 00F09E CB 7F
 206:	F0A0  28F9    		jr     z,GKLP0         ; 00F0A0 28 F9
 207:	F0A2  E67F    		and    $7f             ; 00F0A2 E6 7F
 208:	F0A4  C9      		ret                    ; 00F0A4 C9
 209:			;;
 210:			;; INICRT - should be 
 211:			;
 212:	F0A5          	INICRT:
 213:	F0A5  DB89    		in     a,(CRTSERVDAT)         ; 00F0A5 DB 89
 214:	F0A7  CB8F    		res    1,a             ; 00F0A7 Modo 40/80 colonne (80)
 215:	F0A9  21F5F2  		ld     hl,CRTTAB        ; 00F0A9 21 F5 F2
 216:	F0AC  D389    		out    (CRTSERVDAT),a         ; 00F0AC D3 89
 217:	F0AE  3E8F    		ld     a,$8f           ; 00F0AE 3E 8F
 218:	F0B0  D382    		out    (CRTRAM0CNT),a         ; 00F0B0 D3 82
 219:	F0B2  D386    		out    (CRTRAM1CNT),a         ; 00F0B2 D3 86
 220:	F0B4  D38A    		out    (CRTRAM2CNT),a         ; 00F0B4 D3 8A
 221:	F0B6  3ECF    		ld     a,$cf           ; 00F0B6 3E CF
 222:	F0B8  D383    		out    (CRTPRNTCNT),a         ; 00F0B8 D3 83
 223:	F0BA  08      		ex     af,af'          ; 00F0BA 08
 224:	F0BB  AF      		xor    a               ; 00F0BB AF
 225:	F0BC  D383    		out    (CRTPRNTCNT),a         ; 00F0BC D3 83
 226:	F0BE  08      		ex     af,af'          ; 00F0BE 08
 227:	F0BF  D387    		out    (CRTKEYBCNT),a         ; 00F0BF D3 87
 228:	F0C1  08      		ex     af,af'          ; 00F0C1 08
 229:	F0C2  3D      		dec    a               ; 00F0C2 3D
 230:	F0C3  D387    		out    (CRTKEYBCNT),a         ; 00F0C3 D3 87
 231:	F0C5  08      		ex     af,af'          ; 00F0C5 08
 232:	F0C6  D38B    		out    (CRTSERVCNT),a         ; 00F0C6 D3 8B
 233:	F0C8  3EF1    		ld     a,$f1           ; 00F0C8 3E F1
 234:	F0CA  D38B    		out    (CRTSERVCNT),a         ; 00F0CA D3 8B
 235:	F0CC          	SDRR11R0:
 236:	F0CC  060C    		ld     b,$0c           ; 00F0CC 06 0C
 237:	F0CE  78      	ICLP0:	ld     a,b             ; 00F0CE 78
 238:	F0CF  3D      		dec    a               ; 00F0CF 3D
 239:	F0D0  D38C    		out    (CRT6545ADST),a         ; 00F0D0 D3 8C
 240:	F0D2  7E      		ld     a,(hl)          ; 00F0D2 7E
 241:	F0D3  D38D    		out    (CRT6545DATA),a         ; 00F0D3 D3 8D
 242:	F0D5  23      		inc    hl              ; 00F0D5 23
 243:	F0D6  10F6    		djnz   ICLP0           ; 00F0D6 10 F6
 244:	F0D8          	RDRR19R12:
 245:	F0D8  0608    		ld     b,$08           ; 00F0D8 06 08
 246:	F0DA  78      	ICLP1:	ld     a,b             ; 00F0DA 78
 247:	F0DB  C60B    		add    a,$0b           ; 00F0DB C6 0B
 248:	F0DD  D38C    		out    (CRT6545ADST),a         ; 00F0DD D3 8C
 249:	F0DF  AF      		xor    a               ; 00F0DF AF
 250:	F0E0  D38D    		out    (CRT6545DATA),a         ; 00F0E0 D3 8D
 251:	F0E2  10F6    		djnz   ICLP1           ; 00F0E2 10 F6
 252:	F0E4  C386F0  		jp     CRTPRGEND           ; 00F0E4 C3 86 F0
 253:			;;
 254:			;; CLRSCRGR - Clear screen (80x24)
 255:			;
 256:	F0E7          	CLRSCRGR:
 257:	F0E7  CD7EF0  		call   SCUROF           ; 00F0E7 CD 7E F0
 258:	F0EA  212000  		ld     hl,$0020        ; 00F0EA 21 20 00
 259:	F0ED  224030  		ld     (GRAM0BUF),hl      ; 00F0ED 22 40 30
 260:	F0F0  2100FF  		ld     hl,$ff00        ; 00F0F0 21 00 FF
 261:	F0F3  224230  		ld     (GRAM2BUF),hl      ; 00F0F3 22 42 30
 262:	F0F6  CDD8F0  		call   RDRR19R12           ; 00F0F6 CD D8 F0
 263:	F0F9  210000  		ld     hl,$0000        ; 00F0F9 21 00 00
 264:	F0FC  3A4030  	CSGLP0:	ld     a,(GRAM0BUF)       ; 00F0FC 3A 40 30
 265:	F0FF  CD13F1  		call   DISPGRCH           ; 00F0FF CD 13 F1
 266:	F102  23      		inc    hl              ; 00F102 23
 267:	F103  7C      		ld     a,h             ; 00F103 7C
 268:	F104  FE07    		cp     $07             ; 00F104 FE 07
 269:	F106  20F4    		jr     nz,CSGLP0        ; 00F106 20 F4
 270:	F108  7D      		ld     a,l             ; 00F108 7D
 271:	F109  FE80    		cp     $80             ; 00F109 FE 80
 272:	F10B  20EF    		jr     nz,CSGLP0        ; 00F10B 20 EF
 273:	F10D  CDD8F0  		call   RDRR19R12           ; 00F10D CD D8 F0
 274:	F110  C38BF0  		jp     SCURON           ; 00F110 C3 8B F0
 275:			;;
 276:			;; DISPGRCH - Display a char (from A reg.) atrributed from GRAM3BUF 
 277:			;
 278:	F113          	DISPGRCH:
 279:	F113  F5      		push   af              ; 00F113 F5
 280:	F114  DB8C    	DGCLP0:	in     a,(CRT6545ADST)         ; 00F114 DB 8C
 281:	F116  CB7F    		bit    7,a             ; 00F116 CB 7F
 282:	F118  28FA    		jr     z,DGCLP0         ; 00F118 28 FA
 283:	F11A  F1      		pop    af              ; 00F11A F1
 284:	F11B  D380    		out    (CRTRAM0DAT),a         ; 00F11B D3 80
 285:	F11D  3A4330  		ld     a,(GRAM3BUF)       ; 00F11D 3A 43 30
 286:	F120  D38E    		out    (CRTRAM3PORT),a         ; 00F120 D3 8E
 287:	F122  AF      		xor    a               ; 00F122 AF
 288:	F123  D38D    		out    (CRT6545DATA),a         ; 00F123 D3 8D
 289:	F125  C9      		ret                    ; 00F125 C9
 290:			;;
 291:			;; FILVRAMG - Fill the video ram in graphic mode (from GRAMBUF)	
 292:			;
 293:	F126          	FILVRAMG:
 294:	F126  210000  		ld     hl,$0000        ; 00F126 21 00 00
 295:	F129  CDD8F0  		call   RDRR19R12           ; 00F129 CD D8 F0
 296:	F12C  E5      	FVLP0:	push   hl              ; 00F12C E5
 297:	F12D  CD44F0  		call   DISPGR           ; 00F12D CD 44 F0
 298:	F130  E1      		pop    hl              ; 00F130 E1
 299:	F131  23      		inc    hl              ; 00F131 23
 300:	F132  7C      		ld     a,h             ; 00F132 7C
 301:	F133  FE07    		cp     $07             ; 00F133 FE 07
 302:	F135  20F5    		jr     nz,FVLP0        ; 00F135 20 F5
 303:	F137  7D      		ld     a,l             ; 00F137 7D
 304:	F138  FE80    		cp     $80             ; 00F138 FE 80
 305:	F13A  20F0    		jr     nz,FVLP0        ; 00F13A 20 F0
 306:	F13C  C9      		ret                    ; 00F13C C9
 307:			;;
 308:			;; NEDOSCR - NEDOS boot screen
 309:			;	
 310:	F13D          	NEDOSCR:
 311:	F13D  CDE7F0  		call   CLRSCRGR           ; 00F13D CD E7 F0
 312:	F140  2156F3  		ld     hl,STR005        ; 00F140 21 56 F3
 313:	F143  CDE1F2  		call   DISPSTR           ; 00F143 CD E1 F2
 314:	F146  2175F3  		ld     hl,STR006        ; 00F146 21 75 F3
 315:	F149  CDE1F2  		call   DISPSTR           ; 00F149 CD E1 F2
 316:	F14C  21A4F3  		ld     hl,STR007        ; 00F14C 21 A4 F3
 317:	F14F  CDE1F2  		call   DISPSTR           ; 00F14F CD E1 F2
 318:	F152  3EFF    	NDSLP3:	ld     a,$ff           ; 00F152 3E FF
 319:	F154  324330  		ld     (GRAM3BUF),a       ; 00F154 32 43 30
 320:	F157  21D3F3  		ld     hl,STR009        ; 00F157 21 D3 F3
 321:	F15A  CDE1F2  		call   DISPSTR           ; 00F15A CD E1 F2
 322:	F15D  212605  		ld     hl,$0526        ; 00F15D 21 26 05
 323:	F160  CD60F0  		call   SDCUAE           ; 00F160 CD 60 F0
 324:	F163  CD94F0  		call   GETKBD           ; 00F163 CD 94 F0
 325:	F166  2AB6F3  		ld     hl,(STR008)      ; 00F166 2A B6 F3
 326:	F169  E5      		push   hl              ; 00F169 E5
 327:	F16A  CD60F0  		call   SDCUAE           ; 00F16A CD 60 F0
 328:	F16D  E1      		pop    hl              ; 00F16D E1
 329:				; blank str008 space
 330:	F16E  061A    		ld     b,$1a           ; 00F16E 06 1A
 331:	F170  3E20    	NDSLP0:	ld     a,$20           ; 00F170 3E 20
 332:	F172  CD13F1  		call   DISPGRCH           ; 00F172 CD 13 F1
 333:	F175  10F9    		djnz   NDSLP0           ; 00F175 10 F9
 334:	F177  212605  		ld     hl,$0526        ; 00F177 21 26 05
 335:	F17A  CD60F0  		call   SDCUAE           ; 00F17A CD 60 F0
 336:	F17D  AF      		xor    a               ; 00F17D AF
 337:	F17E  D3D6    		out    (FDCDRVRCNT),a         ; 00F17E D3 D6
 338:	F180  D3D0    		out    (FDCCMDSTATR),a         ; 00F180 D3 D0
 339:	F182          	NDSLP2:
 340:	F182  E3      		ex     (sp),hl         ; 00F182 E3
 341:	F183  E3      		ex     (sp),hl         ; 00F183 E3
 342:	F184  DBD0    		in     a,(FDCCMDSTATR)         ; 00F184 DB D0
 343:	F186  CB4F    		bit    1,a             ; 00F186 CB 4F
 344:	F188  2806    		jr     z,NDSLP1         ; 00F188 28 06
 345:	F18A  3ED0    		ld     a,FDCCMDSTATR           ; 00F18A 3E D0
 346:	F18C  D3D0    		out    (FDCCMDSTATR),a         ; 00F18C D3 D0
 347:	F18E  18F2    		jr     NDSLP2           ; 00F18E 18 F2
 348:	F190          	NDSLP1:
 349:	F190  210000  		ld     hl,$0000        ; 00F190 21 00 00
 350:	F193  220090  		ld     ($9000),hl      ; 00F193 22 00 90
 351:	F196  210015  		ld     hl,$1500        ; 00F196 21 00 15
 352:	F199  220290  		ld     ($9002),hl      ; 00F199 22 02 90
 353:	F19C  3E01    		ld     a,$01           ; 00F19C 3E 01
 354:	F19E  D3D6    		out    (FDCDRVRCNT),a         ; 00F19E D3 D6
 355:	F1A0  0605    		ld     b,$05           ; 00F1A0 06 05
 356:	F1A2  3E0B    	NDSJ1:	ld     a,$0b           ; 00F1A2 3E 0B
 357:	F1A4  D3D0    		out    (FDCCMDSTATR),a         ; 00F1A4 D3 D0
 358:	F1A6  E3      		ex     (sp),hl         ; 00F1A6 E3
 359:	F1A7  E3      		ex     (sp),hl         ; 00F1A7 E3
 360:	F1A8  10F8    		djnz   NDSJ1           ; 00F1A8 10 F8
 361:	F1AA  DBD0    	NDSJ2:	in     a,(FDCCMDSTATR)         ; 00F1AA DB D0
 362:	F1AC  CB47    		bit    0,a             ; 00F1AC CB 47
 363:	F1AE  20FA    		jr     nz,NDSJ2        ; 00F1AE 20 FA
 364:	F1B0  ED5B0290	NDSJ5:	ld     de,($9002)      ; 00F1B0 ED 5B 02 90
 365:	F1B4  2A0090  		ld     hl,($9000)      ; 00F1B4 2A 00 90
 366:	F1B7  CDF5F1  		call   NDSRDSEC           ; 00F1B7 CD F5 F1
 367:	F1BA  3A0290  		ld     a,($9002)       ; 00F1BA 3A 02 90
 368:	F1BD  3C      		inc    a               ; 00F1BD 3C
 369:	F1BE  FE0A    		cp     $0a             ; 00F1BE FE 0A
 370:	F1C0  2008    		jr     nz,NDSJ3        ; 00F1C0 20 08
 371:	F1C2  3A0390  		ld     a,($9003)       ; 00F1C2 3A 03 90
 372:	F1C5  3C      		inc    a               ; 00F1C5 3C
 373:	F1C6  320390  		ld     ($9003),a       ; 00F1C6 32 03 90
 374:	F1C9  AF      		xor    a               ; 00F1C9 AF
 375:	F1CA  320290  	NDSJ3:	ld     ($9002),a       ; 00F1CA 32 02 90
 376:	F1CD  2B      		dec    hl              ; 00F1CD 2B
 377:	F1CE  7E      		ld     a,(hl)          ; 00F1CE 7E
 378:	F1CF  320190  		ld     ($9001),a       ; 00F1CF 32 01 90
 379:	F1D2  2B      		dec    hl              ; 00F1D2 2B
 380:	F1D3  7E      		ld     a,(hl)          ; 00F1D3 7E
 381:	F1D4  320090  		ld     ($9000),a       ; 00F1D4 32 00 90
 382:	F1D7  2B      		dec    hl              ; 00F1D7 2B
 383:	F1D8  7E      		ld     a,(hl)          ; 00F1D8 7E
 384:	F1D9  FE01    		cp     $01             ; 00F1D9 FE 01
 385:	F1DB  2007    		jr     nz,NDSJ4        ; 00F1DB 20 07
 386:	F1DD  2B      		dec    hl              ; 00F1DD 2B
 387:	F1DE  7E      		ld     a,(hl)          ; 00F1DE 7E
 388:	F1DF  FE01    		cp     $01             ; 00F1DF FE 01
 389:	F1E1  28CD    		jr     z,NDSJ5         ; 00F1E1 28 CD
 390:	F1E3  C7      		rst    00h             ; 00F1E3 C7
 391:	F1E4  21B6F3  	NDSJ4:	ld     hl,STR008        ; 00F1E4 21 B6 F3
 392:	F1E7  AF      		xor    a               ; 00F1E7 AF
 393:	F1E8  D3D6    		out    (FDCDRVRCNT),a         ; 00F1E8 D3 D6
 394:	F1EA  3EF0    		ld     a,$f0           ; 00F1EA 3E F0
 395:	F1EC  324330  		ld     (GRAM3BUF),a       ; 00F1EC 32 43 30
 396:	F1EF  CDE1F2  		call   DISPSTR           ; 00F1EF CD E1 F2
 397:	F1F2  C352F1  		jp     NDSLP3           ; 00F1F2 C3 52 F1
 398:			;;
 399:	F1F5          	NDSRDSEC:	
 400:	F1F5  7B      		ld     a,e             ; 00F1F5 7B
 401:	F1F6  D3D2    		out    (FDCSECTREG),a         ; 00F1F6 D3 D2
 402:	F1F8  7A      		ld     a,d             ; 00F1F8 7A
 403:	F1F9  D3D7    		out    (FDCDATAREG),a         ; 00F1F9 D3 D7
 404:	F1FB  3E1A    		ld     a,$1a           ; 00F1FB 3E 1A
 405:	F1FD  D3D0    		out    (FDCCMDSTATR),a         ; 00F1FD D3 D0
 406:	F1FF  E3      		ex     (sp),hl         ; 00F1FF E3
 407:	F200  E3      		ex     (sp),hl         ; 00F200 E3
 408:	F201  DBD0    	NRD1:	in     a,(FDCCMDSTATR)         ; 00F201 DB D0
 409:	F203  0F      		rrca                   ; 00F203 0F
 410:	F204  38FB    		jr     c,NRD1         ; 00F204 38 FB
 411:	F206  3E88    		ld     a,$88           ; 00F206 3E 88
 412:	F208  D3D0    		out    (FDCCMDSTATR),a         ; 00F208 D3 D0
 413:	F20A  C5      		push   bc              ; 00F20A C5
 414:	F20B  C1      		pop    bc              ; 00F20B C1
 415:	F20C  1803    		jr     NRD2           ; 00F20C 18 03
 416:	F20E  0F      	NRD4:	rrca                   ; 00F20E 0F
 417:	F20F  300C    		jr     nc,NRD3        ; 00F20F 30 0C
 418:	F211  DBD0    	NRD2:	in     a,(FDCCMDSTATR)         ; 00F211 DB D0
 419:	F213  CB4F    		bit    1,a             ; 00F213 CB 4F
 420:	F215  28F7    		jr     z,NRD4         ; 00F215 28 F7
 421:	F217  DBD7    		in     a,(FDCDATAREG)         ; 00F217 DB D7
 422:	F219  77      		ld     (hl),a          ; 00F219 77
 423:	F21A  23      		inc    hl              ; 00F21A 23
 424:	F21B  18F4    		jr     NRD2           ; 00F21B 18 F4
 425:	F21D  DBD0    	NRD3:	in     a,(FDCCMDSTATR)         ; 00F21D DB D0
 426:	F21F  E65C    		and    $5c             ; 00F21F E6 5C
 427:	F221  C8      		ret    z               ; 00F221 C8
 428:	F222  3ED0    		ld     a,FDCCMDSTATR           ; 00F222 3E D0
 429:	F224  D3D0    		out    (FDCCMDSTATR),a         ; 00F224 D3 D0
 430:	F226  C9      		ret                    ; 00F226 C9
 431:			;;
 432:			;; NDSHW - test video hardware for nedos
 433:	F227          	NDSHW:
 434:	F227  21007F  		ld     hl,$7f00        ; 00F227 21 00 7F
 435:	F22A  220690  		ld     ($9006),hl      ; 00F22A 22 06 90
 436:	F22D  AF      		xor    a               ; 00F22D AF
 437:	F22E  08      		ex     af,af'          ; 00F22E 08
 438:	F22F  21FFFF  		ld     hl,$ffff        ; 00F22F 21 FF FF
 439:	F232  224030  		ld     (GRAM0BUF),hl      ; 00F232 22 40 30
 440:	F235  21FFEF  		ld     hl,$efff        ; 00F235 21 FF EF
 441:	F238  224230  		ld     (GRAM2BUF),hl      ; 00F238 22 42 30
 442:	F23B  CD26F1  		call   FILVRAMG           ; 00F23B CD 26 F1
 443:	F23E  CDD8F0  		call   RDRR19R12           ; 00F23E CD D8 F0
 444:	F241  218007  		ld     hl,$0780        ; 00F241 21 80 07
 445:	F244  DB8C    	NDH1:	in     a,(CRT6545ADST)         ; 00F244 DB 8C
 446:	F246  CB7F    		bit    7,a             ; 00F246 CB 7F
 447:	F248  28FA    		jr     z,NDH1         ; 00F248 28 FA
 448:	F24A  DB80    		in     a,(CRTRAM0DAT)         ; 00F24A DB 80
 449:	F24C  3C      		inc    a               ; 00F24C 3C
 450:	F24D  200A    		jr     nz,NDH2        ; 00F24D 20 0A
 451:	F24F  DB84    		in     a,(CRTRAM1DAT)         ; 00F24F DB 84
 452:	F251  3C      		inc    a               ; 00F251 3C
 453:	F252  2005    		jr     nz,NDH2        ; 00F252 20 05
 454:	F254  DB88    		in     a,(CRTRAM2DAT)         ; 00F254 DB 88
 455:	F256  3C      		inc    a               ; 00F256 3C
 456:	F257  2815    		jr     z,NDH3         ; 00F257 28 15
 457:	F259  ED730490	NDH2:	ld     ($9004),sp      ; 00F259 ED 73 04 90
 458:	F25D  ED7B0690		ld     sp,($9006)      ; 00F25D ED 7B 06 90
 459:	F261  E5      		push   hl              ; 00F261 E5
 460:	F262  ED730690		ld     ($9006),sp      ; 00F262 ED 73 06 90
 461:	F266  ED7B0490		ld     sp,($9004)      ; 00F266 ED 7B 04 90
 462:	F26A  08      		ex     af,af'          ; 00F26A 08
 463:	F26B  3E01    		ld     a,$01           ; 00F26B 3E 01
 464:	F26D  08      		ex     af,af'          ; 00F26D 08
 465:	F26E  2B      	NDH3:	dec    hl              ; 00F26E 2B
 466:	F26F  AF      		xor    a               ; 00F26F AF
 467:	F270  D38D    		out    (CRT6545DATA),a         ; 00F270 D3 8D
 468:	F272  7C      		ld     a,h             ; 00F272 7C
 469:	F273  B5      		or     l               ; 00F273 B5
 470:	F274  20CE    		jr     nz,NDH1        ; 00F274 20 CE
 471:	F276  CDD8F0  		call   RDRR19R12           ; 00F276 CD D8 F0
 472:	F279  08      		ex     af,af'          ; 00F279 08
 473:	F27A  B7      		or     a               ; 00F27A B7
 474:	F27B  2861    		jr     z,NDH4         ; 00F27B 28 61
 475:	F27D  CDE7F0  		call   CLRSCRGR           ; 00F27D CD E7 F0
 476:	F280  21D9F3  		ld     hl,STR010        ; 00F280 21 D9 F3
 477:	F283  CDE1F2  		call   DISPSTR           ; 00F283 CD E1 F2
 478:	F286  214001  		ld     hl,$0140        ; 00F286 21 40 01
 479:	F289  CD60F0  		call   SDCUAE           ; 00F289 CD 60 F0
 480:	F28C  ED730490		ld     ($9004),sp      ; 00F28C ED 73 04 90
 481:	F290  3E20    	NDH7:	ld     a,$20           ; 00F290 3E 20
 482:	F292  CD13F1  		call   DISPGRCH           ; 00F292 CD 13 F1
 483:	F295  ED7B0690		ld     sp,($9006)      ; 00F295 ED 7B 06 90
 484:	F299  E1      		pop    hl              ; 00F299 E1
 485:	F29A  ED730690		ld     ($9006),sp      ; 00F29A ED 73 06 90
 486:	F29E  7C      		ld     a,h             ; 00F29E 7C
 487:	F29F  C630    		add    a,$30           ; 00F29F C6 30
 488:	F2A1  CD13F1  		call   DISPGRCH           ; 00F2A1 CD 13 F1
 489:	F2A4  2600    		ld     h,$00           ; 00F2A4 26 00
 490:	F2A6  29      		add    hl,hl           ; 00F2A6 29
 491:	F2A7  29      		add    hl,hl           ; 00F2A7 29
 492:	F2A8  29      		add    hl,hl           ; 00F2A8 29
 493:	F2A9  29      		add    hl,hl           ; 00F2A9 29
 494:	F2AA  7C      		ld     a,h             ; 00F2AA 7C
 495:	F2AB  FE0A    		cp     $0a             ; 00F2AB FE 0A
 496:	F2AD  3802    		jr     c,NDH5         ; 00F2AD 38 02
 497:	F2AF  C607    		add    a,$07           ; 00F2AF C6 07
 498:	F2B1  C630    	NDH5:	add    a,$30           ; 00F2B1 C6 30
 499:	F2B3  CD13F1  		call   DISPGRCH           ; 00F2B3 CD 13 F1
 500:	F2B6  B7      		or     a               ; 00F2B6 B7
 501:	F2B7  7D      		ld     a,l             ; 00F2B7 7D
 502:	F2B8  1F      		rra                    ; 00F2B8 1F
 503:	F2B9  1F      		rra                    ; 00F2B9 1F
 504:	F2BA  1F      		rra                    ; 00F2BA 1F
 505:	F2BB  1F      		rra                    ; 00F2BB 1F
 506:	F2BC  FE0A    		cp     $0a             ; 00F2BC FE 0A
 507:	F2BE  3802    		jr     c,NDH6         ; 00F2BE 38 02
 508:	F2C0  C607    		add    a,$07           ; 00F2C0 C6 07
 509:	F2C2  C630    	NDH6:	add    a,$30           ; 00F2C2 C6 30
 510:	F2C4  CD13F1  		call   DISPGRCH           ; 00F2C4 CD 13 F1
 511:	F2C7  3A0790  		ld     a,($9007)       ; 00F2C7 3A 07 90
 512:	F2CA  FE7F    		cp     $7f             ; 00F2CA FE 7F
 513:	F2CC  20C2    		jr     nz,NDH7        ; 00F2CC 20 C2
 514:	F2CE  ED7B0490		ld     sp,($9004)      ; 00F2CE ED 7B 04 90
 515:	F2D2  21E9F3  		ld     hl,STR011        ; 00F2D2 21 E9 F3
 516:	F2D5  CDE1F2  		call   DISPSTR           ; 00F2D5 CD E1 F2
 517:	F2D8  CD7EF0  		call   SCUROF           ; 00F2D8 CD 7E F0
 518:	F2DB  CD94F0  		call   GETKBD           ; 00F2DB CD 94 F0
 519:	F2DE  C3E7F0  	NDH4:	jp     CLRSCRGR           ; 00F2DE C3 E7 F0
 520:			;;
 521:			;; DISPSTR - Display a string of format:
 522:			;; R,C,"STRING",$00
 523:			;	
 524:	F2E1          	DISPSTR:
 525:	F2E1  4E      		ld     c,(hl)          ; 00F2E1 4E
 526:	F2E2  23      		inc    hl              ; 00F2E2 23
 527:	F2E3  46      		ld     b,(hl)          ; 00F2E3 46
 528:	F2E4  E5      		push   hl              ; 00F2E4 E5
 529:	F2E5  C5      		push   bc              ; 00F2E5 C5
 530:	F2E6  E1      		pop    hl              ; 00F2E6 E1
 531:	F2E7  CD6EF0  		call   SDCUAE1           ; 00F2E7 CD 6E F0
 532:	F2EA  E1      		pop    hl              ; 00F2EA E1
 533:	F2EB  23      	DSLP0:	inc    hl              ; 00F2EB 23
 534:	F2EC  7E      		ld     a,(hl)          ; 00F2EC 7E
 535:	F2ED  FE00    		cp     $00             ; 00F2ED FE 00
 536:	F2EF  C8      		ret    z               ; 00F2EF C8
 537:	F2F0  CD13F1  		call   DISPGRCH           ; 00F2F0 CD 13 F1
 538:	F2F3  18F6    		jr     DSLP0           ; 00F2F3 18 F6
 539:			;; CRTTAB - 6545 Register setup values
 540:	F2F5          	CRTTAB:                        ; 00F2F5
 541:	F2F5  0B000B48		db    $0b,$00,$0b,$48
 542:	F2F9  1818001A		db    $18,$18,$00,$1a
 543:	F2FD  2857506F		db    $28,$57,$50,$6f
 544:			;	                       ; 00F2F5 0B
 545:			;	                       ; 00F2F6 00
 546:			;	                       ; 00F2F7 0B
 547:			;	                       ; 00F2F8 48
 548:			;	                       ; 00F2F9 18
 549:			;	                       ; 00F2FA 18
 550:			;	                       ; 00F2FB 00
 551:			;	                       ; 00F2FC 1A
 552:			;	                       ; 00F2FD 28
 553:			;	                       ; 00F2FE 57
 554:			;	                       ; 00F2FF 50
 555:			;	                       ; 00F300 6F
 556:			;;
 557:	F301          	STR001:                        ; 00F301
 558:	F301  0B01    		db    $0b,$01
 559:	F303  47524146		db    "GRAFIC - MONITOR 1.0",$00
	      4943202D
	      204D4F4E
	      49544F52
	      20312E30
	      00
 560:	F318          	STR002:                        ; 00F318
 561:	F318  0402    		db    $04,$02
 562:	F31A  74797065		db    "type",$00
	      00
 563:	F31F          	STR003:                        ; 00F31F
 564:	F31F  3A03    		db    $3a,$03
 565:	F321  22455343		db    $22,"ESC",$22," for BOOTSTRAPPING",$00
	      2220666F
	      7220424F
	      4F545354
	      52415050
	      494E4700
 566:	F339          	STR004:                        ; 00F339
 567:	F339  D903    	        db    $d9,$03
 568:	F33B  22524554		db    $22,"RETURN",$22," for testing VIDEO",$00
	      55524E22
	      20666F72
	      20746573
	      74696E67
	      20564944
	      454F00
 569:	F356          	STR005:                        ; 00F356
 570:	F356  0801    		db    $08,$01
 571:	F358  424F4F54		db    "BOOTSTRAP Version GRAFIC 1.0",$00
	      53545241
	      50205665
	      7273696F
	      6E204752
	      41464943
	      20312E30
	      00
 572:	F375          	STR006:                        ; 00F375
 573:	F375  9F01    		db    $9f,$01
 574:	F377  496E7365		db    "Insert NE-DOS-DISK Version GRAFIC in drive 0",$00
	      7274204E
	      452D444F
	      532D4449
	      534B2056
	      65727369
	      6F6E2047
	      52414649
	      4320696E
	      20647269
	      76652030
	      00
 575:	F3A4          	STR007:                        ; 00F3A4
 576:	F3A4  4E02    		db    $4e,$02
 577:	F3A6  7468656E		db    "then type a key",$00
	      20747970
	      65206120
	      6B657900
 578:	F3B6          	STR008:                        ; 00F3B6
 579:	F3B6  8903    		db    $89,$03
 580:	F3B8  204E6F20		db    " No NE-DOS Version GRAFIC ",$00
	      4E452D44
	      4F532056
	      65727369
	      6F6E2047
	      52414649
	      432000
 581:	F3D3          	STR009:                        ; 00F3D3
 582:	F3D3  2505    		db    $25,$05
 583:	F3D5  3E203C00		db    "> <",$00
 584:	F3D9          	STR010:                        ; 00F3D9
 585:	F3D9  0E00    		db    $0e,$00
 586:	F3DB  4572726F		db    "Errorpoints :",$00
	      72706F69
	      6E747320
	      3A00
 587:	F3E9          	STR011:                        ; 00F3E9
 588:	F3E9  2800    		db    $28,$00
 589:	F3EB  506C6561		db    "Please type a key",$00
	      73652074
	      79706520
	      61206B65
	      7900
 590:			;;	
 591:			;;	
 592:	F3FD  C303F4  	JNDSTA:	jp     NDOSSTA           ; 00F3FD C3 03 F4
 593:	F400  C3FDF3  	JJNDST:	jp     JNDSTA           ; 00F400 C3 FD F3
 594:	F403          	NDOSSTA:
 595:	F403  DB8C    		in     a,(CRT6545ADST)         ; 00F403 DB 8C
 596:	F405  AF      		xor    a               ; 00F405 AF
 597:	F406  D3D6    		out    (FDCDRVRCNT),a         ; 00F406 D3 D6
 598:	F408  F3      		di                     ; 00F408 F3
 599:	F409  310070  		ld     sp,$7000        ; 00F409 31 00 70
 600:	F40C  CDA5F0  		call   INICRT           ; 00F40C CD A5 F0
 601:	F40F  CD27F2  	NDST1:	call   NDSHW           ; 00F40F CD 27 F2
 602:	F412  2101F3  		ld     hl,STR001        ; 00F412 21 01 F3
 603:	F415  CDE1F2  		call   DISPSTR           ; 00F415 CD E1 F2
 604:	F418  2118F3  		ld     hl,STR002        ; 00F418 21 18 F3
 605:	F41B  CDE1F2  		call   DISPSTR           ; 00F41B CD E1 F2
 606:	F41E  211FF3  		ld     hl,STR003        ; 00F41E 21 1F F3
 607:	F421  CDE1F2  		call   DISPSTR           ; 00F421 CD E1 F2
 608:	F424  2139F3  		ld     hl,STR004        ; 00F424 21 39 F3
 609:	F427  CDE1F2  		call   DISPSTR           ; 00F427 CD E1 F2
 610:	F42A  21D3F3  		ld     hl,STR009        ; 00F42A 21 D3 F3
 611:	F42D  CDE1F2  		call   DISPSTR           ; 00F42D CD E1 F2
 612:	F430  212605  		ld     hl,$0526        ; 00F430 21 26 05
 613:	F433  CD60F0  		call   SDCUAE           ; 00F433 CD 60 F0
 614:	F436          	KBLP0:
 615:	F436  CD94F0  		call   GETKBD           ; 00F436 CD 94 F0
 616:	F439  FE1B    		cp     $1b             ; 00F439 FE 1B
 617:	F43B  CA3DF1  		jp     z,NEDOSCR         ; 00F43B CA 3D F1
 618:	F43E  FE0D    		cp     $0d             ; 00F43E FE 0D
 619:	F440  28CD    		jr     z,NDST1         ; 00F440 28 CD
 620:	F442  18F2    		jr     KBLP0           ; 00F442 18 F2
 621:	F444  00      		nop                    ; 00F444 00
 622:	F445  00      		nop                    ; 00F445 00
 623:	F446  00      		nop                    ; 00F446 00
 624:	F447  00      		nop                    ; 00F447 00
 625:	F448  00      		nop                    ; 00F448 00
 626:	F449  00      		nop                    ; 00F449 00
 627:	F44A  00      		nop                    ; 00F44A 00
 628:	F44B  00      		nop                    ; 00F44B 00
 629:	F44C  00      		nop                    ; 00F44C 00
 630:	F44D  00      		nop                    ; 00F44D 00
 631:	F44E  00      		nop                    ; 00F44E 00
 632:	F44F  00      		nop                    ; 00F44F 00
 633:			;;
 634:			;; DRVSEL - select drive for r/w ops
 635:			;
 636:	F450          	DRVSEL:	
 637:	F450  F5      		push   af              ; 00F450 F5
 638:	F451  C5      		push   bc              ; 00F451 C5
 639:	F452  3A4000  		ld     a,(FDRVBUF)       ; 00F452 3A 40 00
 640:	F455  3C      		inc    a               ; 00F455 3C
 641:	F456  47      		ld     b,a             ; 00F456 47
 642:	F457  AF      		xor    a               ; 00F457 AF
 643:	F458  37      		scf                    ; 00F458 37
 644:	F459  17      	DSHFT:	rla                    ; 00F459 17
 645:	F45A  10FD    		djnz   DSHFT           ; 00F45A 10 FD
 646:	F45C  D3D6    		out    (FDCDRVRCNT),a         ; 00F45C D3 D6
 647:	F45E  C1      		pop    bc              ; 00F45E C1
 648:	F45F  F1      		pop    af              ; 00F45F F1
 649:	F460  C9      		ret                    ; 00F460 C9
 650:			;;
 651:			;; CPMBOOT - boostrap cp/m
 652:			;
 653:	F461          	CPMBOOT:
 654:	F461  318000  		ld     sp,$0080        ; 00F461 31 80 00
 655:	F464  0E00    		ld     c,$00           ; 00F464 0E 00
 656:	F466  CD89F4  		call   INXTTRBUF       ; 00F466 CD 89 F4
 657:	F469  CD98F4  		call   ICURTRBUF       ; 00F469 CD 98 F4
 658:	F46C  3C      		inc    a               ; 00F46C 3C
 659:	F46D  D3D6    		out    (FDCDRVRCNT),a  ; 00F46D D3 D6
 660:	F46F  CDC2F4  		call   MTRAK0          ; 00F46F CD C2 F4
 661:	F472  C2FDF6  		jp     nz,UCREJ        ; 00F472 C2 FD F6
 662:	F475  018000  		ld     bc,$0080        ; read in loader at $0080
 663:	F478  CD93F4  		call   INIRDPBUF       ; 00F478 CD 93 F4
 664:	F47B  0E01    		ld     c,$01           ; 00F47B 0E 01
 665:	F47D  CD8EF4  		call   SAVSECBUF       ; 00F47D CD 8E F4
 666:	F480  CD0DF5  		call   FREADSEC        ; 00F480 CD 0D F5
 667:	F483  C2FDF6  		jp     nz,UCREJ        ; 00F483 C2 FD F6
 668:	F486  C38000  		jp     $0080           ; jump to the loader if all ok
 669:	F489          	INXTTRBUF:	
 670:	F489  79      		ld     a,c             ; 00F489 79
 671:	F48A  324100  		ld     (FNTRBUF),a       ; 00F48A 32 41 00
 672:	F48D  C9      		ret                    ; 00F48D C9
 673:	F48E          	SAVSECBUF:	
 674:	F48E  79      		ld     a,c             ; 00F48E 79
 675:	F48F  324200  		ld     (FSECBUF),a       ; 00F48F 32 42 00
 676:	F492  C9      		ret                    ; 00F492 C9
 677:	F493          	INIRDPBUF:	
 678:	F493  ED434500		ld     (FRDPBUF),bc      ; 00F493 ED 43 45 00
 679:	F497  C9      		ret                    ; 00F497 C9
 680:	F498          	ICURTRBUF:	
 681:	F498  79      		ld     a,c             ; 00F498 79
 682:	F499  324000  		ld     (FDRVBUF),a       ; 00F499 32 40 00
 683:	F49C  C9      		ret                    ; 00F49C C9
 684:			;;
 685:			;; SFDCCMD - send 1771 a command
 686:			;
 687:	F49D          	SFDCCMD:
 688:	F49D  F5      		push   af              ; 00F49D F5
 689:	F49E          	SNDCL:
 690:	F49E  DBD0    		in     a,(FDCCMDSTATR)         ; 00F49E DB D0
 691:	F4A0  CB47    		bit    0,a             ; check busy
 692:	F4A2  20FA    		jr     nz,SNDCL        ; 00F4A2 20 FA
 693:	F4A4  F1      		pop    af              ; 00F4A4 F1
 694:	F4A5  324300  		ld     (FCMDBUF),a       ; 00F4A5 32 43 00
 695:	F4A8  D3D0    		out    (FDCCMDSTATR),a         ; 00F4A8 D3 D0
 696:	F4AA  E3      		ex     (sp),hl         ; 00F4AA E3
 697:	F4AB  E3      		ex     (sp),hl         ; 00F4AB E3
 698:	F4AC  E3      		ex     (sp),hl         ; 00F4AC E3
 699:	F4AD  E3      		ex     (sp),hl         ; 00F4AD E3
 700:	F4AE  C9      		ret                    ; 00F4AE C9
 701:			;;
 702:			;; GFDCSTAT - get 1771 status and copy on buffer
 703:			;
 704:	F4AF          	GFDCSTAT:
 705:	F4AF  DBD0    		in     a,(FDCCMDSTATR)         ; 00F4AF DB D0
 706:	F4B1  CB47    		bit    0,a             ; 00F4B1 CB 47
 707:	F4B3  20FA    		jr     nz,GFDCSTAT        ; 00F4B3 20 FA
 708:	F4B5  324400  		ld     (FSTABUF),a       ; 00F4B5 32 44 00
 709:	F4B8  C9      		ret                    ; 00F4B8 C9
 710:			;
 711:	F4B9          	FTRKOFF:
 712:	F4B9  214A00  		ld     hl,FTRKBUF        ; 00F4B9 21 4A 00
 713:	F4BC  3A4000  		ld     a,(FDRVBUF)       ; 00F4BC 3A 40 00
 714:	F4BF  85      		add    a,l             ; 00F4BF 85
 715:	F4C0  6F      		ld     l,a             ; 00F4C0 6F
 716:	F4C1  C9      		ret                    ; 00F4C1 C9
 717:			;
 718:	F4C2          	MTRAK0:
 719:	F4C2  C5      		push   bc              ; 00F4C2 C5
 720:	F4C3  0603    		ld     b,$03           ; number of retries
 721:	F4C5  3E07    	FRETR0:	ld     a,$07           ; move to trak 0 cmd
 722:	F4C7  CD9DF4  		call   SFDCCMD           ; 00F4C7 CD 9D F4
 723:	F4CA  CDAFF4  		call   GFDCSTAT           ; 00F4CA CD AF F4
 724:	F4CD  E618    		and    $18             ; check for errors
 725:	F4CF  2806    		jr     z,FOK0         ; go no
 726:	F4D1  10F2    		djnz   FRETR0           ; retry
 727:	F4D3  3E82    		ld     a,$82           ; 00F4D3 3E 82
 728:	F4D5  1832    		jr     FTERR           ; error handle
 729:	F4D7  CDB9F4  	FOK0:	call   FTRKOFF           ; proceed
 730:	F4DA  182A    		jr     FGTRK           ; 00F4DA 18 2A
 731:			;;
 732:			;; FSEEK - seek to specific track/sector
 733:			;
 734:	F4DC          	FSEEK:
 735:	F4DC  C5      		push   bc              ; 00F4DC C5
 736:	F4DD  0603    		ld     b,$03           ; 00F4DD 06 03
 737:	F4DF  CDB9F4  		call   FTRKOFF           ; 00F4DF CD B9 F4
 738:	F4E2  7E      		ld     a,(hl)          ; 00F4E2 7E
 739:	F4E3  D3D1    		out    (FDCTRAKREG),a         ; 00F4E3 D3 D1
 740:	F4E5  3A4200  	FRETR1:	ld     a,(FSECBUF)       ; 00F4E5 3A 42 00
 741:	F4E8  D3D2    		out    (FDCSECTREG),a         ; 00F4E8 D3 D2
 742:	F4EA  3A4100  		ld     a,(FNTRBUF)       ; 00F4EA 3A 41 00
 743:	F4ED  D3D7    		out    (FDCDATAREG),a         ; 00F4ED D3 D7
 744:	F4EF  3E17    		ld     a,$17           ; seek cmd
 745:	F4F1  CD9DF4  		call   SFDCCMD           ; 00F4F1 CD 9D F4
 746:	F4F4  CDAFF4  		call   GFDCSTAT           ; 00F4F4 CD AF F4
 747:	F4F7  E618    		and    $18             ; 00F4F7 E6 18
 748:	F4F9  280B    		jr     z,FGTRK         ; 00F4F9 28 0B
 749:	F4FB  CDC2F4  		call   MTRAK0           ; 00F4FB CD C2 F4
 750:	F4FE  2009    		jr     nz,FTERR        ; 00F4FE 20 09
 751:	F500  10E3    		djnz   FRETR1           ; 00F500 10 E3
 752:	F502  3E83    		ld     a,$83           ; 00F502 3E 83
 753:	F504  1803    		jr     FTERR           ; 00F504 18 03
 754:	F506  DBD1    	FGTRK:	in     a,(FDCTRAKREG)         ; 00F506 DB D1
 755:	F508  77      		ld     (hl),a          ; 00F508 77
 756:	F509  C1      	FTERR:	pop    bc              ; 00F509 C1
 757:	F50A  CB7F    		bit    7,a             ; test if drive not ready
 758:	F50C  C9      		ret                    ; 00F50C C9
 759:			;;
 760:			;; FREADSEC - read a sector
 761:			;
 762:	F50D          	FREADSEC:
 763:	F50D  3A4700  		ld     a,(MIOBYTE)       ; 00F50D 3A 47 00
 764:	F510  CBC7    		set    0,a             ; 00F510 CB C7
 765:	F512  1805    		jr     FRWSEC           ; 00F512 18 05
 766:			;;
 767:			;; FWRITSEC - write a sector
 768:			;
 769:	F514          	FWRITSEC:
 770:	F514  3A4700  		ld     a,(MIOBYTE)       ; 00F514 3A 47 00
 771:	F517  CB87    		res    0,a             ; 00F517 CB 87
 772:			;;
 773:			;; FRWSEC - read or write a sector depending on MIOBYTE
 774:			;
 775:	F519          	FRWSEC:
 776:	F519  324700  		ld     (MIOBYTE),a       ; 00F519 32 47 00
 777:	F51C  CDDCF4  	FRWLP:	call   FSEEK           ; 00F51C CD DC F4
 778:	F51F  204D    		jr     nz,FSHTM        ; 00F51F 20 4D
 779:	F521  060A    		ld     b,$0a           ; 10 retries
 780:	F523  2A4500  	FRWNXT:	ld     hl,(FRDPBUF)      ; 00F523 2A 45 00
 781:	F526  C5      		push   bc              ; 00F526 C5
 782:	F527  01D780  		ld     bc,FRWWORD        ; 00F527 01 D7 80
 783:	F52A  3A4700  		ld     a,(MIOBYTE)       ; 00F52A 3A 47 00
 784:	F52D  CB47    		bit    0,a             ; 00F52D CB 47
 785:	F52F  2811    		jr     z,FRWWRO         ; 00F52F 28 11
 786:	F531  3E88    		ld     a,$88           ; read command
 787:	F533  CD9DF4  		call   SFDCCMD           ; 00F533 CD 9D F4
 788:	F536  DBD0    	FRRDY:	in     a,(FDCCMDSTATR)         ; 00F536 DB D0
 789:	F538  CB4F    		bit    1,a             ; sec found
 790:	F53A  28FA    		jr     z,FRRDY         ; 00F53A 28 FA
 791:	F53C  EDA2    		ini                    ; 00F53C ED A2
 792:	F53E  20F6    		jr     nz,FRRDY        ; 00F53E 20 F6
 793:	F540  180F    		jr     FWEND           ; 00F540 18 0F
 794:	F542  3EA8    	FRWWRO:	ld     a,$a8           ; 00F542 3E A8
 795:	F544  CD9DF4  		call   SFDCCMD           ; 00F544 CD 9D F4
 796:	F547  DBD0    	FWRDY:	in     a,(FDCCMDSTATR)         ; 00F547 DB D0
 797:	F549  CB4F    		bit    1,a             ; 00F549 CB 4F
 798:	F54B  28FA    		jr     z,FWRDY         ; 00F54B 28 FA
 799:	F54D  EDA3    		outi                   ; 00F54D ED A3
 800:	F54F  20F6    		jr     nz,FWRDY        ; 00F54F 20 F6
 801:	F551  CDAFF4  	FWEND:	call   GFDCSTAT           ; 00F551 CD AF F4
 802:	F554  C1      		pop    bc              ; 00F554 C1
 803:	F555  E61F    		and    $1f             ; test fo errors
 804:	F557  2815    		jr     z,FSHTM         ; 00F557 28 15
 805:	F559  10C8    		djnz   FRWNXT           ; 00F559 10 C8
 806:	F55B  3A4700  		ld     a,(MIOBYTE)       ; 00F55B 3A 47 00
 807:	F55E  CB7F    		bit    7,a             ; 00F55E CB 7F
 808:	F560  200C    		jr     nz,FSHTM        ; 00F560 20 0C
 809:	F562  CBFF    		set    7,a             ; 00F562 CB FF
 810:	F564  324700  		ld     (MIOBYTE),a       ; 00F564 32 47 00
 811:	F567  CDC2F4  		call   MTRAK0           ; 00F567 CD C2 F4
 812:	F56A  2002    		jr     nz,FSHTM        ; 00F56A 20 02
 813:	F56C  18AE    		jr     FRWLP           ; 00F56C 18 AE
 814:	F56E  F5      	FSHTM:	push   af              ; 00F56E F5
 815:	F56F  AF      		xor    a               ; 00F56F AF
 816:	F570  D3D6    		out    (FDCDRVRCNT),a         ; 00F570 D3 D6
 817:	F572  F1      		pop    af              ; 00F572 F1
 818:	F573  C9      		ret                    ; 00F573 C9
 819:			;;
 820:			;; FLOPPYREAD - read from given drv,track,sector,ram address
 821:			;
 822:	F574          	FLOPPYREAD:
 823:	F574  3A4700  		ld     a,(MIOBYTE)       ; 00F574 3A 47 00
 824:	F577  CBC7    		set    0,a             ; 00F577 CB C7
 825:	F579  1805    		jr     FLOPIO           ; 00F579 18 05
 826:			;;
 827:			;; FLOPPYWRIT - write to give drv,track.sector,ram address
 828:			;
 829:	F57B          	FLOPPYWRIT:
 830:	F57B  3A4700  		ld     a,(MIOBYTE)       ; 00F57B 3A 47 00
 831:	F57E  CB87    		res    0,a             ; 00F57E CB 87
 832:	F580  324700  	FLOPIO:	ld     (MIOBYTE),a       ; 00F580 32 47 00
 833:	F583  0604    		ld     b,$04           ; 00F583 06 04
 834:	F585  CDDEF6  		call   GETHNUM           ; 00F585 CD DE F6
 835:	F588  C1      		pop    bc              ; 00F588 C1
 836:	F589  CD93F4  		call   INIRDPBUF           ; 00F589 CD 93 F4
 837:	F58C  C1      		pop    bc              ; 00F58C C1
 838:	F58D  CD8EF4  		call   SAVSECBUF           ; 00F58D CD 8E F4
 839:	F590  C1      		pop    bc              ; 00F590 C1
 840:	F591  CD89F4  		call   INXTTRBUF           ; 00F591 CD 89 F4
 841:	F594  C1      		pop    bc              ; 00F594 C1
 842:	F595  CD98F4  		call   ICURTRBUF           ; 00F595 CD 98 F4
 843:	F598  CD50F4  		call   DRVSEL           ; 00F598 CD 50 F4
 844:	F59B  CD1CF5  		call   FRWLP           ; 00F59B CD 1C F5
 845:	F59E  C303F7  		jp     USRCMD           ; 00F59E C3 03 F7
 846:			;; Image to initalize location 0010H; 00F5A1
 847:	F5A1          	CRTTAB1:
 848:	F5A1  6F505728		db    $6f,$50,$57,$28,$1a,0,$19,$19,$48,$0b
	      1A001919
	      480B
 849:	F5AB  000B0000		db    0,$0b,0,0,0,0,0,0,0,0
	      00000000
	      0000
 850:							; 00F5A1 6F
 851:							; 00F5A2 50
 852:							; 00F5A3 57
 853:							; 00F5A4 28
 854:							; 00F5A5 1A
 855:							; 00F5A6 00
 856:							; 00F5A7 19
 857:							; 00F5A8 19
 858:							; 00F5A9 48
 859:							; 00F5AA 0B
 860:							; 00F5AB 00
 861:							; 00F5AC 0B
 862:							; 00F5AD 00
 863:							; 00F5AE 00
 864:							; 00F5AF 00
 865:							; 00F5B0 00
 866:							; 00F5B1 00
 867:							; 00F5B2 00
 868:							; 00F5B3 00
 869:							; 00F5B4 00
 870:			;;
 871:			;;
 872:	F5B5          	NEDOSINI:
 873:	F5B5  0E00    		ld     c,$00           ; 00F5B5 0E 00
 874:	F5B7  CD0FF0  		call   JNXTTR           ; 00F5B7 CD 0F F0
 875:	F5BA  3C      		inc    a               ; 00F5BA 3C
 876:	F5BB  D3D6    		out    (FDCDRVRCNT),a         ; 00F5BB D3 D6
 877:	F5BD  CD09F0  		call   JMTRK0           ; 00F5BD CD 09 F0
 878:	F5C0  C2FDF6  		jp     nz,UCREJ        ; 00F5C0 C2 FD F6
 879:	F5C3  C300F4  		jp     JJNDST           ; 00F5C3 C3 00 F4
 880:	F5C6  00      		nop                    ; 00F5C6 00
 881:	F5C7  00      		nop                    ; 00F5C7 00
 882:			;;
 883:			; INIT0 - init buffers,6545,test vram,clear,leave cursor at home
 884:			;
 885:	F5C8          	INIT0:
 886:	F5C8  CDA5F0  		call   INICRT           ; 00F5C8 CD A5 F0
 887:	F5CB  CD06F6  		call   INICRTREG        ; 00F5CB CD 06 F6
 888:	F5CE  CD16FC  		call   DLIGHT           ; 00F5CE CD 16 FC
 889:	F5D1  CD40FE  		call   DBLANK           ; 00F5D1 CD 40 FE
 890:	F5D4  3EFF    		ld     a,$ff           ; 00F5D4 3E FF
 891:	F5D6  322800  		ld     (RAM3BUF),a       ; 00F5D6 32 28 00
 892:	F5D9  210000  		ld     hl,$0000        ; 00F5D9 21 00 00
 893:	F5DC  224800  		ld     (CURPBUF),hl      ; 00F5DC 22 48 00
 894:	F5DF  C339FC  		jp     INICRTCUR           ; 00F5DF C3 39 FC
 895:			;;
 896:	F5E2          	STR100:                        ; 00F5E2
 897:	F5E2  454C4554		db    "ELETTRO design * Monitor V. 1.0x"
	      54524F20
	      64657369
	      676E202A
	      204D6F6E
	      69746F72
	      20562E20
	      312E3078
 898:				
 899:			;;
 900:	F602          	CRLFTAB:
 901:	F602  0D8A0001		db $0d,$8a,$00,$01
 902:				                       ; 00F602 0D
 903:				                       ; 00F603 8A
 904:				                       ; 00F604 00
 905:				                       ; 00F605 01
 906:			;;	
 907:			;; INICRTREG
 908:			;;
 909:	F606          	INICRTREG:
 910:	F606  CDB0F7  		call   GDCUA           ; 00F606 CD B0 F7
 911:	F609  E5      		push   hl              ; 00F609 E5
 912:	F60A  211000  		ld     hl,CRTTABUF        ; 00F60A 21 10 00
 913:	F60D  0600    		ld     b,$00           ; 00F60D 06 00
 914:	F60F  78      		ld     a,b             ; 00F60F 78
 915:	F610  D38C    	ICTLP0:	out    (CRT6545ADST),a         ; 00F610 D3 8C
 916:	F612  7E      		ld     a,(hl)          ; 00F612 7E
 917:	F613  D38D    		out    (CRT6545DATA),a         ; 00F613 D3 8D
 918:	F615  23      		inc    hl              ; 00F615 23
 919:	F616  04      		inc    b               ; 00F616 04
 920:	F617  78      		ld     a,b             ; 00F617 78
 921:	F618  FE14    		cp     $14             ; 00F618 FE 14
 922:	F61A  20F4    		jr     nz,ICTLP0        ; 00F61A 20 F4
 923:	F61C  2A4800  		ld     hl,(CURPBUF)      ; 00F61C 2A 48 00
 924:	F61F  CD0EF9  		call   SDSTA           ; 00F61F CD 0E F9
 925:	F622  E1      		pop    hl              ; 00F622 E1
 926:	F623  2B      		dec    hl              ; 00F623 2B
 927:	F624  C360F0  		jp     SDCUAE           ; 00F624 C3 60 F0
 928:	F627  00      		nop                    ; 00F627 00
 929:	F628  00      		nop                    ; 00F628 00
 930:	F629  00      		nop                    ; 00F629 00
 931:	F62A  00      		nop                    ; 00F62A 00
 932:	F62B  00      		nop                    ; 00F62B 00
 933:	F62C  00      		nop                    ; 00F62C 00
 934:	F62D  00      		nop                    ; 00F62D 00
 935:	F62E  00      		nop                    ; 00F62E 00
 936:	F62F  00      		nop                    ; 00F62F 00
 937:	F630          	BOOT:
 938:				; Reset bios position after reset
 939:	F630  DBD6    		in     a,(FDCDRVRCNT)  ; 00F630 DB D6	
 940:	F632  318000  		ld     sp,$0080        ; 00F632 31 80 00
 941:	F635  21A1F5  		ld     hl,CRTTAB1        ; 00F635 21 A1 F5
 942:	F638  111000  		ld     de,CRTTABUF        ; 00F638 11 10 00
 943:	F63B  011400  		ld     bc,$0014        ; 00F63B 01 14 00
 944:	F63E  EDB0    		ldir                   ; 00F63E ED B0
 945:	F640  210000  		ld     hl,$0000        ; 00F640 21 00 00
 946:	F643  224800  		ld     (CURPBUF),hl      ; 00F643 22 48 00
 947:	F646  AF      		xor    a               ; 00F646 AF
 948:	F647  322700  		ld     (CIOBYTE),a       ; 00F647 32 27 00
 949:	F64A  322900  		ld     (COLBUF),a       ; 00F64A 32 29 00
 950:	F64D  324700  		ld     (MIOBYTE),a       ; 00F64D 32 47 00
 951:	F650  2F      		cpl                    ; 00F650 2F
 952:	F651  322800  		ld     (RAM3BUF),a       ; 00F651 32 28 00
 953:	F654  CDC8F5  		call   INIT0           ; 00F654 CD C8 F5
 954:	F657  21FFFF  		ld     hl,$ffff        ; 00F657 21 FF FF
 955:	F65A  224A00  		ld     (FTRKBUF),hl      ; 00F65A 22 4A 00
 956:	F65D  224C00  		ld     ($004c),hl      ; 00F65D 22 4C 00
 957:	F660  AF      		xor    a               ; 00F660 AF
 958:	F661  D381    		out    (CRTPRNTDAT),a         ; 00F661 D3 81
 959:	F663  D303    		out    (ALTPRNPRT),a         ; 00F663 D3 03
 960:	F665  2F      		cpl                    ; 00F665 2F
 961:	F666  D381    		out    (CRTPRNTDAT),a         ; 00F666 D3 81
 962:	F668  D303    		out    (ALTPRNPRT),a         ; 00F668 D3 03
 963:	F66A  3EC3    		ld     a,$c3           ; 00F66A 3E C3
 964:	F66C  320800  		ld     ($0008),a       ; 00F66C 32 08 00
 965:	F66F  326600  		ld     ($0066),a       ; 00F66F 32 66 00
 966:	F672  2100F0  		ld     hl,JBOOT        ; 00F672 21 00 F0
 967:	F675  226700  		ld     ($0067),hl      ; 00F675 22 67 00
 968:	F678  31A2F6  		ld     sp,BJMP5        ; 00F678 31 A2 F6
 969:	F67B  3E      		db	$3e
 970:			;;
 971:			;; FMEMSIZ - cerca l'ultima pagina di memoria disponibile
 972:			;
 973:	F67C          	FMEMSIZ:
 974:	F67C  C5      		push   bc              ; 00F67C C5 !!! NOT EXECUTED IF HERE FROM BOOT
 975:	F67D  0100FF  		ld     bc,$ff00        ; 00F67D 01 00 FF
 976:	F680  21FFFF  		ld     hl,$ffff        ; 00F680 21 FF FF
 977:	F683          	BJMP2:
 978:	F683  24      		inc    h               ; 00F683 24
 979:	F684  7E      		ld     a,(hl)          ; 00F684 7E
 980:	F685  2F      		cpl                    ; 00F685 2F
 981:	F686  77      		ld     (hl),a          ; 00F686 77
 982:	F687  BE      		cp     (hl)            ; 00F687 BE
 983:	F688  2F      		cpl                    ; 00F688 2F
 984:	F689  77      		ld     (hl),a          ; 00F689 77
 985:	F68A  2004    		jr     nz,BJMP1        ; 00F68A 20 04
 986:	F68C  7C      		ld     a,h             ; 00F68C 7C
 987:	F68D  B8      		cp     b               ; 00F68D B8
 988:	F68E  20F3    		jr     nz,BJMP2        ; 00F68E 20 F3
 989:	F690          	BJMP1:	
 990:	F690  25      		dec    h               ; 00F690 25
 991:	F691  01DEFF  		ld     bc,$ffde        ; 00F691 01 DE FF should be a number in 2 compl.
 992:	F694  09      		add    hl,bc           ; 00F694 09
 993:	F695  C1      		pop    bc              ; 00F695 C1
 994:	F696  C9      		ret                    ; 00F696 C9 !!! GO TO BJMP6 IF HERE FROM BOOT
 995:			;;
 996:			;; LPAGE - Find ram last page and return in B
 997:	F697          	LPAGE:
 998:	F697  E5      		push   hl              ; 00F697 E5
 999:	F698  CD7CF6  		call   FMEMSIZ           ; 00F698 CD 7C F6
1000:	F69B  7D      		ld     a,l             ; 00F69B 7D
1001:	F69C  D63D    		sub    $3d             ; 00F69C D6 3D
1002:	F69E  3001    		jr     nc,BJMP6        ; 00F69E 30 01
1003:	F6A0  25      		dec    h               ; 00F6A0 25
1004:	F6A1          	BJMP6:
1005:	F6A1  44      		ld     b,h             ; 00F6A1 44
1006:	F6A2          	BJMP5:	
1007:	F6A2  E1      		pop    hl              ; 00F6A2 E1
1008:	F6A3  C9      		ret                    ; 00F6A3 C9
1009:			;
1010:	F6A4          	BJTAB:                         ; 00F6A4
1011:	F6A4  A6F6    		dw    BJTAB+2         ; ovvero f6a6
1012:			;
1013:	F6A6          	BJMP3:
1014:				;; copy 29 bytes of bios code from RAMBLK to last page of available ram
1015:	F6A6  F9      		ld     sp,hl           ; 00F6A6 F9	
1016:	F6A7  11F2F9  		ld     de,RAMBLK        ; 00F6A7 11 F2 F9
1017:	F6AA  EB      		ex     de,hl           ; 00F6AA EB
1018:	F6AB  011D00  		ld     bc,$001d        ; 00F6AB 01 1D 00
1019:	F6AE  EDB0    		ldir                   ; 00F6AE ED B0
1020:	F6B0  010600  		ld     bc,$0006        ; 00F6B0 01 06 00
1021:	F6B3  D5      		push   de              ; 00F6B3 D5
1022:	F6B4  E1      		pop    hl              ; 00F6B4 E1
1023:	F6B5  2B      		dec    hl              ; 00F6B5 2B
1024:	F6B6  EDB0    		ldir                   ; 00F6B6 ED B0
1025:	F6B8  21E8FF  		ld     hl,$ffe8        ; 00F6B8 21 E8 FF should be a number in 2 compl.
1026:	F6BB  39      		add    hl,sp           ; 00F6BB 39
1027:	F6BC  E5      		push   hl              ; 00F6BC E5
1028:	F6BD  23      		inc    hl              ; 00F6BD 23
1029:	F6BE  23      		inc    hl              ; 00F6BE 23
1030:	F6BF  220600  		ld     ($0006),hl      ; 00F6BF 22 06 00
1031:	F6C2  160A    		ld     d,$0a           ; 00F6C2 16 0A
1032:	F6C4          	BJMP4:
1033:	F6C4  C5      		push   bc              ; 00F6C4 C5
1034:	F6C5  15      		dec    d               ; 00F6C5 15
1035:	F6C6  20FC    		jr     nz,BJMP4        ; 00F6C6 20 FC
1036:	F6C8  00      		nop                    ; 00F6C8 00
1037:	F6C9  00      		nop                    ; 00F6C9 00
1038:	F6CA  00      		nop                    ; 00F6CA 00
1039:				;; print bios greetings
1040:	F6CB  21E2F5  		ld     hl,STR100        ; 00F6CB 21 E2 F5
1041:	F6CE  CD99FA  		call   GREET           ; 00F6CE CD 99 FA
1042:	F6D1  1830    		jr     USRCMD           ; 00F6D1 18 30
1043:			;;
1044:	F6D3          	GET1HNUM:
1045:	F6D3  0601    		ld     b,$01           ; 00F6D3 06 01
1046:	F6D5  210000  		ld     hl,$0000        ; 00F6D5 21 00 00
1047:	F6D8  180A    		jr     GENTR           ; 00F6D8 18 0A
1048:	F6DA  2021    	HEHEX:	jr     nz,UCREJ        ; 00F6DA 20 21
1049:	F6DC          	POP1PRM:
1050:	F6DC  05      		dec    b               ; 00F6DC 05
1051:	F6DD  C8      		ret    z               ; 00F6DD C8
1052:			;;
1053:			;; GETHNUM - get an hexadecimal string
1054:			;
1055:	F6DE          	GETHNUM:
1056:	F6DE  210000  		ld     hl,$0000        ; 00F6DE 21 00 00
1057:	F6E1  CD28F9  	GNXTC:	call   DOGETCHR           ; 00F6E1 CD 28 F9
1058:	F6E4  4F      	GENTR:	ld     c,a             ; 00F6E4 4F
1059:	F6E5  CD5DF9  		call   CHKHEX           ; 00F6E5 CD 5D F9
1060:	F6E8  3808    		jr     c,HNHEX         ; if not hex digit
1061:	F6EA  29      		add    hl,hl           ; 00F6EA 29
1062:	F6EB  29      		add    hl,hl           ; 00F6EB 29
1063:	F6EC  29      		add    hl,hl           ; 00F6EC 29
1064:	F6ED  29      		add    hl,hl           ; 00F6ED 29
1065:	F6EE  B5      		or     l               ; 00F6EE B5
1066:	F6EF  6F      		ld     l,a             ; 00F6EF 6F
1067:	F6F0  18EF    		jr     GNXTC           ; 00F6F0 18 EF
1068:	F6F2  E3      	HNHEX:	ex     (sp),hl         ; 00F6F2 E3
1069:	F6F3  E5      		push   hl              ; 00F6F3 E5
1070:	F6F4  79      		ld     a,c             ; 00F6F4 79
1071:	F6F5  CD70F9  		call   CHKCTR           ; 00F6F5 CD 70 F9
1072:	F6F8  30E0    		jr     nc,HEHEX        ; 00F6F8 30 E0
1073:	F6FA  1001    		djnz   UCREJ           ; 00F6FA 10 01
1074:	F6FC  C9      		ret                    ; 00F6FC C9
1075:			;;	
1076:			;; USRCMD - display prompt and process user commands
1077:			;;
1078:	F6FD          	UCREJ:
1079:	F6FD  210FFA  		ld     hl,URESTR        ; 00F6FD 21 0F FA
1080:	F700  CD9CFA  		call   CONSTR           ; 00F700 CD 9C FA
1081:	F703          	USRCMD:
1082:	F703  2A0600  		ld     hl,($0006)      ; 00F703 2A 06 00
1083:	F706  F9      		ld     sp,hl           ; 00F706 F9
1084:	F707  2103F7  		ld     hl,USRCMD        ; 00F707 21 03 F7
1085:	F70A  E5      		push   hl              ; 00F70A E5
1086:	F70B  220100  		ld     ($0001),hl      ; 00F70B 22 01 00
1087:	F70E  3EC3    		ld     a,$c3           ; 00F70E 3E C3
1088:	F710  320000  		ld     ($0000),a       ; 00F710 32 00 00
1089:	F713  CDB0FA  		call   OUTCRLF           ; 00F713 CD B0 FA
1090:	F716  CD25F9  		call   DOPROMPT           ; 00F716 CD 25 F9
1091:	F719  D641    		sub    $41             ; convert to number
1092:	F71B  38E0    		jr     c,UCREJ         ; minor 0
1093:	F71D  FE1A    		cp     $1a             ; 00F71D FE 1A
1094:	F71F  30DC    		jr     nc,UCREJ        ; greater than jump table
1095:	F721  87      		add    a,a             ; 00F721 87
1096:	F722  5F      		ld     e,a             ; 00F722 5F
1097:	F723  1600    		ld     d,$00           ; 00F723 16 00
1098:	F725  0602    		ld     b,$02           ; 00F725 06 02
1099:	F727  21D2FA  		ld     hl,UCMDTAB        ; 00F727 21 D2 FA
1100:	F72A  19      		add    hl,de           ; 00F72A 19
1101:	F72B  7E      		ld     a,(hl)          ; 00F72B 7E
1102:	F72C  23      		inc    hl              ; 00F72C 23
1103:	F72D  66      		ld     h,(hl)          ; 00F72D 66
1104:	F72E  6F      		ld     l,a             ; 00F72E 6F
1105:	F72F  E9      		jp     (hl)            ; 00F72F E9
1106:			;;
1107:			;; FILLMEM - fill memory with a given values
1108:			;
1109:	F730          	FILLMEM:
1110:	F730  CD33F9  		call   POP3NUM           ; 00F730 CD 33 F9
1111:	F733  71      	FLME1:	ld     (hl),c          ; 00F733 71
1112:	F734  CD3CF9  		call   CHKEOR           ; 00F734 CD 3C F9
1113:	F737  30FA    		jr     nc,FLME1        ; 00F737 30 FA
1114:	F739  D1      		pop    de              ; 00F739 D1
1115:	F73A  18C7    		jr     USRCMD           ; 00F73A 18 C7
1116:			;;
1117:			;; MEMCOMP - compare two ram regions
1118:	F73C          	MEMCOMP:
1119:	F73C  CD33F9  		call   POP3NUM           ; 00F73C CD 33 F9
1120:	F73F  0A      	MCONX:	ld     a,(bc)          ; 00F73F 0A
1121:	F740  C5      		push   bc              ; 00F740 C5
1122:	F741  46      		ld     b,(hl)          ; 00F741 46
1123:	F742  B8      		cp     b               ; 00F742 B8
1124:	F743  280C    		jr     z,MCO1         ; 00F743 28 0C
1125:	F745  F5      		push   af              ; 00F745 F5
1126:	F746  CD63FA  		call   HL2ASCB           ; 00F746 CD 63 FA
1127:	F749  78      		ld     a,b             ; 00F749 78
1128:	F74A  CD5CFA  		call   H2AJ3           ; 00F74A CD 5C FA
1129:	F74D  F1      		pop    af              ; 00F74D F1
1130:	F74E  CD4EFA  		call   H2AJ1           ; 00F74E CD 4E FA
1131:	F751  C1      	MCO1:	pop    bc              ; 00F751 C1
1132:	F752  CD48F9  		call   IPTRCKBD           ; 00F752 CD 48 F9
1133:	F755  18E8    		jr     MCONX           ; 00F755 18 E8
1134:			;;
1135:			;; MEMDUMP - prompt user and dump memory area
1136:			;
1137:	F757          	MEMDUMP:
1138:	F757  CDABFA  		call   POP2PRM           ; 00F757 CD AB FA
1139:	F75A  CD63FA  	MDP6:	call   HL2ASCB           ; 00F75A CD 63 FA
1140:	F75D  7D      		ld     a,l             ; 00F75D 7D
1141:	F75E  CD9BF7  		call   DMPALIB           ; 00F75E CD 9B F7
1142:	F761  E5      		push   hl              ; 00F761 E5
1143:	F762  7E      	MDP2:	ld     a,(hl)          ; 00F762 7E
1144:	F763  CD4EFA  		call   H2AJ1           ; 00F763 CD 4E FA
1145:	F766  CD3CF9  		call   CHKEOR           ; 00F766 CD 3C F9
1146:	F769  382A    		jr     c,MDP1         ; 00F769 38 2A
1147:	F76B  CD66FA  		call   SPACER           ; 00F76B CD 66 FA
1148:	F76E  7D      		ld     a,l             ; 00F76E 7D
1149:	F76F  E60F    		and    $0f             ; 00F76F E6 0F
1150:	F771  20EF    		jr     nz,MDP2        ; 00F771 20 EF
1151:	F773  E1      	MDP7:	pop    hl              ; 00F773 E1
1152:	F774  7D      		ld     a,l             ; 00F774 7D
1153:	F775  E60F    		and    $0f             ; 00F775 E6 0F
1154:	F777  CDA0F7  		call   DMPALIA           ; 00F777 CD A0 F7
1155:	F77A  7E      	MDP5:	ld     a,(hl)          ; 00F77A 7E
1156:	F77B  00      		nop                    ; 00F77B 00
1157:	F77C  00      		nop                    ; 00F77C 00
1158:	F77D  4F      		ld     c,a             ; 00F77D 4F
1159:	F77E  FE20    		cp     $20             ; 00F77E FE 20
1160:	F780  3804    		jr     c,MDP3         ; 00F780 38 04
1161:	F782  00      		nop                    ; 00F782 00
1162:	F783  00      		nop                    ; 00F783 00
1163:	F784  1802    		jr     MDP4           ; 00F784 18 02
1164:	F786  0E2E    	MDP3:	ld     c,$2e           ; 00F786 0E 2E
1165:	F788  CD68FA  	MDP4:	call   OUTCHR           ; 00F788 CD 68 FA
1166:	F78B  CD49F9  		call   CHKBRK           ; 00F78B CD 49 F9
1167:	F78E  7D      		ld     a,l             ; 00F78E 7D
1168:	F78F  E60F    		and    $0f             ; 00F78F E6 0F
1169:	F791  20E7    		jr     nz,MDP5        ; 00F791 20 E7
1170:	F793  18C5    		jr     MDP6           ; 00F793 18 C5
1171:	F795  93      	MDP1:	sub    e               ; 00F795 93
1172:	F796  CD9BF7  		call   DMPALIB           ; 00F796 CD 9B F7
1173:	F799  18D8    		jr     MDP7           ; 00F799 18 D8
1174:			;;
1175:			;; DMPALIB - beginning align (spacing) for a memdump
1176:	F79B          	DMPALIB:
1177:	F79B  E60F    		and    $0f             ; 00F79B E6 0F
1178:	F79D  47      		ld     b,a             ; 00F79D 47
1179:	F79E  87      		add    a,a             ; 00F79E 87
1180:	F79F  80      		add    a,b             ; 00F79F 80
1181:			;;
1182:			;; DMPALIB - ascii align (spacing) for a memdump
1183:	F7A0          	DMPALIA:
1184:	F7A0  47      		ld     b,a             ; 00F7A0 47
1185:	F7A1  04      		inc    b               ; 00F7A1 04
1186:	F7A2  CD66FA  	ALIBN:	call   SPACER           ; 00F7A2 CD 66 FA
1187:	F7A5  10FB    		djnz   ALIBN           ; 00F7A5 10 FB
1188:	F7A7  C9      		ret                    ; 00F7A7 C9
1189:			;;
1190:			;; GOEXEC - execute from user address
1191:			;
1192:	F7A8          	GOEXEC:
1193:	F7A8  CDDCF6  		call   POP1PRM           ; 00F7A8 CD DC F6
1194:	F7AB  E1      		pop    hl              ; 00F7AB E1
1195:	F7AC  E9      		jp     (hl)            ; 00F7AC E9
1196:			;
1197:	F7AD  00      		nop                    ; 00F7AD 00
1198:	F7AE  00      		nop                    ; 00F7AE 00
1199:	F7AF  00      		nop                    ; 00F7AF 00
1200:			;;
1201:			;; GET DISPLAY CURSOR POSITION and return in HL
1202:			;
1203:	F7B0          	GDCUA:
1204:	F7B0  3E0E    		ld     a,$0e           ; 00F7B0 3E 0E
1205:	F7B2  D38C    		out    (CRT6545ADST),a         ; 00F7B2 D3 8C
1206:	F7B4  DB8D    		in     a,(CRT6545DATA)         ; 00F7B4 DB 8D
1207:	F7B6  67      		ld     h,a             ; 00F7B6 67
1208:	F7B7  3E0F    		ld     a,$0f           ; 00F7B7 3E 0F
1209:	F7B9  D38C    		out    (CRT6545ADST),a         ; 00F7B9 D3 8C
1210:	F7BB  DB8D    		in     a,(CRT6545DATA)         ; 00F7BB DB 8D
1211:	F7BD  6F      		ld     l,a             ; 00F7BD 6F
1212:	F7BE  23      		inc    hl              ; 00F7BE 23
1213:	F7BF  3E1F    		ld     a,$1f           ; 00F7BF 3E 1F
1214:	F7C1  D38C    		out    (CRT6545ADST),a         ; 00F7C1 D3 8C
1215:	F7C3  C9      		ret                    ; 00F7C3 C9
1216:			;;	
1217:	F7C4          	CIJP2:
1218:	F7C4  D38C    		out    (CRT6545ADST),a         ; 00F7C4 D3 8C
1219:	F7C6  DB8D    		in     a,(CRT6545DATA)         ; 00F7C6 DB 8D
1220:	F7C8  6F      		ld     l,a             ; 00F7C8 6F
1221:	F7C9  CD60F0  		call   SDCUAE           ; 00F7C9 CD 60 F0
1222:	F7CC  EB      		ex     de,hl           ; 00F7CC EB
1223:	F7CD  C3EEF8  		jp     CIJP3           ; 00F7CD C3 EE F8
1224:			;;
1225:			;; DISPCH - Display a char on CRT at current position
1226:			;
1227:	F7D0          	DISPCH:	
1228:	F7D0  F5      		push   af              ; 00F7D0 F5
1229:	F7D1  3E1F    		ld     a,$1f           ; 00F7D1 3E 1F
1230:	F7D3  D38C    		out    (CRT6545ADST),a         ; 00F7D3 D3 8C
1231:	F7D5  3A2800  		ld     a,(RAM3BUF)       ; 00F7D5 3A 28 00
1232:	F7D8  D38E    		out    (CRTRAM3PORT),a         ; 00F7D8 D3 8E
1233:	F7DA  F1      		pop    af              ; 00F7DA F1
1234:	F7DB  D380    		out    (CRTRAM0DAT),a         ; 00F7DB D3 80
1235:	F7DD          	DCLP0:
1236:	F7DD  DB8C    		in     a,(CRT6545ADST)         ; 00F7DD DB 8C
1237:	F7DF  CB7F    		bit    7,a             ; 00F7DF CB 7F
1238:	F7E1  28FA    		jr     z,DCLP0         ; 00F7E1 28 FA
1239:	F7E3  AF      		xor    a               ; 00F7E3 AF
1240:	F7E4  D38D    		out    (CRT6545DATA),a         ; 00F7E4 D3 8D
1241:	F7E6  C9      		ret                    ; 00F7E6 C9
1242:			
1243:	F7E7          	CIJP1:
1244:	F7E7  DB8C    		in     a,(CRT6545ADST)         ; 00F7E7 DB 8C
1245:	F7E9  CB77    		bit    6,a             ; 00F7E9 CB 77
1246:	F7EB  C8      		ret    z               ; 00F7EB C8
1247:	F7EC  3E10    		ld     a,$10           ; 00F7EC 3E 10
1248:	F7EE  D38C    		out    (CRT6545ADST),a         ; 00F7EE D3 8C
1249:	F7F0  DB8D    		in     a,(CRT6545DATA)         ; 00F7F0 DB 8D
1250:	F7F2  67      		ld     h,a             ; 00F7F2 67
1251:	F7F3  3E11    		ld     a,$11           ; 00F7F3 3E 11
1252:	F7F5  C3C4F7  		jp     CIJP2           ; 00F7F5 C3 C4 F7
1253:			;;
1254:			;; PORTIN - input a byte from given port (display it in binary)
1255:			;
1256:	F7F8          	PORTIN:
1257:	F7F8  CDDCF6  		call   POP1PRM           ; 00F7F8 CD DC F6
1258:	F7FB  C1      		pop    bc              ; 00F7FB C1
1259:	F7FC  ED58    		in     e,(c)           ; 00F7FC ED 58
1260:	F7FE  1851    		jr     BINDISP           ; 00F7FE 18 51
1261:			;;
1262:			;; PORTOUT - output a byte to a give port
1263:	F800          	PORTOUT:
1264:	F800  CDDEF6  		call   GETHNUM           ; 00F800 CD DE F6
1265:	F803  D1      		pop    de              ; 00F803 D1
1266:	F804  C1      		pop    bc              ; 00F804 C1
1267:	F805  ED59    		out    (c),e           ; 00F805 ED 59
1268:	F807  C9      		ret                    ; 00F807 C9
1269:			;;
1270:			;; MEMMOVE - move data in memory
1271:			;
1272:	F808          	MEMMOVE:
1273:	F808  CD33F9  		call   POP3NUM           ; 00F808 CD 33 F9
1274:	F80B  7E      	MMNXT:	ld     a,(hl)          ; 00F80B 7E
1275:	F80C  02      		ld     (bc),a          ; 00F80C 02
1276:	F80D  CD48F9  		call   IPTRCKBD           ; 00F80D CD 48 F9
1277:	F810  18F9    		jr     MMNXT           ; 00F810 18 F9
1278:			;;
1279:			;; RWMEM - lets user alter memory content
1280:			;
1281:	F812          	RWMEM:
1282:	F812  CDDCF6  		call   POP1PRM         ; 00F812 CD DC F6
1283:	F815  E1      		pop    hl              ; 00F815 E1
1284:	F816  7E      	RWM3:	ld     a,(hl)          ; 00F816 7E
1285:	F817  CD5CFA  		call   H2AJ3           ; 00F817 CD 5C FA
1286:	F81A  CD6DF9  		call   VALGETCHR        ; 00F81A CD 6D F9
1287:	F81D  D8      		ret    c               ; 00F81D D8
1288:	F81E  280F    		jr     z,RWM1         ; 00F81E 28 0F
1289:	F820  FE0A    		cp     $0a             ; 00F820 FE 0A
1290:	F822  280D    		jr     z,RWM2         ; 00F822 28 0D
1291:	F824  E5      		push   hl              ; 00F824 E5
1292:	F825  CDD3F6  		call   GET1HNUM           ; 00F825 CD D3 F6
1293:	F828  D1      		pop    de              ; 00F828 D1
1294:	F829  E1      		pop    hl              ; 00F829 E1
1295:	F82A  73      		ld     (hl),e          ; 00F82A 73
1296:	F82B  79      		ld     a,c             ; 00F82B 79
1297:	F82C  FE0D    		cp     $0d             ; 00F82C FE 0D
1298:	F82E  C8      		ret    z               ; 00F82E C8
1299:	F82F  23      	RWM1:	inc    hl              ; 00F82F 23
1300:	F830  23      		inc    hl              ; 00F830 23
1301:	F831  2B      	RWM2:	dec    hl              ; 00F831 2B
1302:	F832  7D      		ld     a,l             ; 00F832 7D
1303:	F833  E607    		and    $07             ; 00F833 E6 07
1304:	F835  CC63FA  		call   z,HL2ASCB         ; 00F835 CC 63 FA
1305:	F838  18DC    		jr     RWM3           ; 00F838 18 DC
1306:			;;
1307:			;; MEMTEST - test ram region
1308:	F83A          	MEMTEST:
1309:	F83A  CDABFA  		call   POP2PRM           ; 00F83A CD AB FA
1310:	F83D  7E      	MTNXT:	ld     a,(hl)          ; 00F83D 7E
1311:	F83E  F5      		push   af              ; 00F83E F5
1312:	F83F  2F      		cpl                    ; 00F83F 2F
1313:	F840  77      		ld     (hl),a          ; 00F840 77
1314:	F841  AE      		xor    (hl)            ; 00F841 AE
1315:	F842  C44CF8  		call   nz,MTERR        ; 00F842 C4 4C F8
1316:	F845  F1      		pop    af              ; 00F845 F1
1317:	F846  77      		ld     (hl),a          ; 00F846 77
1318:	F847  CD49F9  		call   CHKBRK           ; 00F847 CD 49 F9
1319:	F84A  18F1    		jr     MTNXT           ; 00F84A 18 F1
1320:	F84C  D5      	MTERR:	push   de              ; 00F84C D5
1321:	F84D  5F      		ld     e,a             ; 00F84D 5F
1322:	F84E  CD63FA  		call   HL2ASCB           ; 00F84E CD 63 FA
1323:			;;
1324:			;; BINDISP - display E in binary form
1325:			;
1326:	F851          	BINDISP:
1327:	F851  0608    		ld     b,$08           ; 00F851 06 08
1328:	F853  7B      	BDNXT:	ld     a,e             ; 00F853 7B
1329:	F854  07      		rlca                   ; 00F854 07
1330:	F855  5F      		ld     e,a             ; 00F855 5F
1331:	F856  3E18    		ld     a,$18           ; 00F856 3E 18
1332:	F858  17      		rla                    ; 00F858 17
1333:	F859  4F      		ld     c,a             ; 00F859 4F
1334:	F85A  CD68FA  		call   OUTCHR           ; 00F85A CD 68 FA
1335:	F85D  10F4    		djnz   BDNXT           ; 00F85D 10 F4
1336:	F85F  D1      		pop    de              ; 00F85F D1
1337:	F860  C9      		ret                    ; 00F860 C9
1338:			;;
1339:			;; CONIN - main keyboard input handle
1340:			;
1341:	F861  3E00    	CIRBF:	ld     a,$00           ; 00F861 3E 00
1342:	F863  322600  		ld     (KBDBYTE),a       ; 00F863 32 26 00
1343:	F866          	CONIN:	
1344:	F866  DB85    		in     a,(CRTKEYBDAT)         ; 00F866 DB 85
1345:	F868  2F      		cpl                    ; 00F868 2F
1346:	F869  CB7F    		bit    7,a             ; 00F869 CB 7F
1347:	F86B  28F4    		jr     z,CIRBF         ; 00F86B 28 F4
1348:	F86D  E5      		push   hl              ; 00F86D E5
1349:	F86E  212600  		ld     hl,KBDBYTE        ; 00F86E 21 26 00
1350:	F871  BE      		cp     (hl)            ; 00F871 BE
1351:	F872  2805    		jr     z,CIEQB         ; 00F872 28 05
1352:	F874  21FFA0  		ld     hl,$a0ff        ; 00F874 21 FF A0
1353:	F877  1803    		jr     CIPRC           ; 00F877 18 03
1354:	F879  210004  	CIEQB:	ld     hl,$0400        ; 00F879 21 00 04
1355:	F87C  F5      	CIPRC:	push   af              ; 00F87C F5
1356:	F87D  DB85    	CISTI:	in     a,(CRTKEYBDAT)         ; 00F87D DB 85
1357:	F87F  2F      		cpl                    ; 00F87F 2F
1358:	F880  CB7F    		bit    7,a             ; is still pressed?
1359:	F882  2805    		jr     z,CIGON         ; no, go on
1360:	F884  2B      		dec    hl              ; 00F884 2B
1361:	F885  7D      		ld     a,l             ; 00F885 7D
1362:	F886  B4      		or     h               ; 00F886 B4
1363:	F887  20F4    		jr     nz,CISTI        ; 00F887 20 F4
1364:	F889  F1      	CIGON:	pop    af              ; 00F889 F1
1365:	F88A  322600  		ld     (KBDBYTE),a       ; 00F88A 32 26 00
1366:	F88D  CBBF    		res    7,a             ; 00F88D CB BF
1367:	F88F  212700  		ld     hl,CIOBYTE        ; 00F88F 21 27 00
1368:	F892  CB4E    		bit    1,(hl)          ; 00F892 CB 4E
1369:	F894  214700  		ld     hl,MIOBYTE        ; 00F894 21 47 00
1370:	F897  200D    		jr     nz,CIBT1        ; 00F897 20 0D
1371:	F899  CB5E    	CILOP:	bit    3,(hl)          ; 00F899 CB 5E
1372:	F89B  E1      		pop    hl              ; 00F89B E1
1373:	F89C  C8      		ret    z               ; 00F89C C8
1374:	F89D  FE61    		cp     $61             ; 00F89D FE 61
1375:	F89F  F8      		ret    m               ; 00F89F F8
1376:	F8A0  FE7B    		cp     $7b             ; 00F8A0 FE 7B
1377:	F8A2  F0      		ret    p               ; 00F8A2 F0
1378:	F8A3  CBAF    		res    5,a             ; 00F8A3 CB AF
1379:	F8A5  C9      		ret                    ; 00F8A5 C9
1380:	F8A6  21DBF8  	CIBT1:	ld     hl,CIREN        ; 00F8A6 21 DB F8
1381:	F8A9  E5      		push   hl              ; 00F8A9 E5
1382:	F8AA  214700  		ld     hl,MIOBYTE        ; 00F8AA 21 47 00
1383:	F8AD  FE5E    		cp     $5e             ; test == ^
1384:	F8AF  2003    		jr     nz,CITC1        ; 00F8AF 20 03
1385:	F8B1  CBDE    		set    3,(hl)          ; 00F8B1 CB DE
1386:	F8B3  C9      		ret                    ; 00F8B3 C9
1387:	F8B4  FE5C    	CITC1:	cp     $5c             ; test == \
1388:	F8B6  2003    		jr     nz,CITC2        ; 00F8B6 20 03
1389:	F8B8  CB9E    		res    3,(hl)          ; 00F8B8 CB 9E
1390:	F8BA  C9      		ret                    ; 00F8BA C9
1391:	F8BB  FE07    	CITC2:	cp     $07             ; test == CTRL+G
1392:	F8BD  CA40FF  		jp     z,CIGRTOG         ; 00F8BD CA 40 FF
1393:	F8C0  FE05    		cp     $05             ; test ==CTRL+E
1394:	F8C2  CA9BFD  		jp     z,LINDN         ; 00F8C2 CA 9B FD
1395:	F8C5  FE13    		cp     $13             ; test == CTRL+S
1396:	F8C7  CADFF8  		jp     z,CIHCR         ; 00F8C7 CA DF F8 
1397:	F8CA  FE04    		cp     $04             ; test == CTRL+D
1398:	F8CC  CA4EFB  		jp     z,CURRGT         ; 00F8CC CA 4E FB
1399:	F8CF  FE18    		cp     $18             ; test == CTRL+X
1400:	F8D1  CA13FD  		jp     z,IOCSY2         ; 00F8D1 CA 13 FD
1401:	F8D4  E1      		pop    hl              ; 00F8D4 E1
1402:	F8D5  214700  		ld     hl,MIOBYTE        ; 00F8D5 21 47 00
1403:	F8D8  C303F9  		jp     CISTP           ; 00F8D8 C3 03 F9
1404:	F8DB  E1      	CIREN:	pop    hl              ; 00F8DB E1
1405:	F8DC  C366F8  		jp     CONIN           ; 00F8DC C3 66 F8
1406:	F8DF  212700  	CIHCR:	ld     hl,CIOBYTE        ; 00F8DF 21 27 00
1407:	F8E2  7E      		ld     a,(hl)          ; 00F8E2 7E
1408:	F8E3  F5      		push   af              ; 00F8E3 F5
1409:	F8E4  E5      		push   hl              ; 00F8E4 E5
1410:	F8E5  CBE6    		set    4,(hl)          ; 00F8E5 CB E6
1411:	F8E7  CD46FC  		call   IOCBS           ; 00F8E7 CD 46 FC
1412:	F8EA  E1      		pop    hl              ; 00F8EA E1
1413:	F8EB  F1      		pop    af              ; 00F8EB F1
1414:	F8EC  77      		ld     (hl),a          ; 00F8EC 77
1415:	F8ED  C9      		ret                    ; 00F8ED C9
1416:	F8EE          	CIJP3:
1417:	F8EE  2A4800  		ld     hl,(CURPBUF)      ; 00F8EE 2A 48 00
1418:	F8F1  EB      		ex     de,hl           ; 00F8F1 EB
1419:	F8F2  AF      		xor    a               ; 00F8F2 AF
1420:	F8F3  ED52    		sbc    hl,de           ; 00F8F3 ED 52
1421:	F8F5  115000  		ld     de,$0050        ; 00F8F5 11 50 00
1422:	F8F8  AF      	CIJP4:	xor    a               ; 00F8F8 AF
1423:	F8F9  ED52    		sbc    hl,de           ; 00F8F9 ED 52
1424:	F8FB  30FB    		jr     nc,CIJP4        ; 00F8FB 30 FA
1425:	F8FD  19      		add    hl,de           ; 00F8FD 19
1426:	F8FE  7D      		ld     a,l             ; 00F8FE 7D
1427:	F8FF  322900  		ld     (COLBUF),a       ; 00F8FF 32 29 00
1428:	F902  C9      		ret                    ; 00F902 C9
1429:			;
1430:	F903  F5      	CISTP:	push   af              ; 00F903 F5
1431:	F904  D5      		push   de              ; 00F904 D5
1432:	F905  CDE7F7  		call   CIJP1           ; 00F905 CD E7 F7
1433:	F908  D1      		pop    de              ; 00F908 D1
1434:	F909  F1      		pop    af              ; 00F909 F1
1435:	F90A  C399F8  		jp     CILOP           ; 00F90A C3 99 F8
1436:	F90D  00      		nop                    ; 00F90D 00
1437:			;;
1438:			;; SET DISPLAY START ADDRESS
1439:			;	
1440:	F90E          	SDSTA:
1441:	F90E  3E0C    		ld     a,$0c           ; 00F90E 3E 0C
1442:	F910  D38C    		out    (CRT6545ADST),a         ; 00F910 D3 8C
1443:	F912  7C      		ld     a,h             ; 00F912 7C
1444:	F913  D38D    		out    (CRT6545DATA),a         ; 00F913 D3 8D
1445:	F915  3E0D    		ld     a,$0d           ; 00F915 3E 0D
1446:	F917  D38C    		out    (CRT6545ADST),a         ; 00F917 D3 8C
1447:	F919  7D      		ld     a,l             ; 00F919 7D
1448:	F91A  D38D    		out    (CRT6545DATA),a         ; 00F91A D3 8D
1449:	F91C  3E1F    		ld     a,$1f           ; 00F91C 3E 1F
1450:	F91E  D38C    		out    (CRT6545ADST),a         ; 00F91E D3 8C
1451:	F920  C9      		ret                    ; 00F920 C9
1452:			;;
1453:	F921  00      		nop                    ; 00F921 00
1454:	F922  00      		nop                    ; 00F922 00
1455:	F923  00      		nop                    ; 00F923 00
1456:	F924  00      		nop                    ; 00F924 00
1457:			;;
1458:			;; DOPROMPT - display prompt and wait for first key (uppercase)
1459:			;
1460:	F925          	DOPROMPT:
1461:	F925  CD5FFA  		call   MPROMPT           ; 00F925 CD 5F FA
1462:	F928          	DOGETCHR:
1463:	F928  CD89FA  		call   COIUPC           ; 00F928 CD 89 FA
1464:	F92B  C5      	COUTCH:	push   bc              ; 00F92B C5
1465:	F92C  4F      		ld     c,a             ; 00F92C 4F
1466:	F92D  CD68FA  		call   OUTCHR           ; 00F92D CD 68 FA
1467:	F930  79      		ld     a,c             ; 00F930 79
1468:	F931  C1      		pop    bc              ; 00F931 C1
1469:	F932  C9      		ret                    ; 00F932 C9
1470:			;
1471:	F933          	POP3NUM:
1472:	F933  04      		inc    b               ; 00F933 04
1473:	F934  CDDEF6  		call   GETHNUM           ; 00F934 CD DE F6
1474:	F937  C1      		pop    bc              ; 00F937 C1
1475:	F938  D1      		pop    de              ; 00F938 D1
1476:	F939  C3B1FA  		jp     OCRLF1           ; 00F939 C3 B1 FA
1477:			;;	
1478:	F93C          	CHKEOR:
1479:	F93C  23      		inc    hl              ; 00F93C 23
1480:	F93D  7C      		ld     a,h             ; 00F93D 7C
1481:	F93E  B5      		or     l               ; 00F93E B5
1482:	F93F  37      		scf                    ; 00F93F 37
1483:	F940  C8      		ret    z               ; 00F940 C8	
1484:	F941  7B      		ld     a,e             ; 00F941 7B
1485:	F942  95      		sub    l               ; 00F942 95
1486:	F943  7A      		ld     a,d             ; 00F943 7A
1487:	F944  9C      		sbc    a,h             ; 00F944 9C
1488:	F945  C9      		ret                    ; 00F945 C9
1489:			;;
1490:	F946  D1      	CBKEND:	pop    de              ; 00F946 D1
1491:	F947  C9      		ret                    ; 00F947 C9
1492:			;;
1493:			;; inc pointer BC and check kbd
1494:	F948          	IPTRCKBD:
1495:	F948  03      		inc    bc              ; 00F948 03
1496:			;;	
1497:	F949          	CHKBRK:
1498:	F949  CD3CF9  		call   CHKEOR           ; 00F949 CD 3C F9
1499:	F94C  38F8    		jr     c,CBKEND         ; 00F94C 38 F8
1500:	F94E  CDB9FA  		call   CHKKBD           ; 00F94E CD B9 FA
1501:	F951  B7      		or     a               ; 00F951 B7
1502:	F952  C8      		ret    z               ; 00F952 C8
1503:	F953  CD89FA  		call   COIUPC           ; 00F953 CD 89 FA
1504:	F956  FE13    		cp     $13             ; 00F956 FE 13
1505:	F958  20EC    		jr     nz,CBKEND        ; 00F958 20 EC
1506:	F95A  C389FA  		jp     COIUPC           ; 00F95A C3 89 FA
1507:			;;
1508:			;; CHKHEX - check for hex ascii char in A
1509:			;
1510:	F95D          	CHKHEX:
1511:	F95D  D630    		sub    $30             ; 00F95D D6 30
1512:	F95F  D8      		ret    c               ; 00F95F D8
1513:	F960  FE17    		cp     $17             ; 00F960 FE 17
1514:	F962  3F      		ccf                    ; 00F962 3F
1515:	F963  D8      		ret    c               ; 00F963 D8
1516:	F964  FE0A    		cp     $0a             ; 00F964 FE 0A
1517:	F966  3F      		ccf                    ; 00F966 3F
1518:	F967  D0      		ret    nc              ; 00F967 D0
1519:	F968  D607    		sub    $07             ; 00F968 D6 07
1520:	F96A  FE0A    		cp     $0a             ; 00F96A FE 0A
1521:	F96C  C9      		ret                    ; 00F96C C9
1522:			;; get chr and validate
1523:	F96D          	VALGETCHR:
1524:	F96D  CD28F9  		call   DOGETCHR           ; 00F96D CD 28 F9
1525:			;; 
1526:			;; CHKCTR: check for valid char in string (space,comma,<CR>)
1527:			;
1528:	F970          	CHKCTR:
1529:	F970  FE20    		cp     $20             ; 00F970 FE 20
1530:	F972  C8      		ret    z               ; 00F972 C8
1531:	F973  FE2C    		cp     $2c             ; 00F973 FE 2C
1532:	F975  C8      		ret    z               ; 00F975 C8
1533:	F976  FE0D    		cp     $0d             ; 00F976 FE 0D
1534:	F978  37      		scf                    ; 00F978 37
1535:	F979  C8      		ret    z               ; 00F979 C8
1536:	F97A  3F      		ccf                    ; 00F97A 3F
1537:	F97B  C9      		ret                    ; 00F97B C9
1538:	F97C  E5      		push   hl              ; 00F97C E5
1539:	F97D  D5      		push   de              ; 00F97D D5
1540:	F97E  C5      		push   bc              ; 00F97E C5
1541:	F97F  F5      		push   af              ; 00F97F F5
1542:	F980  CD7CF6  		call   FMEMSIZ           ; 00F980 CD 7C F6
1543:	F983  EB      		ex     de,hl           ; 00F983 EB
1544:	F984  210A00  		ld     hl,$000a        ; 00F984 21 0A 00
1545:	F987  39      		add    hl,sp           ; 00F987 39
1546:	F988  0604    		ld     b,$04           ; 00F988 06 04
1547:	F98A  EB      		ex     de,hl           ; 00F98A EB
1548:	F98B  2B      		dec    hl              ; 00F98B 2B
1549:	F98C  72      		ld     (hl),d          ; 00F98C 72
1550:	F98D  2B      		dec    hl              ; 00F98D 2B
1551:	F98E  73      		ld     (hl),e          ; 00F98E 73
1552:	F98F  D1      		pop    de              ; 00F98F D1
1553:	F990  10F9    		djnz   $f98b           ; 00F990 10 F9
1554:	F992  C1      		pop    bc              ; 00F992 C1
1555:	F993  0B      		dec    bc              ; 00F993 0B
1556:	F994  F9      		ld     sp,hl           ; 00F994 F9
1557:	F995  212500  		ld     hl,$0025        ; 00F995 21 25 00
1558:	F998  39      		add    hl,sp           ; 00F998 39
1559:	F999  D5      		push   de              ; 00F999 D5
1560:	F99A  1602    		ld     d,$02           ; 00F99A 16 02
1561:	F99C  7E      		ld     a,(hl)          ; 00F99C 7E
1562:	F99D  91      		sub    c               ; 00F99D 91
1563:	F99E  23      		inc    hl              ; 00F99E 23
1564:	F99F  7E      		ld     a,(hl)          ; 00F99F 7E
1565:	F9A0  98      		sbc    a,b             ; 00F9A0 98
1566:	F9A1  2806    		jr     z,$f9a9         ; 00F9A1 28 06
1567:	F9A3  23      		inc    hl              ; 00F9A3 23
1568:	F9A4  23      		inc    hl              ; 00F9A4 23
1569:	F9A5  15      		dec    d               ; 00F9A5 15
1570:	F9A6  20F4    		jr     nz,$f99c        ; 00F9A6 20 F4
1571:	F9A8  03      		inc    bc              ; 00F9A8 03
1572:	F9A9  212000  		ld     hl,$0020        ; 00F9A9 21 20 00
1573:	F9AC  D1      		pop    de              ; 00F9AC D1
1574:	F9AD  39      		add    hl,sp           ; 00F9AD 39
1575:	F9AE  73      		ld     (hl),e          ; 00F9AE 73
1576:	F9AF  23      		inc    hl              ; 00F9AF 23
1577:	F9B0  72      		ld     (hl),d          ; 00F9B0 72
1578:	F9B1  C5      		push   bc              ; 00F9B1 C5
1579:	F9B2  0E2A    		ld     c,$2a           ; 00F9B2 0E 2A
1580:	F9B4  CD68FA  		call   OUTCHR           ; 00F9B4 CD 68 FA
1581:	F9B7  D1      		pop    de              ; 00F9B7 D1
1582:	F9B8  3EE5    		ld     a,$e5           ; 00F9B8 3E E5
1583:	F9BA  BA      		cp     d               ; 00F9BA BA
1584:	F9BB  2809    		jr     z,$f9c6         ; 00F9BB 28 09
1585:	F9BD  23      		inc    hl              ; 00F9BD 23
1586:	F9BE  23      		inc    hl              ; 00F9BE 23
1587:	F9BF  73      		ld     (hl),e          ; 00F9BF 73
1588:	F9C0  23      		inc    hl              ; 00F9C0 23
1589:	F9C1  72      		ld     (hl),d          ; 00F9C1 72
1590:	F9C2  EB      		ex     de,hl           ; 00F9C2 EB
1591:	F9C3  CD49FA  		call   $fa49           ; 00F9C3 CD 49 FA
1592:	F9C6  212500  		ld     hl,$0025        ; 00F9C6 21 25 00
1593:	F9C9  39      		add    hl,sp           ; 00F9C9 39
1594:	F9CA  010002  		ld     bc,$0200        ; 00F9CA 01 00 02
1595:	F9CD  5E      		ld     e,(hl)          ; 00F9CD 5E
1596:	F9CE  71      		ld     (hl),c          ; 00F9CE 71
1597:	F9CF  23      		inc    hl              ; 00F9CF 23
1598:	F9D0  56      		ld     d,(hl)          ; 00F9D0 56
1599:	F9D1  71      		ld     (hl),c          ; 00F9D1 71
1600:	F9D2  23      		inc    hl              ; 00F9D2 23
1601:	F9D3  7B      		ld     a,e             ; 00F9D3 7B
1602:	F9D4  B2      		or     d               ; 00F9D4 B2
1603:	F9D5  2802    		jr     z,$f9d9         ; 00F9D5 28 02
1604:	F9D7  7E      		ld     a,(hl)          ; 00F9D7 7E
1605:	F9D8  12      		ld     (de),a          ; 00F9D8 12
1606:	F9D9  23      		inc    hl              ; 00F9D9 23
1607:	F9DA  10F1    		djnz   $f9cd           ; 00F9DA 10 F1
1608:	F9DC  08      		ex     af,af'          ; 00F9DC 08
1609:	F9DD  D9      		exx                    ; 00F9DD D9
1610:	F9DE  E5      		push   hl              ; 00F9DE E5
1611:	F9DF  D5      		push   de              ; 00F9DF D5
1612:	F9E0  C5      		push   bc              ; 00F9E0 C5
1613:	F9E1  F5      		push   af              ; 00F9E1 F5
1614:	F9E2  DDE5    		push   ix              ; 00F9E2 DD E5
1615:	F9E4  FDE5    		push   iy              ; 00F9E4 FD E5
1616:	F9E6  ED57    		ld     a,i             ; 00F9E6 ED 57
1617:	F9E8  47      		ld     b,a             ; 00F9E8 47
1618:	F9E9  ED5F    		ld     a,r             ; 00F9E9 ED 5F
1619:	F9EB  4F      		ld     c,a             ; 00F9EB 4F
1620:	F9EC  C5      		push   bc              ; 00F9EC C5
1621:	F9ED  C307F3  		jp     $f307           ; 00F9ED C3 07 F3
1622:	F9F0  E5      		push   hl              ; 00F9F0 E5
1623:	F9F1  CF      		rst    08h             ; 00F9F1 CF
1624:			;;
1625:			;; Questo blocco di istruzioni viene copiato nell'ultima pagina di memoria ram
1626:			;; nei suoi ultimi byte (dfdd della pagina df00-dfff)
1627:			;; ... perche'???
1628:			;
1629:	F9F2          	RAMBLK:
1630:	F9F2  C1      		pop    bc              ; 00F9F2 C1
1631:	F9F3  79      		ld     a,c             ; 00F9F3 79
1632:	F9F4  ED4F    		ld     r,a             ; 00F9F4 ED 4F
1633:	F9F6  78      		ld     a,b             ; 00F9F6 78
1634:	F9F7  ED47    		ld     i,a             ; 00F9F7 ED 47
1635:	F9F9  DDE1    		pop    ix              ; 00F9F9 DD E1
1636:	F9FB  FDE1    		pop    iy              ; 00F9FB FD E1
1637:	F9FD  F1      		pop    af              ; 00F9FD F1
1638:	F9FE  C1      		pop    bc              ; 00F9FE C1
1639:	F9FF  D1      		pop    de              ; 00F9FF D1
1640:	FA00  E1      		pop    hl              ; 00FA00 E1
1641:	FA01  08      		ex     af,af'          ; 00FA01 08
1642:	FA02  D9      		exx                    ; 00FA02 D9
1643:	FA03  D1      		pop    de              ; 00FA03 D1
1644:	FA04  C1      		pop    bc              ; 00FA04 C1
1645:	FA05  F1      		pop    af              ; 00FA05 F1
1646:	FA06  E1      		pop    hl              ; 00FA06 E1
1647:	FA07  F9      		ld     sp,hl           ; 00FA07 F9
1648:	FA08  00      		nop                    ; 00FA08 00
1649:	FA09  210000  		ld     hl,$0000        ; 00FA09 21 00 00
1650:	FA0C  C30000  		jp     $0000           ; 00FA0C C3 00 00
1651:			;
1652:			;; User command reject string
1653:	FA0F          	URESTR:
1654:	FA0F  AA      		db     $aa               ; 00FA0F AA
1655:			;
1656:			;; TOGPRNIO - toggle i/o on prn/crt
1657:	FA10          	TOGPRNIO:
1658:	FA10  214700  		ld     hl,MIOBYTE        ; 00FA10 21 47 00
1659:	FA13  CB66    		bit    4,(hl)          ; 00FA13 CB 66
1660:	FA15  2804    		jr     z,TOGPR         ; 00FA15 28 04
1661:	FA17  CBA6    		res    4,(hl)          ; 00FA17 CB A6
1662:	FA19  1802    		jr     TOGJU           ; 00FA19 18 02
1663:	FA1B  CBE6    	TOGPR:	set    4,(hl)          ; 00FA1B CB E6
1664:	FA1D  C303F7  	TOGJU:	jp     USRCMD           ; 00FA1D C3 03 F7
1665:			;;
1666:			;; SCRTST - Verify uf we need video scroll
1667:			;
1668:	FA20          	SCRTST:	
1669:	FA20  ED5B4800		ld     de,(CURPBUF)      ; 00FA20 ED 5B 48 00
1670:	FA24  AF      		xor    a               ; 00FA24 AF
1671:	FA25  ED52    		sbc    hl,de           ; 00FA25 ED 52
1672:	FA27  7C      		ld     a,h             ; 00FA27 7C
1673:	FA28  FE07    		cp     $07             ; 00FA28 FE 07
1674:	FA2A  D8      		ret    c               ; 00FA2A D8
1675:	FA2B  7D      		ld     a,l             ; 00FA2B 7D
1676:	FA2C  FECF    		cp     $cf             ; 00FA2C FE CF
1677:	FA2E  C9      		ret                    ; 00FA2E C9
1678:			;
1679:	FA2F  00      		nop                    ; 00FA2F 00
1680:	FA30  B7      		or     a               ; 00FA30 B7
1681:	FA31  7C      		ld     a,h             ; 00FA31 7C
1682:	FA32  1F      		rra                    ; 00FA32 1F
1683:	FA33  67      		ld     h,a             ; 00FA33 67
1684:	FA34  7D      		ld     a,l             ; 00FA34 7D
1685:	FA35  1F      		rra                    ; 00FA35 1F
1686:	FA36  6F      		ld     l,a             ; 00FA36 6F
1687:	FA37  C9      		ret                    ; 00FA37 C9
1688:			;;
1689:			;; CALCHLDE - perform 16 bit add & sub between HL and DE
1690:			;
1691:	FA38          	CALCHLDE:
1692:	FA38  CDABFA  		call   POP2PRM           ; 00FA38 CD AB FA
1693:	FA3B  E5      		push   hl              ; 00FA3B E5
1694:	FA3C  19      		add    hl,de           ; 00FA3C 19
1695:	FA3D  CD63FA  		call   HL2ASCB           ; 00FA3D CD 63 FA
1696:	FA40  E1      		pop    hl              ; 00FA40 E1
1697:	FA41  B7      		or     a               ; 00FA41 B7
1698:	FA42  ED52    		sbc    hl,de           ; 00FA42 ED 52
1699:	FA44  1803    		jr     $fa49           ; 00FA44 18 03
1700:			;;	
1701:			;; HL2ASC - convert & display HL 2 ascii
1702:	FA46          	HL2ASC:
1703:	FA46  CDB0FA  		call   OUTCRLF           ; 00FA46 CD B0 FA
1704:	FA49  7C      		ld     a,h             ; 00FA49 7C
1705:	FA4A  CD4EFA  		call   H2AJ1           ; 00FA4A CD 4E FA
1706:	FA4D  7D      		ld     a,l             ; 00FA4D 7D
1707:	FA4E  F5      	H2AJ1:	push   af              ; 00FA4E F5
1708:	FA4F  0F      		rrca                   ; 00FA4F 0F
1709:	FA50  0F      		rrca                   ; 00FA50 0F
1710:	FA51  0F      		rrca                   ; 00FA51 0F
1711:	FA52  0F      		rrca                   ; 00FA52 0F
1712:	FA53  CD57FA  		call   H2AJ2           ; 00FA53 CD 57 FA
1713:	FA56  F1      		pop    af              ; 00FA56 F1
1714:	FA57  CDE0FD  	H2AJ2:	call   NIB2ASC           ; 00FA57 CD E0 FD
1715:	FA5A  180C    		jr     OUTCHR           ; 00FA5A 18 0C
1716:	FA5C  CD4EFA  	H2AJ3:	call   H2AJ1           ; entry point to display HEX and a "-"
1717:	FA5F          	MPROMPT:
1718:	FA5F  0E2D    		ld     c,$2d           ; 00FA5F 0E 2D
1719:	FA61  1805    		jr     OUTCHR           ; 00FA61 18 05
1720:			;;	
1721:			;; HL2ASCB - convert & display HL 2 ascii leave a blank after
1722:	FA63          	HL2ASCB:
1723:	FA63  CD46FA  		call   HL2ASC           ; 00FA63 CD 46 FA
1724:	FA66  0E20    	SPACER:	ld     c,$20           ; 00FA66 0E 20
1725:			;;
1726:			;; OUTCHR - send a char to the output
1727:			;; switch CRT/PRINTER depending of bit 4 of MIOBYTE
1728:			;
1729:	FA68          	OUTCHR:
1730:	FA68  3A4700  		ld     a,(MIOBYTE)       ; 00FA68 3A 47 00
1731:	FA6B  CB67    		bit    4,a             ; 00FA6B CB 67
1732:	FA6D  2803    		jr     z,OCJPV         ; 00FA6D 28 03
1733:	FA6F  CD3CF0  		call   JPRNCH           ; 00FA6F CD 3C F0
1734:	FA72          	OCJPV:
1735:	FA72  C306F0  		jp     JCONOU           ; 00FA72 C3 06 F0
1736:			;;
1737:			;; PRNCHR - send a char to printer port (from C)
1738:			;
1739:	FA75          	PRNCHR:
1740:	FA75  DB89    		in     a,(CRTSERVDAT)         ; 00FA75 DB 89
1741:	FA77  CB47    		bit    PRNTBUSYBIT,a             ; 00FA77 CB 47
1742:	FA79  20FA    		jr     nz,PRNCHR        ; 00FA79 20 FA
1743:	FA7B  79      		ld     a,c             ; 00FA7B 79
1744:	FA7C  D381    		out    (CRTPRNTDAT),a         ; 00FA7C D3 81
1745:	FA7E  C9      		ret                    ; 00FA7E C9
1746:			;;
1747:	FA7F  00      		nop                    ; 00FA7F 00
1748:	FA80  00      		nop                    ; 00FA80 00
1749:	FA81  00      		nop                    ; 00FA81 00
1750:	FA82  00      		nop                    ; 00FA82 00
1751:	FA83  00      		nop                    ; 00FA83 00
1752:	FA84  00      		nop                    ; 00FA84 00
1753:	FA85  00      		nop                    ; 00FA85 00
1754:	FA86  00      		nop                    ; 00FA86 00
1755:	FA87  00      		nop                    ; 00FA87 00
1756:	FA88  00      		nop                    ; 00FA88 00
1757:			;;
1758:			;; COIUPC- convert reg A uppercase
1759:	FA89          	COIUPC:
1760:	FA89  CD03F0  		call   JCONIN           ; 00FA89 CD 03 F0
1761:	FA8C  FE60    		cp     $60             ; 00FA8C FE 60
1762:	FA8E  FA98FA  		jp     m,COIRE         ; 00FA8E FA 98 FA
1763:	FA91  FE7B    		cp     $7b             ; 00FA91 FE 7B
1764:	FA93  F298FA  		jp     p,COIRE         ; 00FA93 F2 98 FA
1765:	FA96  CBAF    		res    5,a             ; 00FA96 CB AF
1766:	FA98  C9      	COIRE:	ret                    ; 00FA98 C9
1767:			;;
1768:			;; 
1769:			;; GREET - ...comes here from boot...
1770:			;
1771:	FA99          	GREET:
1772:	FA99  CDB0FA  		call   OUTCRLF           ; 00FA99 CD B0 FA
1773:			;;
1774:			;; CONSTR print a string using OUTCHR -> CONOUT
1775:	FA9C          	CONSTR:
1776:	FA9C  C5      		push   bc              ; 00FA9C C5
1777:	FA9D  4E      	CSLP0:	ld     c,(hl)          ; 00FA9D 4E
1778:	FA9E  46      		ld     b,(hl)          ; 00FA9E 46
1779:	FA9F  CBB9    		res    7,c             ; 00FA9F CB B9
1780:	FAA1  CD68FA  		call   OUTCHR           ; 00FAA1 CD 68 FA
1781:	FAA4  23      		inc    hl              ; 00FAA4 23
1782:	FAA5  78      		ld     a,b             ; 00FAA5 78
1783:	FAA6  07      		rlca                   ; 00FAA6 07
1784:	FAA7  30F4    		jr     nc,CSLP0        ; 00FAA7 30 F4
1785:	FAA9  C1      		pop    bc              ; 00FAA9 C1
1786:	FAAA  C9      		ret                    ; 00FAAA C9
1787:			;;
1788:	FAAB          	POP2PRM:
1789:	FAAB  CDDEF6  		call   GETHNUM           ; 00FAAB CD DE F6
1790:	FAAE  D1      		pop    de              ; 00FAAE D1
1791:	FAAF  E1      		pop    hl              ; 00FAAF E1
1792:			;;
1793:			;; OUTCRLF - CR/LF through CONOUT
1794:			;
1795:	FAB0          	OUTCRLF:
1796:	FAB0  E5      		push   hl              ; 00FAB0 E5
1797:	FAB1  2102F6  	OCRLF1:	ld     hl,CRLFTAB        ; 00FAB1 21 02 F6
1798:	FAB4  CD9CFA  		call   CONSTR           ; 00FAB4 CD 9C FA
1799:	FAB7  E1      		pop    hl              ; 00FAB7 E1
1800:	FAB8  C9      		ret                    ; 00FAB8 C9
1801:			;;
1802:	FAB9          	CHKKBD:
1803:	FAB9  DB85    		in     a,(CRTKEYBDAT)         ; 00FAB9 DB 85
1804:	FABB  2F      		cpl                    ; 00FABB 2F
1805:	FABC  CB7F    		bit    7,a             ; 00FABC CB 7F
1806:	FABE  3E00    		ld     a,$00           ; 00FABE 3E 00
1807:	FAC0  1845    		jr     CHKKBDJ           ; 00FAC0 18 45
1808:			;;
1809:	FAC2          	BLOOP:
1810:	FAC2  0602    		ld     b,$02           ; 00FAC2 06 02
1811:	FAC4  CD89FA  	BLP1:	call   COIUPC           ; 00FAC4 CD 89 FA
1812:	FAC7  FE07    		cp     $07             ; 00FAC7 FE 07
1813:	FAC9  20F7    		jr     nz,BLOOP        ; 00FAC9 20 F7
1814:	FACB  CD2BF9  		call   COUTCH           ; 00FACB CD 2B F9
1815:	FACE  10F4    		djnz   BLP1           ; 00FACE 10 F4
1816:	FAD0  C9      		ret                    ; 00FAD0 C9
1817:			;
1818:	FAD1  00      		nop                    ; 00FAD1 00
1819:	FAD2          	UCMDTAB:
1820:	FAD2  FDF6    		dw     UCREJ           ; (A) n/a
1821:	FAD4  33F0    		dw     JCPMBO          ; (B) cp/m boot
1822:	FAD6  FDF6    		dw     UCREJ           ; (C) n/a
1823:	FAD8  57F7    		dw     MEMDUMP         ; (D) dump memory
1824:	FADA  FDF6    		dw     UCREJ           ; (E) n/a
1825:	FADC  30F7    		dw     FILLMEM         ; (F) fill memory
1826:	FADE  A8F7    		dw     GOEXEC          ; (G) go exec a sub
1827:	FAE0  38FA    		dw     CALCHLDE        ; (H) sum & subtract HL, DE
1828:	FAE2  F8F7    		dw     PORTIN          ; (I) port input
1829:	FAE4  C8F5    		dw     INIT0           ; (J) init, clear screen
1830:	FAE6  00F0    		dw     JBOOT           ; (K) restart system
1831:	FAE8  74F5    		dw     FLOPPYREAD      ; (L) read floppy,track,sec to ram
1832:	FAEA  08F8    		dw     MEMMOVE         ; (M) move memory block
1833:	FAEC  B5F5    		dw     NEDOSINI           ; (N)
1834:	FAEE  00F8    		dw     PORTOUT         ; (O) output to a port
1835:	FAF0  10FA    		dw     TOGPRNIO        ; (P) toggle prn/crt i/o
1836:	FAF2  FDF6    		dw     UCREJ           ; (Q) n/a
1837:	FAF4  7BF5    		dw     FLOPPYWRIT      ; (R) write floppy,track,sec to ram
1838:	FAF6  12F8    		dw     RWMEM           ; (S) alter memory
1839:	FAF8  3AF8    		dw     MEMTEST         ; (T) test ram region
1840:	FAFA  FDF6    		dw     UCREJ           ; (U) n/a
1841:	FAFC  3CF7    		dw     MEMCOMP         ; (V) compare mem blocks
1842:	FAFE  FDF6    		dw     UCREJ           ; (W) n/a
1843:	FB00  FDF6    		dw     UCREJ           ; (X) n/a
1844:	FB02  06F6    		dw     INICRTREG       ; (Y) reinit 6545
1845:	FB04  C2FA    		dw     BLOOP           ; (Z)
1846:			;;
1847:	FB06  00      		nop                    ; 00FB06 00
1848:			;
1849:	FB07          	CHKKBDJ:
1850:	FB07  C8      		ret z                  ; 00FB07 C8
1851:	FB08  2F      		cpl                    ; 00FB08 2F
1852:	FB09  C9      		ret                    ; 00FB09 C9
1853:			;	
1854:	FB0A  00      		nop                    ; 00FB0A 00
1855:	FB0B  00      		nop                    ; 00FB0B 00
1856:	FB0C  00      		nop                    ; 00FB0C 00
1857:	FB0D  00      		nop                    ; 00FB0D 00
1858:	FB0E  00      		nop                    ; 00FB0E 00
1859:	FB0F  00      		nop                    ; 00FB0F 00
1860:			;;
1861:			;; CONOUT print out the char in reg C
1862:			;
1863:	FB10          	CONOUT:
1864:	FB10  F5      		push   af              ; 00FB10 F5
1865:	FB11  C5      		push   bc              ; 00FB11 C5
1866:	FB12  D5      		push   de              ; 00FB12 D5
1867:	FB13  E5      		push   hl              ; 00FB13 E5
1868:				; force jump to register restore and exit in stack
1869:	FB14  21DEFB  		ld     hl,VCRESREG        ; 00FB14 21 DE FB
1870:	FB17  E5      		push   hl              ; 00FB17 E5
1871:	FB18  00      		nop                    ; 00FB18 00
1872:	FB19  00      		nop                    ; 00FB19 00
1873:	FB1A  00      		nop                    ; 00FB1A 00
1874:	FB1B  00      		nop                    ; 00FB1B 00
1875:	FB1C  00      		nop                    ; 00FB1C 00
1876:	FB1D  00      		nop                    ; 00FB1D 00
1877:	FB1E  00      		nop                    ; 00FB1E 00
1878:	FB1F  00      		nop                    ; 00FB1F 00
1879:	FB20  79      		ld     a,c             ; 00FB20 79
1880:	FB21  212700  		ld     hl,CIOBYTE        ; 00FB21 21 27 00
1881:			;; bit 7 ??
1882:	FB24  CB7E    		bit    7,(hl)          ; 00FB24 CB 7E
1883:	FB26  EB      		ex     de,hl           ; 00FB26 EB
1884:	FB27  C298FB  		jp     nz,CONOU2        ; 00FB27 C2 98 FB
1885:	FB2A  FE20    		cp     $20             ; is less then 0x20 (space)
1886:	FB2C  300E    		jr     nc,COJP1        ; no..
1887:	FB2E  2100FE  		ld     hl,IOCVEC        ; 00FB2E 21 00 FE
1888:	FB31  85      		add    a,l             ; 00FB31 85
1889:	FB32  6F      		ld     l,a             ; 00FB32 6F
1890:	FB33  4E      		ld     c,(hl)          ; 00FB33 4E
1891:	FB34  0600    		ld     b,$00           ; 00FB34 06 00
1892:	FB36  B7      		or     a               ; 00FB36 B7
1893:	FB37  2130FC  		ld     hl,IOCBASE        ; 00FB37 21 30 FC
1894:	FB3A  09      		add    hl,bc           ; 00FB3A 09
1895:	FB3B  E9      		jp     (hl)            ; jump to IOCVEC handler
1896:	FB3C  EB      	COJP1:	ex     de,hl           ; 00FB3C EB
1897:	FB3D  CB76    		bit    6,(hl)          ; 00FB3D CB 76 bit 6 set mean convert to uppercase
1898:	FB3F  280A    		jr     z,COJP2         ; 00FB3F 28 0A
1899:	FB41  FE40    		cp     $40             ; 00FB41 FE 40 less then 64 ?
1900:	FB43  3806    		jr     c,COJP2         ; 00FB43 38 06
1901:	FB45  FE60    		cp     $60             ; 00FB45 FE 60 great then 96 ?
1902:	FB47  3002    		jr     nc,COJP2        ; 00FB47 30 02
1903:	FB49  D640    		sub    $40             ; 00FB49 D6 40 convert to upper
1904:	FB4B  CDD0F7  	COJP2:	call   DISPCH           ; 00FB4B CD D0 F7
1905:				; move cursor right
1906:	FB4E          	CURRGT:
1907:	FB4E  CDB0F7  		call   GDCUA           ; 00FB4E CD B0 F7
1908:	FB51  CD60F0  		call   SDCUAE           ; 00FB51 CD 60 F0
1909:	FB54  3A2900  		ld     a,(COLBUF)       ; 00FB54 3A 29 00
1910:	FB57  3C      		inc    a               ; 00FB57 3C
1911:	FB58  FE50    		cp     $50             ; 00FB58 FE 50
1912:	FB5A  2804    		jr     z,MOVDN         ; 00FB5A 28 04
1913:			;;	
1914:	FB5C          	SAVCOLB:
1915:	FB5C  322900  		ld     (COLBUF),a       ; 00FB5C 32 29 00
1916:	FB5F  C9      		ret                    ; 00FB5F C9
1917:			;;
1918:			;; MOVDN: down one line, scroll, home, clreol
1919:			;
1920:	FB60          	MOVDN:
1921:	FB60  AF      		xor    a               ; 00FB60 AF
1922:	FB61  322900  		ld     (COLBUF),a       ; 00FB61 32 29 00
1923:	FB64  CD20FA  	MOVDN1:	call   SCRTST           ; 00FB64 CD 20 FA
1924:	FB67  D8      		ret    c               ; 00FB67 D8
1925:	FB68  212700  		ld     hl,CIOBYTE        ; 00FB68 21 27 00
1926:	FB6B  CB56    		bit    2,(hl)          ; 00FB6B CB 56
1927:	FB6D  1130F8  		ld     de,$f830        ; 00FB6D 11 30 F8
1928:	FB70  CDB0F7  		call   GDCUA           ; 00FB70 CD B0 F7
1929:	FB73  2B      		dec    hl              ; 00FB73 2B
1930:	FB74  2804    		jr     z,MDJMP0         ; 00FB74 28 04
1931:	FB76  19      		add    hl,de           ; 00FB76 19
1932:	FB77  C360F0  		jp     SDCUAE           ; 00FB77 C3 60 F0
1933:	FB7A  E5      	MDJMP0:	push   hl              ; 00FB7A E5
1934:	FB7B  CDC0FD  		call   CLRLIN           ; 00FB7B CD C0 FD
1935:	FB7E  2A4800  		ld     hl,(CURPBUF)      ; 00FB7E 2A 48 00
1936:	FB81  115000  		ld     de,$0050        ; 00FB81 11 50 00
1937:	FB84  19      		add    hl,de           ; 00FB84 19
1938:	FB85  112008  		ld     de,$0820        ; 00FB85 11 20 08
1939:	FB88  E5      		push   hl              ; 00FB88 E5
1940:	FB89  ED52    		sbc    hl,de           ; 00FB89 ED 52
1941:	FB8B  E1      		pop    hl              ; 00FB8B E1
1942:	FB8C  3802    		jr     c,MDJMP1         ; 00FB8C 38 02
1943:	FB8E  CB9C    		res    3,h             ; 00FB8E CB 9C
1944:	FB90  224800  	MDJMP1:	ld     (CURPBUF),hl      ; 00FB90 22 48 00
1945:	FB93  CD0EF9  		call   SDSTA           ; 00FB93 CD 0E F9
1946:	FB96  184B    		jr     MOVEND           ; 00FB96 18 4B
1947:	FB98          	CONOU2:	
1948:	FB98  FE20    		cp     $20             ; 00FB98 FE 20
1949:	FB9A  300F    		jr     nc,C2JP1        ; 00FB9A 30 0F
1950:	FB9C  2120FE  		ld     hl,IOCVEC2        ; 00FB9C 21 20 FE
1951:	FB9F  85      		add    a,l             ; 00FB9F 85
1952:	FBA0  6F      		ld     l,a             ; 00FBA0 6F
1953:	FBA1  4E      		ld     c,(hl)          ; 00FBA1 4E
1954:	FBA2  0600    		ld     b,$00           ; 00FBA2 06 00
1955:	FBA4  B7      		or     a               ; 00FBA4 B7
1956:	FBA5  210FFD  		ld     hl,IOCBAS2        ; 00FBA5 21 0F FD
1957:	FBA8  09      		add    hl,bc           ; 00FBA8 09
1958:	FBA9  00      		nop                    ; 00FBA9 00
1959:	FBAA  E9      		jp     (hl)            ; 00FBAA E9
1960:	FBAB  EB      	C2JP1:	ex     de,hl           ; 00FBAB EB
1961:	FBAC  CB46    		bit    0,(hl)          ; 00FBAC CB 46
1962:	FBAE  200B    		jr     nz,C2JP2        ; 00FBAE 20 0B
1963:	FBB0  FE70    		cp     $70             ; 00FBB0 FE 70
1964:	FBB2  D0      		ret    nc              ; 00FBB2 D0
1965:	FBB3  D620    		sub    $20             ; 00FBB3 D6 20
1966:	FBB5  322500  		ld     ($0025),a       ; 00FBB5 32 25 00
1967:	FBB8  CBC6    		set    0,(hl)          ; 00FBB8 CB C6
1968:	FBBA  C9      		ret                    ; 00FBBA C9
1969:	FBBB  FE39    	C2JP2:	cp     $39             ; 00FBBB FE 39
1970:	FBBD  D0      		ret    nc              ; 00FBBD D0
1971:	FBBE  D61F    		sub    $1f             ; 00FBBE D6 1F
1972:	FBC0  CBBE    		res    7,(hl)          ; 00FBC0 CB BE
1973:	FBC2  CB86    		res    0,(hl)          ; 00FBC2 CB 86
1974:	FBC4  47      		ld     b,a             ; 00FBC4 47
1975:	FBC5  21B0FF  		ld     hl,$ffb0        ; 00FBC5 21 B0 FF
1976:	FBC8  115000  		ld     de,$0050        ; 00FBC8 11 50 00
1977:	FBCB  19      	C2JP3:	add    hl,de           ; 00FBCB 19
1978:	FBCC  10FD    		djnz   C2JP3           ; 00FBCC 10 FD
1979:	FBCE  3A2500  		ld     a,($0025)       ; 00FBCE 3A 25 00
1980:	FBD1  322900  		ld     (COLBUF),a       ; 00FBD1 32 29 00
1981:	FBD4  5F      		ld     e,a             ; 00FBD4 5F
1982:	FBD5  19      		add    hl,de           ; 00FBD5 19
1983:	FBD6  EB      		ex     de,hl           ; 00FBD6 EB
1984:	FBD7  2A4800  		ld     hl,(CURPBUF)      ; 00FBD7 2A 48 00
1985:	FBDA  19      		add    hl,de           ; 00FBDA 19
1986:	FBDB  C360F0  		jp     SDCUAE           ; 00FBDB C3 60 F0
1987:	FBDE          	VCRESREG:
1988:	FBDE  E1      		pop    hl              ; 00FBDE E1
1989:	FBDF  D1      		pop    de              ; 00FBDF D1
1990:	FBE0  C1      		pop    bc              ; 00FBE0 C1
1991:	FBE1  F1      		pop    af              ; 00FBE1 F1
1992:	FBE2  C9      		ret                    ; 00FBE2 C9
1993:			;; MOVEND
1994:			;
1995:	FBE3          	MOVEND:
1996:	FBE3  E1      		pop    hl              ; 00FBE3 E1
1997:	FBE4  3802    		jr     c,$fbe8         ; 00FBE4 38 02
1998:	FBE6  CB9C    		res    3,h             ; 00FBE6 CB 9C
1999:	FBE8  C360F0  		jp     SDCUAE           ; 00FBE8 C3 60 F0
2000:			;
2001:	FBEB  00      		nop                    ; 00FBEB 00
2002:	FBEC  00      		nop                    ; 00FBEC 00
2003:	FBED  00      		nop                    ; 00FBED 00
2004:	FBEE  00      		nop                    ; 00FBEE 00
2005:	FBEF  00      		nop                    ; 00FBEF 00
2006:	FBF0          	CURBLB:
2007:	FBF0  2E40    		ld     l,$40           ; 00FBF0 2E 40 (0 10 00000) 1/16 blink scan 0
2008:	FBF2  1816    		jr     CURSETMODE           ; 00FBF2 18 16
2009:	FBF4          	CURBLL:	
2010:	FBF4  2E4A    		ld     l,$4a           ; 00FBF4 2E 4A (0 10 01010) 1/16 blink scan 10
2011:	FBF6  1812    		jr     CURSETMODE           ; 00FBF6 18 12
2012:	FBF8          	CURBFB:	
2013:	FBF8  2E60    		ld     l,$60           ; 00FBF8 2E 60 (0 11 00000) 1/32 blink scan 0
2014:	FBFA  180E    		jr     CURSETMODE           ; 00FBFA 18 0E
2015:	FBFC          	CURBFL:	
2016:	FBFC  2E6A    		ld     l,$6a           ; 00FBFC 2E 6A (0 11 01010) 1/32 blink scan 10
2017:	FBFE  180A    		jr     CURSETMODE           ; 00FBFE 18 0A
2018:	FC00          	CUROFB:	
2019:	FC00  2E20    		ld     l,$20           ; 00FC00 2E 20 (0 01 00000) no cursor scan 0
2020:	FC02  1806    		jr     CURSETMODE           ; 00FC02 18 06
2021:	FC04          	CURFXB:	
2022:	FC04  2E00    		ld     l,$00           ; 00FC04 2E 00 (0 00 00000) fixed scan 0
2023:	FC06  1802    		jr     CURSETMODE           ; 00FC06 18 02
2024:	FC08          	CURFXL:	
2025:	FC08  2E0A    		ld     l,$0a           ; 00FC08 2E 0A (0 00 01010) fixed scan 10
2026:	FC0A          	CURSETMODE:
2027:	FC0A  3E0A    		ld     a,$0a           ; 00FC0A 3E 0A
2028:	FC0C  D38C    		out    (CRT6545ADST),a         ; 00FC0C D3 8C
2029:	FC0E  7D      		ld     a,l             ; 00FC0E 7D
2030:	FC0F  D38D    		out    (CRT6545DATA),a         ; 00FC0F D3 8D
2031:	FC11  3E1F    		ld     a,$1f           ; 00FC11 3E 1F
2032:	FC13  D38C    		out    (CRT6545ADST),a         ; 00FC13 D3 8C
2033:	FC15  C9      		ret                    ; 00FC15 C9
2034:			;;
2035:			;; DLIGHT
2036:			;; fill video ram (2k) with ff's
2037:			;	
2038:	FC16          	DLIGHT:
2039:	FC16  21FFFF  		ld     hl,$ffff        ; 00FC16 21 FF FF
2040:	FC19  222A00  		ld     (RAM0BUF),hl      ; 00FC19 22 2A 00
2041:	FC1C  3EFF    		ld     a,$ff           ; 00FC1C 3E FF
2042:	FC1E  322C00  		ld     (RAM2BUF),a       ; 00FC1E 32 2C 00
2043:	FC21  C34AFE  		jp     CRTFIL           ; 00FC21 C3 4A FE
2044:			;;
2045:			;; DISMVC display char and move cursor
2046:			;
2047:	FC24          	DISMVC:
2048:	FC24  CDD0F7  		call   DISPCH           ; 00FC24 CD D0 F7
2049:	FC27  C360F0  		jp     SDCUAE           ; 00FC27 C3 60 F0
2050:			;;	
2051:	FC2A  00      		nop                    ; 00FC2A 00
2052:	FC2B  00      		nop                    ; 00FC2B 00
2053:	FC2C  00      		nop                    ; 00FC2C 00
2054:	FC2D  00      		nop                    ; 00FC2D 00
2055:	FC2E  00      		nop                    ; 00FC2E 00
2056:	FC2F  00      		nop                    ; 00FC2F 00
2057:			;;
2058:			;; IOCBASE (a void routine) from here a list of routines to handle
2059:			;; console char output
2060:			;
2061:	FC30          	IOCBASE:	
2062:	FC30  C9      		ret                    ; 00FC30 C9
2063:			;
2064:	FC31          	IOCSOH:
2065:	FC31  EB      		ex     de,hl           ; 00FC31 EB
2066:	FC32  CBDE    		set    3,(hl)          ; 00FC32 CB DE
2067:	FC34  C9      		ret                    ; 00FC34 C9
2068:	FC35          	IOCSTX:
2069:	FC35  EB      		ex     de,hl           ; 00FC35 EB
2070:	FC36  CB9E    		res    3,(hl)          ; 00FC36 CB 9E
2071:	FC38  C9      		ret                    ; 00FC38 C9
2072:			;;	
2073:			;; INICRTCUR - init CRT cursor at CURPBUF
2074:			;
2075:	FC39          	INICRTCUR:
2076:	FC39  2A4800  		ld     hl,(CURPBUF)      ; 00FC39 2A 48 00
2077:	FC3C  CD60F0  		call   SDCUAE           ; 00FC3C CD 60 F0
2078:	FC3F  AF      		xor    a               ; 00FC3F AF
2079:	FC40  C35CFB  		jp     SAVCOLB           ; 00FC40 C3 5C FB
2080:			;;	
2081:			;; IOCBEL - sound beep
2082:	FC43          	IOCBEL:
2083:	FC43  D38F    		out    (CRTBEEPPORT),a         ; 00FC43 D3 8F
2084:	FC45  C9      		ret                    ; 00FC45 C9
2085:			;;
2086:			;;
2087:			;
2088:	FC46          	IOCBS:
2089:	FC46  CDB0F7  		call   GDCUA           ; 00FC46 CD B0 F7
2090:	FC49  2B      		dec    hl              ; 00FC49 2B
2091:	FC4A  ED5B4800		ld     de,(CURPBUF)      ; 00FC4A ED 5B 48 00
2092:	FC4E  AF      		xor    a               ; 00FC4E AF
2093:	FC4F  ED52    		sbc    hl,de           ; 00FC4F ED 52
2094:	FC51  BC      		cp     h               ; 00FC51 BC
2095:	FC52  2002    		jr     nz,IOCBS1        ; 00FC52 20 02
2096:	FC54  BD      		cp     l               ; 00FC54 BD
2097:	FC55  C8      		ret    z               ; 00FC55 C8
2098:	FC56  2B      	IOCBS1:	dec    hl              ; 00FC56 2B
2099:	FC57  19      		add    hl,de           ; 00FC57 19
2100:	FC58  CD60F0  		call   SDCUAE           ; 00FC58 CD 60 F0
2101:	FC5B  E5      		push   hl              ; 00FC5B E5
2102:	FC5C  3A2900  		ld     a,(COLBUF)       ; 00FC5C 3A 29 00
2103:	FC5F  3D      		dec    a               ; 00FC5F 3D
2104:	FC60  FEFF    		cp     $ff             ; 00FC60 FE FF
2105:	FC62  2002    		jr     nz,IOCBS2        ; 00FC62 20 02
2106:	FC64  3E4F    		ld     a,$4f           ; 00FC64 3E 4F
2107:	FC66  322900  	IOCBS2:	ld     (COLBUF),a       ; 00FC66 32 29 00
2108:	FC69  212700  		ld     hl,CIOBYTE        ; 00FC69 21 27 00
2109:	FC6C  CB66    		bit    4,(hl)          ; 00FC6C CB 66
2110:	FC6E  E1      		pop    hl              ; 00FC6E E1
2111:	FC6F  C0      		ret    nz              ; 00FC6F C0
2112:	FC70  3E20    		ld     a,$20           ; 00FC70 3E 20
2113:	FC72  C324FC  		jp     DISMVC           ; 00FC72 C3 24 FC
2114:			;;
2115:			;; CHOME - move cursor at col 0
2116:			;
2117:	FC75          	CHOME:
2118:	FC75  212900  		ld     hl,COLBUF        ; 00FC75 21 29 00
2119:	FC78  5E      		ld     e,(hl)          ; 00FC78 5E
2120:	FC79  AF      		xor    a               ; 00FC79 AF
2121:	FC7A  77      		ld     (hl),a          ; 00FC7A 77
2122:	FC7B  57      		ld     d,a             ; 00FC7B 57
2123:	FC7C  CDB0F7  		call   GDCUA           ; 00FC7C CD B0 F7
2124:	FC7F  2B      		dec    hl              ; 00FC7F 2B
2125:	FC80  ED52    		sbc    hl,de           ; 00FC80 ED 52
2126:	FC82  CD60F0  		call   SDCUAE           ; 00FC82 CD 60 F0
2127:	FC85  C9      		ret                    ; 00FC85 C9
2128:			;;
2129:			;; CLRSCR - clear screen (ASCII mode)
2130:			;
2131:	FC86          	CLRSCR:
2132:	FC86  210000  		ld     hl,$0000        ; 00FC86 21 00 00
2133:	FC89  AF      		xor    a               ; 00FC89 AF
2134:	FC8A  322900  		ld     (COLBUF),a       ; 00FC8A 32 29 00
2135:	FC8D  2F      		cpl                    ; 00FC8D 2F
2136:	FC8E  322800  		ld     (RAM3BUF),a       ; 00FC8E 32 28 00
2137:	FC91  224800  		ld     (CURPBUF),hl      ; 00FC91 22 48 00
2138:	FC94  CD60F0  		call   SDCUAE           ; 00FC94 CD 60 F0
2139:	FC97  CD0EF9  		call   SDSTA           ; 00FC97 CD 0E F9
2140:	FC9A  E5      		push   hl              ; 00FC9A E5
2141:	FC9B  3E20    	CLSNC:	ld     a,$20           ; 00FC9B 3E 20
2142:	FC9D  CDD0F7  		call   DISPCH           ; 00FC9D CD D0 F7
2143:	FCA0  23      		inc    hl              ; 00FCA0 23
2144:	FCA1  7C      		ld     a,h             ; 00FCA1 7C
2145:	FCA2  FE08    		cp     $08             ; 00FCA2 FE 08
2146:	FCA4  20F5    		jr     nz,CLSNC        ; 00FCA4 20 F5
2147:	FCA6  E1      		pop    hl              ; 00FCA6 E1
2148:	FCA7  C360F0  		jp     SDCUAE           ; 00FCA7 C3 60 F0
2149:			;; IOCCR - handle carriage return (0x0d)
2150:			;; should position the cursor at col 0
2151:			;
2152:	FCAA          	IOCCR:
2153:	FCAA  EB      		ex     de,hl           ; 00FCAA EB
2154:	FCAB  CB5E    		bit    3,(hl)          ; 00FCAB CB 5E
2155:	FCAD  2803    		jr     z,IOCCR1         ; 00FCAD 28 03
2156:	FCAF  CDD6FC  		call   CLREOL           ; 00FCAF if bit 3 == 0 (???)
2157:	FCB2  C375FC  	IOCCR1:	jp     CHOME           ; 00FCB2 C3 75 FC
2158:			;;
2159:	FCB5          	IOCSO:
2160:	FCB5  AF      		xor    a               ; 00FCB5 AF
2161:	FCB6  2A4800  		ld     hl,(CURPBUF)      ; 00FCB6 2A 48 00
2162:	FCB9  11D007  		ld     de,$07d0        ; 00FCB9 11 D0 07
2163:	FCBC  19      		add    hl,de           ; 00FCBC 19
2164:	FCBD  EB      		ex     de,hl           ; 00FCBD EB
2165:	FCBE  CDB0F7  		call   GDCUA           ; 00FCBE CD B0 F7
2166:	FCC1  2B      		dec    hl              ; 00FCC1 2B
2167:	FCC2  EB      		ex     de,hl           ; 00FCC2 EB
2168:	FCC3  ED52    		sbc    hl,de           ; 00FCC3 ED 52
2169:	FCC5  E5      		push   hl              ; 00FCC5 E5
2170:	FCC6  C1      		pop    bc              ; 00FCC6 C1
2171:	FCC7  CDC3FD  	CLRJ0:	call   CLRLIN1           ; 00FCC7 CD C3 FD
2172:	FCCA  EB      		ex     de,hl           ; 00FCCA EB
2173:	FCCB  C360F0  		jp     SDCUAE           ; 00FCCB C3 60 F0
2174:	FCCE          	IOCENQ:
2175:	FCCE  C3FCFB  		jp     CURBFL           ; 00FCCE C3 FC FB
2176:	FCD1          	IOCUS:	
2177:	FCD1  C3F0FF  		jp     SET3MIOB           ; 00FCD1 C3 F0 FF
2178:			;
2179:	FCD4  00      		nop                    ; 00FCD4 00
2180:	FCD5  00      		nop                    ; 00FCD5 00
2181:			;;
2182:			;; CLREOL - clear to end of line
2183:			;
2184:	FCD6          	CLREOL:
2185:	FCD6  3A2900  		ld     a,(COLBUF)       ; 00FCD6 3A 29 00
2186:	FCD9  47      		ld     b,a             ; 00FCD9 47
2187:	FCDA  3E50    		ld     a,$50           ; 00FCDA 3E 50
2188:	FCDC  90      		sub    b               ; 00FCDC 90
2189:	FCDD  0600    		ld     b,$00           ; 00FCDD 06 00
2190:	FCDF  4F      		ld     c,a             ; 00FCDF 4F
2191:	FCE0  CDB0F7  		call   GDCUA           ; 00FCE0 CD B0 F7
2192:	FCE3  2B      		dec    hl              ; 00FCE3 2B
2193:	FCE4  EB      		ex     de,hl           ; 00FCE4 EB
2194:	FCE5  C3C7FC  		jp     CLRJ0           ; 00FCE5 C3 C7 FC
2195:			;;
2196:	FCE8          	IOCSYN:
2197:	FCE8  EB      		ex     de,hl           ; 00FCE8 EB
2198:	FCE9  CBD6    		set    2,(hl)          ; 00FCE9 CB D6
2199:	FCEB  C9      		ret                    ; 00FCEB C9
2200:	FCEC          	IOCETB:
2201:	FCEC  EB      		ex     de,hl           ; 00FCEC EB
2202:	FCED  CB96    		res    2,(hl)          ; 00FCED CB 96
2203:	FCEF  C9      		ret                    ; 00FCEF C9
2204:	FCF0          	IOCFS:
2205:	FCF0  EB      		ex     de,hl           ; 00FCF0 EB
2206:	FCF1  CB8E    		res    1,(hl)          ; 00FCF1 CB 8E
2207:	FCF3  C9      		ret                    ; 00FCF3 C9
2208:	FCF4          	IOCGS:
2209:	FCF4  EB      		ex     de,hl           ; 00FCF4 EB
2210:	FCF5  CBCE    		set    1,(hl)          ; 00FCF5 CB CE
2211:	FCF7  C9      		ret                    ; 00FCF7 C9
2212:	FCF8          	IOCESC:
2213:	FCF8  EB      		ex     de,hl           ; 00FCF8 EB
2214:	FCF9  CBFE    		set    7,(hl)          ; 00FCF9 CB FE
2215:	FCFB  C9      		ret                    ; 00FCFB C9
2216:			;;
2217:			;; IOCLF - line feed handle
2218:	FCFC          	IOCLF:
2219:	FCFC  C39BFD  		jp     LINDN           ; 00FCFC C3 9B FD
2220:			;;
2221:			;; RESATTR - reset all attributes
2222:			;
2223:	FCFF          	RESATTR:
2224:	FCFF  3EFF    		ld     a,$ff           ; 00FCFF 3E FF
2225:	FD01  322800  		ld     (RAM3BUF),a       ; 00FD01 32 28 00
2226:	FD04  C9      		ret                    ; 00FD04 C9
2227:			;;	
2228:	FD05          	IOCCAN:
2229:	FD05  C3C8F5  		jp     INIT0           ; 00FD05 C3 C8 F5
2230:	FD08          	IOCRS:
2231:	FD08  C359FF  		jp     OUTGRBUF           ; 00FD08 C3 59 FF
2232:	FD0B          	IOCEOT:
2233:	FD0B  C3F8FB  		jp     CURBFB           ; 00FD0B C3 F8 FB
2234:				
2235:	FD0E  00      		nop                    ; 00FD0E 00
2236:			;;
2237:			;; IOCBASE2 (a void routine) from here a list of routines to handle
2238:			;; console char output
2239:			;; This is the same as IOCBASE but when bit 7 of CIOBYTE is set
2240:			;
2241:	FD0F          	IOCBAS2:
2242:	FD0F  C9      		ret                    ; 00FD0F C9
2243:	FD10          	IOCNAK:
2244:	FD10  C34EFB  		jp     CURRGT           ; 00FD10 C3 4E FB
2245:	FD13          	IOCSY2:	
2246:	FD13  CDB0F7  		call   GDCUA           ; 00FD13 CD B0 F7
2247:	FD16  11AFFF  		ld     de,$ffaf        ; 00FD16 11 AF FF
2248:	FD19  19      		add    hl,de           ; 00FD19 19
2249:	FD1A  EB      		ex     de,hl           ; 00FD1A EB
2250:	FD1B  2A4800  		ld     hl,(CURPBUF)      ; 00FD1B 2A 48 00
2251:	FD1E  EB      		ex     de,hl           ; 00FD1E EB
2252:	FD1F  AF      		xor    a               ; 00FD1F AF
2253:	FD20  ED52    		sbc    hl,de           ; 00FD20 ED 52
2254:	FD22  2F      		cpl                    ; 00FD22 2F
2255:	FD23  BC      		cp     h               ; 00FD23 BC
2256:	FD24  19      		add    hl,de           ; 00FD24 19
2257:	FD25  C8      		ret    z               ; 00FD25 C8
2258:	FD26  C360F0  		jp     SDCUAE           ; 00FD26 C3 60 F0
2259:	FD29          	IOCUS2:
2260:	FD29  C3F6FF  		jp     RES3MIOB           ; 00FD29 C3 F6 FF
2261:	FD2C  00      		nop                    ; 00FD2C 00
2262:	FD2D  00      		nop                    ; 00FD2D 00
2263:	FD2E  00      		nop                    ; 00FD2E 00
2264:	FD2F          	IOCCA2:
2265:	FD2F  EB      		ex     de,hl           ; 00FD2F EB
2266:	FD30  CBB6    		res    6,(hl)          ; 00FD30 CB B6
2267:	FD32  C9      		ret                    ; 00FD32 C9
2268:	FD33          	IOCEM:
2269:	FD33  EB      		ex     de,hl           ; 00FD33 EB
2270:	FD34  CBE6    		set    4,(hl)          ; 00FD34 CB E6
2271:	FD36  C9      		ret                    ; 00FD36 C9
2272:	FD37          	IOCSUB:
2273:	FD37  EB      		ex     de,hl           ; 00FD37 EB
2274:	FD38  CBA6    		res    4,(hl)          ; 00FD38 CB A6
2275:	FD3A  C9      		ret                    ; 00FD3A C9
2276:	FD3B          	IOCSO2:
2277:	FD3B  212800  		ld     hl,RAM3BUF        ; 00FD3B 21 28 00
2278:	FD3E  CBC6    		set    0,(hl)          ; 00FD3E CB C6
2279:	FD40  C9      		ret                    ; 00FD40 C9
2280:	FD41          	IOCFS2:
2281:	FD41  212800  		ld     hl,RAM3BUF        ; 00FD41 21 28 00
2282:	FD44  CBCE    		set    1,(hl)          ; 00FD44 CB CE
2283:	FD46  C9      		ret                    ; 00FD46 C9
2284:	FD47          	IOCETX:
2285:	FD47  212800  		ld     hl,RAM3BUF        ; 00FD47 21 28 00
2286:	FD4A  CBD6    		set    2,(hl)          ; 00FD4A CB D6
2287:	FD4C  C9      		ret                    ; 00FD4C C9
2288:	FD4D          	IOCEN2:
2289:	FD4D  212800  		ld     hl,RAM3BUF        ; 00FD4D 21 28 00
2290:	FD50  CBDE    		set    3,(hl)          ; 00FD50 CB DE
2291:	FD52  C9      		ret                    ; 00FD52 C9
2292:	FD53          	IOCBE2:
2293:	FD53  212800  		ld     hl,RAM3BUF        ; 00FD53 21 28 00
2294:	FD56  CBE6    		set    4,(hl)          ; 00FD56 CB E6
2295:	FD58  C9      		ret                    ; 00FD58 C9
2296:	FD59          	IOCS2:
2297:	FD59  212800  		ld     hl,RAM3BUF        ; 00FD59 21 28 00
2298:	FD5C  CBEE    		set    5,(hl)          ; 00FD5C CB EE
2299:	FD5E  C9      		ret                    ; 00FD5E C9
2300:	FD5F          	IOCDLE:
2301:	FD5F  212800  		ld     hl,RAM3BUF        ; 00FD5F 21 28 00
2302:	FD62  CBF6    		set    6,(hl)          ; 00FD62 CB F6
2303:	FD64  C9      		ret                    ; 00FD64 C9
2304:	FD65          	IOCGS2:
2305:	FD65  212800  		ld     hl,RAM3BUF        ; 00FD65 21 28 00
2306:	FD68  CBFE    		set    7,(hl)          ; 00FD68 CB FE
2307:	FD6A  C9      		ret                    ; 00FD6A C9
2308:	FD6B          	IOCST2:
2309:	FD6B  212800  		ld     hl,RAM3BUF        ; 00FD6B 21 28 00
2310:	FD6E  CB86    		res    0,(hl)          ; 00FD6E CB 86
2311:	FD70  C9      		ret                    ; 00FD70 C9
2312:	FD71          	IOCES2:
2313:	FD71  212800  		ld     hl,RAM3BUF        ; 00FD71 21 28 00
2314:	FD74  CB8E    		res    1,(hl)          ; 00FD74 CB 8E
2315:	FD76  C9      		ret                    ; 00FD76 C9
2316:	FD77          	IOCEO2:
2317:	FD77  212800  		ld     hl,RAM3BUF        ; 00FD77 21 28 00
2318:	FD7A  CB96    		res    2,(hl)          ; 00FD7A CB 96
2319:	FD7C  C9      		ret                    ; 00FD7C C9
2320:	FD7D          	IOCAC2:
2321:	FD7D  212800  		ld     hl,RAM3BUF        ; 00FD7D 21 28 00
2322:	FD80  CB9E    		res    3,(hl)          ; 00FD80 CB 9E
2323:	FD82  C9      		ret                    ; 00FD82 C9
2324:	FD83          	IOCHT:
2325:	FD83  212800  		ld     hl,RAM3BUF        ; 00FD83 21 28 00
2326:	FD86  CBA6    		res    4,(hl)          ; 00FD86 CB A6
2327:	FD88  C9      		ret                    ; 00FD88 C9
2328:	FD89          	IOCSI2:
2329:	FD89  212800  		ld     hl,RAM3BUF        ; 00FD89 21 28 00
2330:	FD8C  CBAE    		res    5,(hl)          ; 00FD8C CB AE
2331:	FD8E  C9      		ret                    ; 00FD8E C9
2332:	FD8F          	IOCD12:
2333:	FD8F  212800  		ld     hl,RAM3BUF        ; 00FD8F 21 28 00
2334:	FD92  CBB6    		res    6,(hl)          ; 00FD92 CB B6
2335:	FD94  C9      		ret                    ; 00FD94 C9
2336:	FD95          	IOCRS2:
2337:	FD95  212800  		ld     hl,RAM3BUF        ; 00FD95 21 28 00
2338:	FD98  CBBE    		res    7,(hl)          ; 00FD98 CB BE
2339:	FD9A  C9      		ret                    ; 00FD9A C9
2340:			;;
2341:			;; LINDN - cursor down one line
2342:			;
2343:	FD9B          	LINDN:
2344:	FD9B  CDB0F7  		call   GDCUA           ; 00FD9B CD B0 F7
2345:	FD9E  2B      		dec    hl              ; 00FD9E 2B
2346:	FD9F  115000  		ld     de,$0050        ; 00FD9F 11 50 00
2347:	FDA2  19      		add    hl,de           ; 00FDA2 19
2348:	FDA3  CD60F0  		call   SDCUAE           ; 00FDA3 CD 60 F0
2349:	FDA6  C364FB  		jp     MOVDN1           ; 00FDA6 C3 64 FB
2350:			;;
2351:	FDA9          	IOCNUL:
2352:	FDA9  EB      		ex     de,hl           ; 00FDA9 EB
2353:	FDAA  CBBE    		res    7,(hl)          ; 00FDAA CB BE
2354:	FDAC  C9      		ret                    ; 00FDAC C9
2355:			;
2356:	FDAD          	IOCDC2:
2357:	FDAD  C3F0FB  		jp     CURBLB           ; 00FDAD C3 F0 FB
2358:	FDB0          	IOCDC3:
2359:	FDB0  C3F4FB  		jp     CURBLL           ; 00FDB0 C3 F4 FB
2360:	FDB3          	IOCET2:	
2361:	FDB3  EB      		ex     de,hl           ; 00FDB3 EB
2362:	FDB4  CBF6    		set    6,(hl)          ; 00FDB4 CB F6
2363:	FDB6  C9      		ret                    ; 00FDB6 C9
2364:				
2365:	FDB7  00      		nop                    ; 00FDB7 00
2366:	FDB8  00      		nop                    ; 00FDB8 00
2367:	FDB9  00      		nop                    ; 00FDB9 00
2368:	FDBA  00      		nop                    ; 00FDBA 00
2369:	FDBB  00      		nop                    ; 00FDBB 00
2370:	FDBC  00      		nop                    ; 00FDBC 00
2371:	FDBD  00      		nop                    ; 00FDBD 00
2372:	FDBE  00      		nop                    ; 00FDBE 00
2373:	FDBF  00      		nop                    ; 00FDBF 00
2374:			;;
2375:			;; CLRLIN - clear current line
2376:			;
2377:	FDC0          	CLRLIN:
2378:	FDC0  015000  		ld     bc,$0050        ; 00FDC0 01 50 00
2379:	FDC3          	CLRLIN1:
2380:	FDC3  3A2800  		ld     a,(RAM3BUF)       ; 00FDC3 3A 28 00
2381:	FDC6  F5      		push   af              ; 00FDC6 F5
2382:	FDC7  3EFF    		ld     a,$ff           ; 00FDC7 3E FF
2383:	FDC9  322800  		ld     (RAM3BUF),a       ; 00FDC9 32 28 00
2384:	FDCC  3E20    	CLRLP1:	ld     a,$20           ; 00FDCC 3E 20
2385:	FDCE  CDD0F7  		call   DISPCH           ; 00FDCE CD D0 F7
2386:	FDD1  0B      		dec    bc              ; 00FDD1 0B
2387:	FDD2  78      		ld     a,b             ; 00FDD2 78
2388:	FDD3  B1      		or     c               ; 00FDD3 B1
2389:	FDD4  20F6    		jr     nz,CLRLP1        ; 00FDD4 20 F6
2390:	FDD6  F1      		pop    af              ; 00FDD6 F1
2391:	FDD7  322800  		ld     (RAM3BUF),a       ; 00FDD7 32 28 00
2392:	FDDA  C9      		ret                    ; 00FDDA C9
2393:			;;
2394:	FDDB  00      		nop                    ; 00FDDB 00
2395:	FDDC  00      		nop                    ; 00FDDC 00
2396:	FDDD  00      		nop                    ; 00FDDD 00
2397:	FDDE  00      		nop                    ; 00FDDE 00
2398:	FDDF  00      		nop                    ; 00FDDF 00
2399:			;;
2400:			;; NIB2ASC convert lower nibble in reg A to ascii in reg C
2401:			;
2402:	FDE0          	NIB2ASC:
2403:	FDE0  E60F    		and    $0f             ; 00FDE0 E6 0F
2404:	FDE2  C690    		add    a,$90           ; 00FDE2 C6 90
2405:	FDE4  27      		daa                    ; 00FDE4 27
2406:	FDE5  CE40    		adc    a,$40           ; 00FDE5 CE 40
2407:	FDE7  27      		daa                    ; 00FDE7 27
2408:	FDE8  4F      		ld     c,a             ; 00FDE8 4F
2409:	FDE9  C9      		ret                    ; 00FDE9 C9
2410:	FDEA          	IOCVT2:
2411:	FDEA  C308FC  		jp     CURFXL           ; 00FDEA C3 08 FC
2412:	FDED  00      		nop                    ; 00FDED 00
2413:	FDEE  00      		nop                    ; 00FDEE 00
2414:	FDEF  00      		nop                    ; 00FDEF 00
2415:	FDF0          	IOCFF2:
2416:	FDF0  C340FE  		jp     DBLANK           ; 00FDF0 C3 40 FE
2417:	FDF3  00      		nop                    ; 00FDF3 00
2418:	FDF4  00      		nop                    ; 00FDF4 00
2419:	FDF5  00      		nop                    ; 00FDF5 00
2420:	FDF6  00      		nop                    ; 00FDF6 00
2421:	FDF7  00      		nop                    ; 00FDF7 00
2422:	FDF8  00      		nop                    ; 00FDF8 00
2423:	FDF9  00      		nop                    ; 00FDF9 00
2424:	FDFA  00      		nop                    ; 00FDFA 00
2425:	FDFB  00      		nop                    ; 00FDFB 00
2426:	FDFC  00      		nop                    ; 00FDFC 00
2427:	FDFD  00      		nop                    ; 00FDFD 00
2428:	FDFE  00      		nop                    ; 00FDFE 00
2429:	FDFF  00      		nop                    ; 00FDFF 00
2430:			;; This table define the offsets to jump from
2431:			;; IOCBASE (IOCBASE+IOCVEC) to a set fo routines that
2432:			;; handles cntrl char < 0x20 when we are in CONOUT 
2433:	FE00          	IOCVEC:
2434:	FE00  00      		db    IOCBASE-IOCBASE          ; NUL 0x00 (00)  no-op
2435:	FE01  01      		db    IOCSOH-IOCBASE           ; SOH 0x01 (01)  set bit 3 (de)
2436:	FE02  05      		db    IOCSTX-IOCBASE           ; STX 0x02 (05)  res bit 3 (de)
2437:	FE03  00      		db    IOCBASE-IOCBASE          ; ETX 0x03 (00)  no-op
2438:	FE04  DB      		db    IOCEOT-IOCBASE           ; EOT 0x04 (db)  cursor blink fast block
2439:	FE05  9E      		db    IOCENQ-IOCBASE           ; ENQ 0x05 (9e)  cursor blink fast line
2440:	FE06  09      		db    IOCACK-IOCBASE           ; ACK 0x06 (09)  locate cursor at CURPBUF
2441:	FE07  13      		db    IOCBEL-IOCBASE           ; BEL 0x07 (13)  beep
2442:	FE08  16      		db    IOCBS-IOCBASE            ; BS  0x08 (16)  cursor back
2443:	FE09  00      		db    IOCBASE-IOCBASE          ; HT  0x09 (00)  no-op
2444:	FE0A  CC      		db    IOCLF-IOCBASE            ; LF  0x0a (cc)  cursor down one line
2445:	FE0B  45      		db    IOCVT-IOCBASE            ; VT  0x0b (45)  cursor home
2446:	FE0C  56      		db    IOCFF-IOCBASE            ; FF  0x0c (56)  page down (clear screen)
2447:	FE0D  7A      		db    IOCCR-IOCBASE            ; CR  0x0d (7a)  cursor home
2448:	FE0E  85      		db    IOCSO-IOCBASE            ; SO  0x0e (85)  to end of page clear line
2449:	FE0F  A6      		db    IOCSI-IOCBASE            ; SI  0x0f (a6)  clear to EOL
2450:	FE10  00      		db    IOCBASE-IOCBASE          ; DLE 0x10 (00)  no-op
2451:	FE11  CF      		db    IOCDC1-IOCBASE           ; DC1 0x11 (cf)  reset all attributes
2452:	FE12  00      		db    IOCBASE-IOCBASE          ; DC2 0x12 (00)  no-op
2453:	FE13  00      		db    IOCBASE-IOCBASE          ; DC3 0x13 (00)  no-op
2454:	FE14  00      		db    IOCBASE-IOCBASE          ; DC4 0x14 (00)  no-op
2455:	FE15  00      		db    IOCBASE-IOCBASE          ; NAK 0x15 (00)  no-op
2456:	FE16  B8      		db    IOCSYN-IOCBASE           ; SYN 0x16 (b8) set bit 2 of (de)
2457:	FE17  BC      		db    IOCETB-IOCBASE           ; ETB 0x17 (bc) res bit 2 of (de)
2458:	FE18  D5      		db    IOCCAN-IOCBASE           ; CAN 0x18 (d5) hard crt reset and clear
2459:	FE19  00      		db    IOCBASE-IOCBASE          ; EM  0x19 (00)  no-op
2460:	FE1A  00      		db    IOCBASE-IOCBASE          ; SUB 0x1a (00)  no-op
2461:	FE1B  C8      		db    IOCESC-IOCBASE           ; ESC 0x1b (c8) set bit 7 of (de)
2462:	FE1C  C0      		db    IOCFS-IOCBASE            ; FS  0x1c (c0) res bit 1 of (de)
2463:	FE1D  C4      		db    IOCGS-IOCBASE            ; GS  0x1d (c4) set bit 1 of (de)
2464:	FE1E  D8      		db    IOCRS-IOCBASE            ; RS  0x1e (d8) display graphic buffer (ram[012]buf)
2465:	FE1F  A1      		db    IOCUS-IOCBASE            ; US  0x1f (a1) set bit 1 of (de)
2466:			;; This table define the offsets to jump from
2467:			;; IOCBAS2 (IOCBAS2+IOCVEC2) to a set fo routines that
2468:			;; handles cntrl char < 0x20 when we are in CONOUT FD0F
2469:	FE20          	IOCVEC2:
2470:	FE20  9A      		db    IOCNUL-IOCBAS2           ; NUL 0x00 (9a)  res bit 7 (de)
2471:	FE21  2C      		db    IOCSO2-IOCBAS2           ; SOH 0x01 (2c)  set bit 0 RAM3BUF
2472:	FE22  5C      		db    IOCST2-IOCBAS2           ; STX 0x02 (5c)  res bit 0 RAM3BUF
2473:	FE23  38      		db    IOCETX-IOCBAS2           ; ETX 0x03 (38)  set bit 2 RAM3BUF
2474:	FE24  68      		db    IOCEO2-IOCBAS2           ; EOT 0x04 (68)  res bit 2 RAM3BUF
2475:	FE25  3E      		db    IOCEN2-IOCBAS2           ; ENQ 0x05 (3e)  set bit 3 RAM3BUF
2476:	FE26  6E      		db    IOCAC2-IOCBAS2           ; ACK 0x06 (6e)  res bit 3 RAM3BUF
2477:	FE27  44      		db    IOCBE2-IOCBAS2           ; BEL 0x07 (44)  set bit 4 RAM3BUF
2478:	FE28  00      		db    IOCBAS2-IOCBAS2          ; BS  0x08 (00)  no-op
2479:	FE29  74      		db    IOCHT-IOCBAS2            ; HT  0x09 (74)  res bit 4 RAM3BUF
2480:	FE2A  00      		db    IOCBAS2-IOCBAS2          ; LF  0x0a (00)  no-op
2481:	FE2B  DB      		db    IOCVT2-IOCBAS2           ; VT  0x0b (db)  cursor fixed line
2482:	FE2C  E1      		db    IOCFF2-IOCBAS2           ; FF  0x0c (e1)  clear screen
2483:	FE2D  00      		db    IOCBAS2-IOCBAS2          ; CR  0x0d (00)  cursor home
2484:	FE2E  4A      		db    IOCS2-IOCBAS2            ; SO  0x0e (4a)  set bit 4 RAM3BUF
2485:	FE2F  7A      		db    IOCSI2-IOCBAS2           ; SI  0x0f (7a)  res bit 4 RAM3BUF
2486:	FE30  50      		db    IOCDLE-IOCBAS2           ; DLE 0x10 (50)  set bit 6 RAM3BUF
2487:	FE31  80      		db    IOCD12-IOCBAS2           ; DC1 0x11 (80)  res bit 6 RAM3BUF
2488:	FE32  9E      		db    IOCDC2-IOCBAS2           ; DC2 0x12 (9e)  cursor blink slow block
2489:	FE33  A1      		db    IOCDC3-IOCBAS2           ; DC3 0x13 (a1)  cursor blink slow line
2490:	FE34  8C      		db    IOCDC4-IOCBAS2           ; DC4 0x14 (8c)  cursor down one line
2491:	FE35  01      		db    IOCNAK-IOCBAS2           ; NAK 0x15 (01)  cursor right
2492:	FE36  04      		db    IOCSY2-IOCBAS2           ; SYN 0x16 (04)  cursor up one line
2493:	FE37  A4      		db    IOCET2-IOCBAS2           ; ETB 0x17 (a4)  set bit 6 of (de)
2494:	FE38  20      		db    IOCCA2-IOCBAS2           ; CAN 0x18 (20)  res bit 6 of (de)
2495:	FE39  24      		db    IOCEM-IOCBAS2            ; EM  0x19 (24)  set bit 4 of (de)
2496:	FE3A  28      		db    IOCSUB-IOCBAS2           ; SUB 0x1a (28)  res bit 4 of (de)
2497:	FE3B  62      		db    IOCES2-IOCBAS2           ; ESC 0x1b (62)  res bit 1 RAM3BUF
2498:	FE3C  32      		db    IOCFS2-IOCBAS2           ; FS  0x1c (32)  set bit 1 RAM3BUF
2499:	FE3D  56      		db    IOCGS2-IOCBAS2           ; GS  0x1d (56)  set bit 7 RAM3BUF
2500:	FE3E  86      		db    IOCRS2-IOCBAS2           ; RS  0x1e (86)  res bit 7 RAM3BUF
2501:	FE3F  1A      		db    IOCUS2-IOCBAS2           ; US  0x1f (1a)  res bit 3 of MIOBYTE
2502:			;;
2503:			;; DBLANK
2504:			;; fill video ram (2k) with 0's
2505:			;	
2506:	FE40          	DBLANK:
2507:	FE40  210000  		ld     hl,$0000        ; 00FE40 21 00 00
2508:	FE43  222A00  		ld     (RAM0BUF),hl      ; 00FE43 22 2A 00
2509:	FE46  AF      		xor    a               ; 00FE46 AF
2510:	FE47  322C00  		ld     (RAM2BUF),a       ; 00FE47 32 2C 00
2511:			;;
2512:			;; CRTFIL - Fill video ram with ram buffer chrs
2513:			;
2514:	FE4A          	CRTFIL:
2515:	FE4A  3EEF    		ld     a,$ef           ; 00FE4A 3E EF
2516:	FE4C  322800  		ld     (RAM3BUF),a       ; 00FE4C 32 28 00
2517:	FE4F  210000  		ld     hl,$0000        ; 00FE4F 21 00 00
2518:	FE52  224800  		ld     (CURPBUF),hl      ; 00FE52 22 48 00
2519:	FE55  CDD8F0  		call   RDRR19R12           ; 00FE55 CD D8 F0
2520:	FE58  E5      	CFIL1:	push   hl              ; 00FE58 E5
2521:	FE59  CD66FE  		call   DISPGR2           ; 00FE59 CD 66 FE
2522:	FE5C  E1      		pop    hl              ; 00FE5C E1
2523:	FE5D  23      		inc    hl              ; 00FE5D 23
2524:	FE5E  7C      		ld     a,h             ; 00FE5E 7C
2525:	FE5F  FE08    		cp     $08             ; 00FE5F FE 08
2526:	FE61  20F5    		jr     nz,CFIL1        ; 00FE61 20 F5
2527:	FE63  C3D8F0  		jp     RDRR19R12           ; 00FE63 C3 D8 F0
2528:			;;
2529:			;; DISPGR2 - absolutely the same of DISPGR but takes chars from locs
2530:			;; 002a/b/c WHY THIS???
2531:			;	
2532:	FE66          	DISPGR2:
2533:	FE66  DB8C    		in     a,(CRT6545ADST)         ; 00FE66 DB 8C
2534:	FE68  CB7F    		bit    7,a             ; 00FE68 CB 7F
2535:	FE6A  28FA    		jr     z,DISPGR2         ; 00FE6A 28 FA
2536:	FE6C          	DISPNORTR:
2537:	FE6C  212A00  		ld     hl,RAM0BUF        ; 00FE6C 21 2A 00
2538:	FE6F  7E      		ld     a,(hl)          ; 00FE6F 7E
2539:	FE70  D380    		out    (CRTRAM0DAT),a         ; 00FE70 D3 80
2540:	FE72  23      		inc    hl              ; 00FE72 23
2541:	FE73  7E      		ld     a,(hl)          ; 00FE73 7E
2542:	FE74  D384    		out    (CRTRAM1DAT),a         ; 00FE74 D3 84
2543:	FE76  23      		inc    hl              ; 00FE76 23
2544:	FE77  7E      		ld     a,(hl)          ; 00FE77 7E
2545:	FE78  D388    		out    (CRTRAM2DAT),a         ; 00FE78 D3 88
2546:	FE7A  3A2800  		ld     a,(RAM3BUF)       ; 00FE7A 3A 28 00
2547:	FE7D  D38E    		out    (CRTRAM3PORT),a         ; 00FE7D D3 8E
2548:	FE7F  AF      		xor    a               ; 00FE7F AF
2549:	FE80  D38D    		out    (CRT6545DATA),a         ; 00FE80 D3 8D
2550:	FE82  C9      		ret                    ; 00FE82 C9
2551:			;;	
2552:	FE83  00      		nop                    ; 00FE83 00
2553:	FE84  CDB0F7  		call   GDCUA           ; 00FE84 CD B0 F7
2554:	FE87  E5      		push   hl              ; 00FE87 E5
2555:	FE88  3A2900  		ld     a,(COLBUF)       ; 00FE88 3A 29 00
2556:	FE8B  F5      		push   af              ; 00FE8B F5
2557:	FE8C  C3E1FE  		jp     $fee1           ; 00FE8C C3 E1 FE
2558:	FE8F  00      		nop                    ; 00FE8F 00
2559:	FE90  3A2D00  		ld     a,($002d)       ; 00FE90 3A 2D 00
2560:	FE93  FEA0    		cp     $a0             ; 00FE93 FE A0
2561:	FE95  D0      		ret    nc              ; 00FE95 D0
2562:	FE96  47      		ld     b,a             ; 00FE96 47
2563:	FE97  AF      		xor    a               ; 00FE97 AF
2564:	FE98  CB78    		bit    7,b             ; 00FE98 CB 78
2565:	FE9A  2802    		jr     z,$fe9e         ; 00FE9A 28 02
2566:	FE9C  3E20    		ld     a,$20           ; 00FE9C 3E 20
2567:	FE9E  CB70    		bit    6,b             ; 00FE9E CB 70
2568:	FEA0  2802    		jr     z,$fea4         ; 00FEA0 28 02
2569:	FEA2  C610    		add    a,$10           ; 00FEA2 C6 10
2570:	FEA4  CB68    		bit    5,b             ; 00FEA4 CB 68
2571:	FEA6  2802    		jr     z,$feaa         ; 00FEA6 28 02
2572:	FEA8  C608    		add    a,$08           ; 00FEA8 C6 08
2573:	FEAA  CB60    		bit    4,b             ; 00FEAA CB 60
2574:	FEAC  2802    		jr     z,$feb0         ; 00FEAC 28 02
2575:	FEAE  C604    		add    a,$04           ; 00FEAE C6 04
2576:	FEB0  CB58    		bit    3,b             ; 00FEB0 CB 58
2577:	FEB2  2802    		jr     z,$feb6         ; 00FEB2 28 02
2578:	FEB4  C602    		add    a,$02           ; 00FEB4 C6 02
2579:	FEB6  CB50    		bit    2,b             ; 00FEB6 CB 50
2580:	FEB8  2802    		jr     z,$febc         ; 00FEB8 28 02
2581:	FEBA  C601    		add    a,$01           ; 00FEBA C6 01
2582:	FEBC  212F00  		ld     hl,$002f        ; 00FEBC 21 2F 00
2583:	FEBF  CB46    		bit    0,(hl)          ; 00FEBF CB 46
2584:	FEC1  2802    		jr     z,$fec5         ; 00FEC1 28 02
2585:	FEC3  C628    		add    a,$28           ; 00FEC3 C6 28
2586:	FEC5  322500  		ld     ($0025),a       ; 00FEC5 32 25 00
2587:	FEC8  78      		ld     a,b             ; 00FEC8 78
2588:	FEC9  E603    		and    $03             ; 00FEC9 E6 03
2589:	FECB  5F      		ld     e,a             ; 00FECB 5F
2590:	FECC  3A2E00  		ld     a,($002e)       ; 00FECC 3A 2E 00
2591:	FECF  FE95    		cp     $95             ; 00FECF FE 95
2592:	FED1  D0      		ret    nc              ; 00FED1 D0
2593:	FED2  0601    		ld     b,$01           ; 00FED2 06 01
2594:	FED4  D606    		sub    $06             ; 00FED4 D6 06
2595:	FED6  3803    		jr     c,$fedb         ; 00FED6 38 03
2596:	FED8  04      		inc    b               ; 00FED8 04
2597:	FED9  18F9    		jr     $fed4           ; 00FED9 18 F9
2598:	FEDB  C606    		add    a,$06           ; 00FEDB C6 06
2599:	FEDD  57      		ld     d,a             ; 00FEDD 57
2600:	FEDE  C384FE  		jp     $fe84           ; 00FEDE C3 84 FE
2601:	FEE1  00      		nop                    ; 00FEE1 00
2602:	FEE2  D5      		push   de              ; 00FEE2 D5
2603:	FEE3  CDC5FB  		call   $fbc5           ; 00FEE3 CD C5 FB
2604:	FEE6  D1      		pop    de              ; 00FEE6 D1
2605:	FEE7  212A00  		ld     hl,RAM0BUF        ; 00FEE7 21 2A 00
2606:	FEEA  DB8C    		in     a,(CRT6545ADST)         ; 00FEEA DB 8C
2607:	FEEC  CB7F    		bit    7,a             ; 00FEEC CB 7F
2608:	FEEE  28FA    		jr     z,$feea         ; 00FEEE 28 FA
2609:	FEF0  DB80    		in     a,(CRTRAM0DAT)         ; 00FEF0 DB 80
2610:	FEF2  77      		ld     (hl),a          ; 00FEF2 77
2611:	FEF3  23      		inc    hl              ; 00FEF3 23
2612:	FEF4  DB84    		in     a,(CRTRAM1DAT)         ; 00FEF4 DB 84
2613:	FEF6  77      		ld     (hl),a          ; 00FEF6 77
2614:	FEF7  23      		inc    hl              ; 00FEF7 23
2615:	FEF8  DB88    		in     a,(CRTRAM2DAT)         ; 00FEF8 DB 88
2616:	FEFA  77      		ld     (hl),a          ; 00FEFA 77
2617:	FEFB  3A2800  		ld     a,(RAM3BUF)       ; 00FEFB 3A 28 00
2618:	FEFE  CBA7    		res    4,a             ; 00FEFE CB A7
2619:	FF00  322800  		ld     (RAM3BUF),a       ; 00FF00 32 28 00
2620:	FF03  212A00  		ld     hl,RAM0BUF        ; 00FF03 21 2A 00
2621:	FF06  CB4A    		bit    1,d             ; 00FF06 CB 4A
2622:	FF08  2803    		jr     z,$ff0d         ; 00FF08 28 03
2623:	FF0A  23      		inc    hl              ; 00FF0A 23
2624:	FF0B  1806    		jr     $ff13           ; 00FF0B 18 06
2625:	FF0D  CB52    		bit    2,d             ; 00FF0D CB 52
2626:	FF0F  2802    		jr     z,$ff13         ; 00FF0F 28 02
2627:	FF11  23      		inc    hl              ; 00FF11 23
2628:	FF12  23      		inc    hl              ; 00FF12 23
2629:	FF13  7B      		ld     a,e             ; 00FF13 7B
2630:	FF14  CB42    		bit    0,d             ; 00FF14 CB 42
2631:	FF16  2802    		jr     z,$ff1a         ; 00FF16 28 02
2632:	FF18  C604    		add    a,$04           ; 00FF18 C6 04
2633:	FF1A  07      		rlca                   ; 00FF1A 07
2634:	FF1B  07      		rlca                   ; 00FF1B 07
2635:	FF1C  07      		rlca                   ; 00FF1C 07
2636:	FF1D  EB      		ex     de,hl           ; 00FF1D EB
2637:	FF1E  212F00  		ld     hl,$002f        ; 00FF1E 21 2F 00
2638:	FF21  CB4E    		bit    1,(hl)          ; 00FF21 CB 4E
2639:	FF23  2802    		jr     z,$ff27         ; 00FF23 28 02
2640:	FF25  CBF7    		set    6,a             ; 00FF25 CB F7
2641:	FF27  F686    		or     $86             ; 00FF27 F6 86
2642:	FF29  2174FF  		ld     hl,$ff74        ; 00FF29 21 74 FF
2643:	FF2C  E5      		push   hl              ; 00FF2C E5
2644:	FF2D  ED732D00		ld     ($002d),sp      ; 00FF2D ED 73 2D 00
2645:	FF31  2A2D00  		ld     hl,($002d)      ; 00FF31 2A 2D 00
2646:	FF34  2B      		dec    hl              ; 00FF34 2B
2647:	FF35  36C9    		ld     (hl),$c9        ; 00FF35 36 C9
2648:	FF37  2B      		dec    hl              ; 00FF37 2B
2649:	FF38  77      		ld     (hl),a          ; 00FF38 77
2650:	FF39  2B      		dec    hl              ; 00FF39 2B
2651:	FF3A  36CB    		ld     (hl),$cb        ; 00FF3A 36 CB
2652:	FF3C  2B      		dec    hl              ; 00FF3C 2B
2653:	FF3D  36EB    		ld     (hl),$eb        ; 00FF3D 36 EB
2654:	FF3F  E9      		jp     (hl)            ; 00FF3F E9
2655:			;;
2656:			;; CIGRTOG - toggle graphic mode on
2657:			;
2658:	FF40          	CIGRTOG:	
2659:	FF40  DB8C    		in     a,(CRT6545ADST)         ; 00FF40 DB 8C
2660:	FF42  CB7F    		bit    7,a             ; 00FF42 CB 7F
2661:	FF44  28FA    		jr     z,CIGRTOG         ; 00FF44 28 FA
2662:	FF46  DB8E    		in     a,(CRTRAM3PORT)         ; 00FF46 DB 8E
2663:	FF48  CBE7    		set    4,a             ; 00FF48 CB E7
2664:	FF4A  322800  		ld     (RAM3BUF),a       ; 00FF4A 32 28 00
2665:	FF4D  DB80    		in     a,(CRTRAM0DAT)         ; 00FF4D DB 80
2666:	FF4F  E1      		pop    hl              ; 00FF4F E1
2667:	FF50  E1      		pop    hl              ; 00FF50 E1
2668:	FF51  C9      		ret                    ; 00FF51 C9
2669:			;
2670:	FF52  00      		nop                    ; 00FF52 00
2671:	FF53  00      		nop                    ; 00FF53 00
2672:	FF54  00      		nop                    ; 00FF54 00
2673:	FF55  00      		nop                    ; 00FF55 00
2674:	FF56  00      		nop                    ; 00FF56 00
2675:	FF57  00      		nop                    ; 00FF57 00
2676:	FF58  00      		nop                    ; 00FF58 00
2677:			;; 
2678:			;; OUTGRBUF - set graphic mode, display RAM[012]BUF and revert to ascii
2679:			;
2680:	FF59          	OUTGRBUF:
2681:	FF59  CDB0F7  		call   GDCUA           ; 00FF59 CD B0 F7
2682:	FF5C  2B      		dec    hl              ; 00FF5C 2B
2683:	FF5D  3A2800  		ld     a,(RAM3BUF)       ; 00FF5D 3A 28 00
2684:	FF60  F5      		push   af              ; 00FF60 F5
2685:	FF61  E5      		push   hl              ; 00FF61 E5
2686:	FF62  CBA7    		res    4,a             ; 00FF62 CB A7
2687:	FF64  322800  		ld     (RAM3BUF),a       ; 00FF64 32 28 00
2688:	FF67  CD66FE  		call   DISPGR2           ; 00FF67 CD 66 FE
2689:	FF6A  E1      		pop    hl              ; 00FF6A E1
2690:	FF6B  F1      		pop    af              ; 00FF6B F1
2691:	FF6C  322800  		ld     (RAM3BUF),a       ; 00FF6C 32 28 00
2692:	FF6F  C360F0  		jp     SDCUAE           ; 00FF6F C3 60 F0
2693:			;
2694:	FF72  00      		nop                    ; 00FF72 00
2695:	FF73  00      		nop                    ; 00FF73 00
2696:	FF74  CD66FE  		call   DISPGR2           ; 00FF74 CD 66 FE
2697:	FF77  F1      		pop    af              ; 00FF77 F1
2698:	FF78  322900  		ld     (COLBUF),a       ; 00FF78 32 29 00
2699:	FF7B  E1      		pop    hl              ; 00FF7B E1
2700:	FF7C  2B      		dec    hl              ; 00FF7C 2B
2701:	FF7D  C360F0  		jp     SDCUAE           ; 00FF7D C3 60 F0
2702:	FF80  CDB0F7  		call   GDCUA           ; 00FF80 CD B0 F7
2703:	FF83  2B      		dec    hl              ; 00FF83 2B
2704:	FF84  E5      		push   hl              ; 00FF84 E5
2705:	FF85  210000  		ld     hl,$0000        ; 00FF85 21 00 00
2706:	FF88  0619    		ld     b,$19           ; 00FF88 06 19
2707:	FF8A  C5      		push   bc              ; 00FF8A C5
2708:	FF8B  0650    		ld     b,$50           ; 00FF8B 06 50
2709:	FF8D  CD60F0  		call   SDCUAE           ; 00FF8D CD 60 F0
2710:	FF90  DB8C    		in     a,(CRT6545ADST)         ; 00FF90 DB 8C
2711:	FF92  CB7F    		bit    7,a             ; 00FF92 CB 7F
2712:	FF94  28FA    		jr     z,$ff90         ; 00FF94 28 FA
2713:	FF96  DB8E    		in     a,(CRTRAM3PORT)         ; 00FF96 DB 8E
2714:	FF98  CB67    		bit    4,a             ; 00FF98 CB 67
2715:	FF9A  2004    		jr     nz,$ffa0        ; 00FF9A 20 04
2716:	FF9C  3E20    		ld     a,$20           ; 00FF9C 3E 20
2717:	FF9E  1806    		jr     $ffa6           ; 00FF9E 18 06
2718:	FFA0  DB80    		in     a,(CRTRAM0DAT)         ; 00FFA0 DB 80
2719:	FFA2  FE20    		cp     $20             ; 00FFA2 FE 20
2720:	FFA4  38F6    		jr     c,$ff9c         ; 00FFA4 38 F6
2721:	FFA6  CD75FA  		call   PRNCHR           ; 00FFA6 CD 75 FA
2722:	FFA9  CDB0F7  		call   GDCUA           ; 00FFA9 CD B0 F7
2723:	FFAC  10DF    		djnz   $ff8d           ; 00FFAC 10 DF
2724:	FFAE  3E0D    		ld     a,$0d           ; 00FFAE 3E 0D
2725:	FFB0  CD75FA  		call   PRNCHR           ; 00FFB0 CD 75 FA
2726:	FFB3  3E0A    		ld     a,$0a           ; 00FFB3 3E 0A
2727:	FFB5  CD75FA  		call   PRNCHR           ; 00FFB5 CD 75 FA
2728:	FFB8  C1      		pop    bc              ; 00FFB8 C1
2729:	FFB9  10CD    		djnz   $ff88           ; 00FFB9 10 CD
2730:	FFBB  E1      		pop    hl              ; 00FFBB E1
2731:	FFBC  C360F0  		jp     SDCUAE           ; 00FFBC C3 60 F0
2732:	FFBF  00      		nop                    ; 00FFBF 00
2733:			;;
2734:	FFC0  D5      		push   de              ; 00FFC0 D5
2735:	FFC1  5E      		ld     e,(hl)          ; 00FFC1 5E
2736:	FFC2  23      		inc    hl              ; 00FFC2 23
2737:	FFC3  56      		ld     d,(hl)          ; 00FFC3 56
2738:	FFC4  21A000  		ld     hl,$00a0        ; 00FFC4 21 A0 00
2739:	FFC7  EB      		ex     de,hl           ; 00FFC7 EB
2740:	FFC8  AF      		xor    a               ; 00FFC8 AF
2741:	FFC9  3E01    		ld     a,$01           ; 00FFC9 3E 01
2742:	FFCB  ED52    		sbc    hl,de           ; 00FFCB ED 52
2743:	FFCD  3002    		jr     nc,$ffd1        ; 00FFCD 30 02
2744:	FFCF  19      		add    hl,de           ; 00FFCF 19
2745:	FFD0  3D      		dec    a               ; 00FFD0 3D
2746:	FFD1  322F00  		ld     ($002f),a       ; 00FFD1 32 2F 00
2747:	FFD4  7D      		ld     a,l             ; 00FFD4 7D
2748:	FFD5  322D00  		ld     ($002d),a       ; 00FFD5 32 2D 00
2749:	FFD8  D1      		pop    de              ; 00FFD8 D1
2750:	FFD9  1A      		ld     a,(de)          ; 00FFD9 1A
2751:	FFDA  322E00  		ld     ($002e),a       ; 00FFDA 32 2E 00
2752:	FFDD  0A      		ld     a,(bc)          ; 00FFDD 0A
2753:	FFDE  CB47    		bit    0,a             ; 00FFDE CB 47
2754:	FFE0  212F00  		ld     hl,$002f        ; 00FFE0 21 2F 00
2755:	FFE3  2004    		jr     nz,$ffe9        ; 00FFE3 20 04
2756:	FFE5  CBCE    		set    1,(hl)          ; 00FFE5 CB CE
2757:	FFE7  1802    		jr     $ffeb           ; 00FFE7 18 02
2758:	FFE9  CB8E    		res    1,(hl)          ; 00FFE9 CB 8E
2759:	FFEB  C390FE  		jp     $fe90           ; 00FFEB C3 90 FE
2760:	FFEE  00      		nop                    ; 00FFEE 00
2761:	FFEF  00      		nop                    ; 00FFEF 00
2762:	FFF0          	SET3MIOB:
2763:	FFF0  214700  		ld     hl,MIOBYTE        ; 00FFF0 21 47 00
2764:	FFF3  CBDE    		set    3,(hl)          ; 00FFF3 CB DE
2765:	FFF5  C9      		ret                    ; 00FFF5 C9
2766:	FFF6          	RES3MIOB:	
2767:	FFF6  214700  		ld     hl,MIOBYTE        ; 00FFF6 21 47 00
2768:	FFF9  CB9E    		res    3,(hl)          ; 00FFF9 CB 9E
2769:	FFFB  C9      		ret                    ; 00FFFB C9
2770:	FFFC  00      		nop                    ; 00FFFC 00
2771:	FFFD  00      		nop                    ; 00FFFD 00
2772:	FFFE  00      		nop                    ; 00FFFE 00
2773:	FFFF  00      		nop                    ; 00FFFF 00
**** Z80-390-2532-DASM.asm ****



Statistics:

   391	symbols
  4096	bytes



Symbol Table:

alibn           f7a2     fdrvbuf        =  40     jfdcmd          f021+    
altprnprt      =   3     fgtrk           f506     jfseek          f027+    
bdnxt           f853     fillmem         f730     jfstat          f01e+    
bindisp         f851     filvramg        f126     jgethn          f036+    
bjmp1           f690     flme1           f733     jjndst          f400     
bjmp2           f683     flopio          f580     jmtrk0          f009     
bjmp3           f6a6+    floppyread      f574     jndsta          f3fd     
bjmp4           f6c4     floppywrit      f57b     jnxttr          f00f     
bjmp5           f6a2     fmemsiz         f67c     jprnch          f03c     
bjmp6           f6a1     fntrbuf        =  41     jreadb          f015+    
bjtab           f6a4     fok0            f4d7     jreads          f018+    
bloop           fac2     frdpbuf        =  45     jsecbf          f012+    
blp1            fac4     freadsec        f50d     jtrkof          f024+    
boot            f630     fretr0          f4c5     jusrcm          f030+    
c2jp1           fbab     fretr1          f4e5     jwrits          f01b+    
c2jp2           fbbb     frrdy           f536     kbdbyte        =  26     
c2jp3           fbcb     frwlp           f51c     kblp0           f436     
calchlde        fa38     frwnxt          f523     keybstrbbit    =   7+    
cbkend          f946     frwsec          f519     lindn           fd9b     
cfil1           fe58     frwword        =80d7     lpage           f697+    
chkbrk          f949     frwwro          f542     mco1            f751     
chkctr          f970     fsecbuf        =  42     mconx           f73f     
chkeor          f93c     fseclen        =  80     mdjmp0          fb7a     
chkhex          f95d     fseek           f4dc     mdjmp1          fb90     
chkkbd          fab9     fshtm           f56e     mdp1            f795     
chkkbdj         fb07     fstabuf        =  44     mdp2            f762     
chome           fc75     fterr           f509     mdp3            f786     
cibt1           f8a6     ftrkbuf        =  4a     mdp4            f788     
cieqb           f879     ftrkoff         f4b9     mdp5            f77a     
cigon           f889     fvlp0           f12c     mdp6            f75a     
cigrtog         ff40     fwend           f551     mdp7            f773     
cihcr           f8df     fwrdy           f547     memcomp         f73c     
cijp1           f7e7     fwritsec        f514     memdump         f757     
cijp2           f7c4     gdcua           f7b0     memmove         f808     
cijp3           f8ee     gentr           f6e4     memtest         f83a     
cijp4           f8f8     get1hnum        f6d3     miobyte        =  47     
cilop           f899     gethnum         f6de     mmnxt           f80b     
ciobyte        =  27     getkbd          f094     movdn           fb60     
ciprc           f87c     gfdcstat        f4af     movdn1          fb64     
cirbf           f861     gklp0           f09b     movend          fbe3     
ciren           f8db     gnxtc           f6e1     mprompt         fa5f     
cisti           f87d     goexec          f7a8     mterr           f84c     
cistp           f903     gram0buf       =3040     mtnxt           f83d     
citc1           f8b4     gram1buf       =3041+    mtrak0          f4c2     
citc2           f8bb     gram2buf       =3042     ndh1            f244     
clreol          fcd6     gram3buf       =3043     ndh2            f259     
clrj0           fcc7     greet           fa99     ndh3            f26e     
clrlin          fdc0     h2aj1           fa4e     ndh4            f2de     
clrlin1         fdc3     h2aj2           fa57     ndh5            f2b1     
clrlp1          fdcc     h2aj3           fa5c     ndh6            f2c2     
clrscr          fc86     hehex           f6da     ndh7            f290     
clrscrgr        f0e7     hl2asc          fa46     ndossta         f403     
clsnc           fc9b     hl2ascb         fa63     ndshw           f227     
coire           fa98     hnhex           f6f2     ndsj1           f1a2     
coiupc          fa89     iclp0           f0ce     ndsj2           f1aa     
cojp1           fb3c     iclp1           f0da     ndsj3           f1ca     
cojp2           fb4b     ictlp0          f610     ndsj4           f1e4     
colbuf         =  29     icurtrbuf       f498     ndsj5           f1b0     
conin           f866     inicrt          f0a5     ndslp0          f170     
conou2          fb98     inicrtcur       fc39     ndslp1          f190     
conout          fb10     inicrtreg       f606     ndslp2          f182     
constr          fa9c     inirdpbuf       f493     ndslp3          f152     
coutch          f92b     init0           f5c8     ndsrdsec        f1f5     
cpmboot         f461     inxttrbuf       f489     ndst1           f40f     
crlftab         f602     iocac2          fd7d     nedoscr         f13d     
crt6545adst    =  8c     iocack         =fc39     nedosini        f5b5     
crt6545data    =  8d     iocbas2         fd0f     nib2asc         fde0     
crtbase        =  80     iocbase         fc30     nrd1            f201     
crtbeepport    =  8f     iocbe2          fd53     nrd2            f211     
crtblinkbit    =   0+    iocbel          fc43     nrd3            f21d     
crtfil          fe4a     iocbs           fc46     nrd4            f20e     
crthilitbit    =   3+    iocbs1          fc56     ocjpv           fa72     
crtkeybcnt     =  87     iocbs2          fc66     ocrlf1          fab1     
crtkeybdat     =  85     iocca2          fd2f     outchr          fa68     
crtmodebit     =   4+    ioccan          fd05     outcrlf         fab0     
crtprgend       f086     ioccr           fcaa     outgrbuf        ff59     
crtprntcnt     =  83     ioccr1          fcb2     pop1prm         f6dc     
crtprntdat     =  81     iocd12          fd8f     pop2prm         faab     
crtram0cnt     =  82     iocdc1         =fcff     pop3num         f933     
crtram0dat     =  80     iocdc2          fdad     portin          f7f8     
crtram1cnt     =  86     iocdc3          fdb0     portout         f800     
crtram1dat     =  84     iocdc4         =fd9b     prnchr          fa75     
crtram2cnt     =  8a     iocdle          fd5f     prntbusybit    =   0     
crtram2dat     =  88     iocem           fd33     ram0buf        =  2a     
crtram3port    =  8e     iocen2          fd4d     ram1buf        =  2b+    
crtrevrsbit    =   1+    iocenq          fcce     ram2buf        =  2c     
crtservcnt     =  8b     ioceo2          fd77     ram3buf        =  28     
crtservdat     =  89     ioceot          fd0b     ramblk          f9f2     
crttab          f2f5     ioces2          fd71     rdrr19r12       f0d8     
crttab1         f5a1     iocesc          fcf8     res3miob        fff6     
crttabuf       =  10     iocet2          fdb3     resattr         fcff     
crtunderbit    =   2+    iocetb          fcec     rwm1            f82f     
crtwidthbit    =   1+    iocetx          fd47     rwm2            f831     
csglp0          f0fc     iocff          =fc86     rwm3            f816     
cslp0           fa9d     iocff2          fdf0     rwmem           f812     
curbfb          fbf8     iocfs           fcf0     savcolb         fb5c     
curbfl          fbfc     iocfs2          fd41     savsecbuf       f48e     
curblb          fbf0     iocgs           fcf4     scrtst          fa20     
curbll          fbf4     iocgs2          fd65     scurof          f07e     
curfxb          fc04+    iocht           fd83     scuron          f08b     
curfxl          fc08     ioclf           fcfc     sdcuae          f060     
curofb          fc00+    iocnak          fd10     sdcuae1         f06e     
curpbuf        =  48     iocnul          fda9     sdrr11r0        f0cc+    
curpbufh       =  49+    iocrs           fd08     sdsta           f90e     
currgt          fb4e     iocrs2          fd95     set3miob        fff0     
cursetmode      fc0a     iocs2           fd59     sfdccmd         f49d     
dblank          fe40     iocsi          =fcd6     sndcl           f49e     
dclp0           f7dd     iocsi2          fd89     spacer          fa66     
dgclp0          f114     iocso           fcb5     str001          f301     
dismvc          fc24     iocso2          fd3b     str002          f318     
dispch          f7d0     iocsoh          fc31     str003          f31f     
dispgr          f044     iocst2          fd6b     str004          f339     
dispgr2         fe66     iocstx          fc35     str005          f356     
dispgrch        f113     iocsub          fd37     str006          f375     
dispnortr       fe6c     iocsy2          fd13     str007          f3a4     
dispstr         f2e1     iocsyn          fce8     str008          f3b6     
dlight          fc16     iocus           fcd1     str009          f3d3     
dmpalia         f7a0     iocus2          fd29     str010          f3d9     
dmpalib         f79b     iocvec          fe00     str011          f3e9     
dogetchr        f928     iocvec2         fe20     str100          f5e2     
doprompt        f925     iocvt          =fc75     togju           fa1d     
drvsel          f450     iocvt2          fdea     togpr           fa1b     
dshft           f459     iptrckbd        f948     togprnio        fa10     
dslp0           f2eb     jboot           f000     ucmdtab         fad2     
fcmdbuf        =  43     jchkkb          f039+    ucrej           f6fd     
fdcbase        =  d0     jconin          f003     urestr          fa0f     
fdccmdstatr    =  d0     jconou          f006     usrcmd          f703     
fdcdatareg     =  d7     jcpmbo          f033     valgetchr       f96d     
fdcdrvrcnt     =  d6     jcurtr          f00c+    vcresreg        fbde     
fdcsectreg     =  d2     jdispn          f02d+    
fdctrakreg     =  d1     jdrvsl          f02a+    
