   1:			;
   2:			;=======================================================================
   3:			;
   4:			; CP/M 3 Z80 DarkStar (NE Z80) Porting
   5:			;
   6:			;=======================================================================
   7:			;;---------------------------------------------------------------------
   8:			;; Version      : 1.0 - 20140904
   9:			;; Assemble     : SLR z80asm
  10:			;; Revisions:
  11:			;; 20140905	- Code start
  12:			;;---------------------------------------------------------------------
  13:			
  14:			
  15:				TITLE	'CPMLDR BIOS FOR CP/M 3.1'
  16:			
  17:				.Z80
  18:			
  19:				; define logical values:
  20:				include	common.inc
**** common.inc ****
   1:			;
   2:			;=======================================================================
   3:			;
   4:			; CP/M 3 Z80 DarkStar (NE Z80) Porting
   5:			;
   6:			;=======================================================================
   7:			;;---------------------------------------------------------------------
   8:			;; Version      : 1.0 - 20140904
   9:			;; Assemble     : m80
  10:			;; Revisions:
  11:			;; 20140904	- Code start
  12:			;;---------------------------------------------------------------------
  13:			;
  14:			; Here just some common symbol...
  15:			;
  16:				; SYSBIOS equates
  17:				include	darkstar.equ
**** darkstar.equ ****
   1:			;****** Equ's file autogenerated by genequs ver: 1.0
   2:			;****** Input files:
   3:			;****** SysCommon.lst
   4:	FE77'         	TX0            	EQU	0FE77H
   5:	FDC4'         	FIN            	EQU	0FDC4H
   6:	FE79'         	TX01           	EQU	0FE79H
   7:	FD89'         	DLY1           	EQU	0FD89H
   8:	FD87'         	DLY2           	EQU	0FD87H
   9:	FDE1'         	FOUT           	EQU	0FDE1H
  10:	FE65'         	U1NUL          	EQU	0FE65H
  11:	FE25'         	U0ISR          	EQU	0FE25H
  12:	FE5B'         	U1ISR          	EQU	0FE5BH
  13:	FD85'         	DELAY          	EQU	0FD85H
  14:	FE50'         	UISRE          	EQU	0FE50H
  15:	FDB5'         	FSTAT          	EQU	0FDB5H
  16:	FE35'         	UISRI          	EQU	0FE35H
  17:	FE6F'         	DOSTX          	EQU	0FE6FH
  18:	FC4B'         	BBU1ST         	EQU	0FC4BH
  19:	FC45'         	BBU1RX         	EQU	0FC45H
  20:	FC3F'         	BBU1TX         	EQU	0FC3FH
  21:	FD29'         	BBEXEC         	EQU	0FD29H
  22:	FCFF'         	BBHDRD         	EQU	0FCFFH
  23:	FD6A'         	BBVOID         	EQU	0FD6AH
  24:	FE92'         	UASTKB         	EQU	0FE92H
  25:	FD6B'         	MMPMAP         	EQU	0FD6BH
  26:	FE0F'         	INTRDI         	EQU	0FE0FH
  27:	FC2D'         	SCONIN         	EQU	0FC2DH
  28:	FC15'         	VCONIN         	EQU	0FC15H
  29:	FCDB'         	BBDIV16        	EQU	0FCDBH
  30:	FCF9'         	BBHDWR         	EQU	0FCF9H
  31:	FD78'         	MMGETP         	EQU	0FD78H
  32:	FDFE'         	INTREN         	EQU	0FDFEH
  33:	FE85'         	RLDROM         	EQU	0FE85H
  34:	FCE1'         	BBMUL16        	EQU	0FCE1H
  35:	FC00'         	SYSCOM         	EQU	0FC00H
  36:	FE90'         	UASTAV         	EQU	0FE90H
  37:	FE19'         	SYTIMR         	EQU	0FE19H
  38:	FC33'         	SCONST         	EQU	0FC33H
  39:	FC1B'         	VCONST         	EQU	0FC1BH
  40:	FE6D'         	SRXRSM         	EQU	0FE6DH
  41:	FE69'         	SRXSTP         	EQU	0FE69H
  42:	FC39'         	BBU0INI        	EQU	0FC39H
  43:	FC51'         	BBU1INI        	EQU	0FC51H
  44:	FC87'         	BBFREAD        	EQU	0FC87H
  45:	FD23'         	BBEIDCK        	EQU	0FD23H
  46:	FD05'         	BBHDGEO        	EQU	0FD05H
  47:	FEC0'         	BBSTACK        	EQU	0FEC0H
  48:	FC81'         	BBFHOME        	EQU	0FC81H
  49:	FD94'         	BBCONIN        	EQU	0FD94H
  50:	FFF0'         	SINTVEC        	EQU	0FFF0H
  51:	FEC0'         	SYSCMLO        	EQU	0FEC0H
  52:	FE22'         	VOIDISR        	EQU	0FE22H
  53:	FC9F'         	BBSTTIM        	EQU	0FC9FH
  54:	FDAA'         	BBCONST        	EQU	0FDAAH
  55:	FC27'         	SCONOUT        	EQU	0FC27H
  56:	FC0F'         	VCONOUT        	EQU	0FC0FH
  57:	FCE7'         	BBOFFCAL       	EQU	0FCE7H
  58:	FC57'         	BBINICTC       	EQU	0FC57H
  59:	FE9C'         	BBSTBASE       	EQU	0FE9CH
  60:	FC5D'         	BBRESCTC       	EQU	0FC5DH
  61:	FCA5'         	BBRDTIME       	EQU	0FCA5H
  62:	FD5A'         	BBCALRET       	EQU	0FD5AH
  63:	FCB7'         	BBDMASET       	EQU	0FCB7H
  64:	FCBD'         	BBDSKSEL       	EQU	0FCBDH
  65:	FCED'         	BBHDINIT       	EQU	0FCEDH
  66:	FCB1'         	BBSECSET       	EQU	0FCB1H
  67:	FD0B'         	BBHDBOOT       	EQU	0FD0BH
  68:	FC69'         	BBUPLCHR       	EQU	0FC69H
  69:	FC99'         	BBPRNCHR       	EQU	0FC99H
  70:	FCC9'         	BBVCPMBT       	EQU	0FCC9H
  71:	FC93'         	BBFLOPIO       	EQU	0FC93H
  72:	FD1D'         	BBEPMNGR       	EQU	0FD1DH
  73:	FCCF'         	BBSIDSET       	EQU	0FCCFH
  74:	FD11'         	BBLDPART       	EQU	0FD11H
  75:	FC75'         	BBRDVDSK       	EQU	0FC75H
  76:	FC8D'         	BBFWRITE       	EQU	0FC8DH
  77:	FCC3'         	BBCPBOOT       	EQU	0FCC3H
  78:	FC21'         	BBCURSET       	EQU	0FC21H
  79:	FCAB'         	BBTRKSET       	EQU	0FCABH
  80:	FC7B'         	BBWRVDSK       	EQU	0FC7BH
  81:	FD9F'         	BBCONOUT       	EQU	0FD9FH
  82:	FCF3'         	BBDRIVEID      	EQU	0FCF3H
  83:	FC63'         	BBPSNDBLK      	EQU	0FC63H
  84:	FC03'         	BBCRTCINI      	EQU	0FC03H
  85:	FC6F'         	BBPRCVBLK      	EQU	0FC6FH
  86:	FC09'         	BBCRTFILL      	EQU	0FC09H
  87:	FCD5'         	BBFDRVSEL      	EQU	0FCD5H
  88:	FD17'         	BBDPRMSET      	EQU	0FD17H
  89:			;****** EOF ***
  90:			
**** common.inc ****
  18:			
  19:	FFFF'         	TRUE	EQU	-1
  20:	0000'         	FALSE	EQU	0
  21:			
  22:			
  23:				; determine if for bank select or not:
  24:	FFFF'         	BANKED	EQU	TRUE		;< ... BANKED VERSION
  25:	0000'         	ZPM3	EQU	FALSE		; ZPM3 build ?
  26:			
  27:				;
  28:				; some other equs...
  29:				;
  30:	000D'         	CR	EQU     0DH		; CARRIAGE RETURN
  31:	000A'         	LF	EQU     0AH		; LINE FEED;
  32:	000C'         	FF	EQU	0CH		; FORM FEED (clear screen)
  33:			
  34:			
  35:			;
  36:			; COMMON.ASM [EOF]
  37:			
**** hldrbios.asm ****
  21:				include syshw.inc
**** syshw.inc ****
   1:			;
   2:			;=======================================================================
   3:			;
   4:			; Modular Z80 DarkStar (NE Z80) SysBios
   5:			;
   6:			;=======================================================================
   7:			;
   8:			; Original code:
   9:			; Z80 Nuova Elettronica Monitor 390 su eprom 2532 (4k)
  10:			;
  11:			; Disassembled and reconstructed by
  12:			; Piergiorgio Betti <pbetti@lpconsul.net> on 2005 01 26
  13:			;
  14:			; Latest non modular BIOS is DARKSTAR-MONITOR-0.9.0.asm
  15:			; dated 20140531
  16:			; - Following addition of MultiF-Board doing complete rewrite of the
  17:			;   monitor/BIOS has been started.
  18:			;   Major goals:
  19:			;   o Modularization: Now monitor can grow up to 256kb instead of 4kb
  20:			;     :-)
  21:			;   o Specialized images fitted in memory page (4kb) or multiples
  22:			;   o Full support for new hardware
  23:			;   o I/O rewrite for MODE 2 interrupts
  24:			;   Minor goals:
  25:			;   o Full code clean-up & reoarganization
  26:			; ---------------------------------------------------------------------
  27:			; Revisions:
  28:			; 20140905 - Modified hexadecimal constants to 0xxH format to be widely
  29:			;            accepted by different assemblers
  30:			; 20150714 - Modified to implement serial XON/XOFF and RTS/CTS
  31:			; ---------------------------------------------------------------------
  32:			
  33:			; ---------------------------------------------------------------------
  34:			; SYSBIOS
  35:			;
  36:			; This is the BIOS non-resident portion of the new (banked)
  37:			; BIOS/Monitor for the NE Z80 (aka DarkStar)
  38:			;
  39:			; ---------------------------------------------------------------------
  40:			;
  41:			; Full BIOS memory scheme:
  42:			;
  43:			;	+-----------------+
  44:			;	+    SysCommon    +   <-- Resident portion. Common to all images
  45:			;	+   FC00 - FFFF   +
  46:			;	+-----------------+
  47:			;	+-----------------+   +-----------------+   +-----------------+
  48:			;	+     SysBios     +   +   BootMonitor   +   +     [Other]     +
  49:			;	+   F000 - FBFF   +   +   F000 - FBFF   +   +   F000 - FBFF   +
  50:			;	+-----------------+   +-----------------+   +-----------------+
  51:			;
  52:			;	         ^                     ^                     ^
  53:			;	         |                     |                     |
  54:			;	         ---------------------------------------------
  55:			;	                      Variable section
  56:			;
  57:			; The above are always assembled at ORG F000 and linked and allocated
  58:			; in the EEPROM in this way:
  59:			;
  60:			;	+-----------------+
  61:			;	+    SysCommon    +
  62:			;	+   FC00 - FFFF   +
  63:			;	+     SysBios     +     <-- EEPROM page 1 ($C1000)
  64:			;	+   F000 - FBFF   +
  65:			;	+-----------------+
  66:			;	+-----------------+
  67:			;	+    SysCommon    +
  68:			;	+   FC00 - FFFF   +
  69:			;	+   BootMonitor   +     <-- EEPROM page 0 ($C0000)
  70:			;	+   F000 - FBFF   +
  71:			;	+-----------------+
  72:			;
  73:			; ---------------------------------------------------------------------
  74:			;
  75:			; Define which assembler we are using
  76:			;
  77:			
  78:			; PASMO	EQU	1
  79:	0001'         	MZMAC	EQU	1
  80:			; ZMAC	EQU	1			; ZMAC Z80 assembler, not Linux/Unix version
  81:			
  82:			; ... only one at a time can be active (1) ...
  83:			
  84:			;
  85:			; Monitor version numbers (major.minor)
  86:			;
  87:	0033'         	MONMAJ		EQU	'3'
  88:	0034'         	MONMIN		EQU	'4'
  89:			
  90:			;
  91:			; Buffers addresses labels
  92:			;
  93:			
  94:			; -- Global --
  95:	0003'         	IOBYTE		EQU	0003H		; byte: Intel IOBYTE (CP/M 2.2 only)
  96:	0004'         	CDISK		EQU	0004H		; byte: Last logged drive
  97:	0006'         	BTPASIZ		EQU	0006H		; word: size of tpa + 1
  98:			;
  99:			; -- Private --
 100:	000B'         	HMEMPAG		EQU	000BH		; byte: highest ram page
 101:	000C'         	BBCBANK		EQU	000CH		; byte: current bank
 102:	000D'         	BBCSTCK		EQU	000DH		; word: current stack
 103:					;
 104:	004F'         	PRVTOP		EQU	004FH		; top of private area storage
 105:	004F'         	COLBUF		EQU	PRVTOP		; byte:
 106:	004E'         	DSELBF		EQU	COLBUF-1	; byte: floppy drive select status
 107:								; - bits: 0 = drive 0
 108:								; - bits: 1 = drive 1
 109:								; - bits: 2 = drive 2
 110:								; - bits: 3 = drive 3
 111:								; - bits: 4 = unused
 112:								; - bits: 5 = head select
 113:								; - bits: 6 = motor on (disabled by jumper)
 114:								; - bits: 7 = unused
 115:	004D'         	KBDBYTE		EQU	DSELBF-1	; byte: store keyboard input
 116:	004C'         	MIOBYTE		EQU	KBDBYTE-1	; byte:
 117:								; - bits: 0: 0 = floppy write		1 = floppy read
 118:								;         1: 0 = no ctrl on keypress	1 = ctrl on keypress
 119:								;         2: 0 = scroll			1 = no scroll
 120:								;         3: 0 = accept lowercase	1 = convert to uppercase
 121:								;         4: 0 = destr. bkspace		1 = non destr. bkspace
 122:								;         5: 0 = console out		1 = serial out
 123:								;         6: 0 = disp. all chars	1 = obscure non punct.
 124:								;         7: 0 = ctrl chr set 1		1 = ctrl chr set 2
 125:	004B'         	TMPBYTE		EQU	MIOBYTE-1	; byte: transients flags
 126:								; - bits: 0: 0 = high in cursor addressing
 127:								;         1: 0 = ESC catched by ANSI driver
 128:								;         2: 0 = CSI catched by ANSI driver
 129:								;         3: 0 = Two byte code ESC seq. from serial
 130:								;         4: 0 = Plain serial i/o (disable ANSI driver)
 131:								;         5: 0 = store interrupt status (on/off)
 132:								;         6: 0 = floppy home on err	1 = no home on err
 133:								;         7: 0 = unlock LBA free addressing (unpartitioned)
 134:	004A'         	CURSSHP		EQU	TMPBYTE-1	; cursor shape
 135:	0048'         	CURPBUF		EQU	CURSSHP-2	; word: cursor position
 136:	0046'         	FTRKBUF		EQU	CURPBUF-2	; word: track # for i/o (0 - 65535)
 137:	0045'         	FDRVBUF		EQU	FTRKBUF-1	; byte: drive number for i/0 (0 - 15)
 138:	0043'         	FSECBUF		EQU	FDRVBUF-2	; word: sector # for i/o (1 .. 65535)
 139:	0041'         	FRDPBUF		EQU	FSECBUF-2	; word: dma address for i/o
 140:	003F'         	FSEKBUF		EQU	FRDPBUF-2	; word: current track number for drive A/B
 141:	003E'         	RAM3BUF		EQU	FSEKBUF-1	; byte:
 142:	003D'         	RAM2BUF		EQU	RAM3BUF-1	; byte:
 143:	003C'         	RAM1BUF		EQU	RAM2BUF-1	; byte:
 144:	003B'         	RAM0BUF		EQU	RAM1BUF-1	; byte:
 145:	003A'         	RST7SP3		EQU	003AH		; keep clear area of RST38 (RST7)
 146:	0039'         	RST7SP2		EQU	0039H
 147:	0038'         	RST7SP1		EQU	0038H
 148:	002F'         	RSRVBUF		EQU	RST7SP1-9	; free 9 byte buffer
 149:	002D'         	APPBUF		EQU	RSRVBUF-2	; word: generic buffer
 150:	002C'         	COPSYS		EQU	APPBUF-1	; Op system type for partition selection
 151:	002B'         	UART0BR		EQU	COPSYS-1	; UART 0 baudrate
 152:	002A'         	UART1BR		EQU	UART0BR-1	; UART 1 baudrate
 153:	0029'         	CTC0TC		EQU	UART1BR-1	; CTC channel 0 time constant
 154:	0028'         	CTC1TC		EQU	CTC0TC-1	; CTC channel 1 time constant
 155:	0027'         	TIMRCON		EQU	CTC1TC-1	; timer buf
 156:	0026'         	CNFBYTE		EQU	TIMRCON-1	; config byte
 157:								; - bits: 0: 0 = UART1 intr disabled	1 = RST8 redir UART1
 158:								;         1: 1 = XON/XOFF enabled on UART0
 159:								;         2: 1 = RTS/CTS enabled on UART0
 160:								;         3: 0 = unused/reserved
 161:								;         4: 0 = unused/reserved
 162:								;         5: 0 = unused/reserved
 163:								;         6: 0 = unused/reserved
 164:								;         7: 0 = unused/reserved
 165:	000F'         	FIFOSTO		EQU	000FH		; fifo queues storage start
 166:	0008'         	FIFSIZE		EQU	8		; fifo queue lenght
 167:	000B'         	FIFBLOK		EQU	11		; fifo queue size
 168:	000F'         	FIFOU0		EQU	FIFOSTO		; uart 0 queue (alternate console)
 169:	001A'         	FIFOKB		EQU	FIFOU0+FIFBLOK	; keyboard queue
 170:	0025'         	FIFOEND		EQU	FIFOKB+FIFBLOK	; fifo blocks end
 171:			;
 172:	3000'         	BLDOFFS		EQU	3000H		; place for disk bootloader
 173:			
 174:			;
 175:			; Some commodity equs
 176:			;
 177:	000D'         	CR		EQU	0DH		; ascii CR & LF
 178:	000A'         	LF		EQU	0AH
 179:	000C'         	FF		EQU	0CH		; FORM FEED (clear screen)
 180:	001B'         	ESC		EQU	1BH		; ESCape
 181:	0011'         	XONC		EQU	11H		; Xon
 182:	0013'         	XOFC		EQU	13H		; Xoff
 183:	FFFF'         	TRUE		EQU	-1
 184:	0000'         	FALSE		EQU	0
 185:	0100'         	TPA		EQU	0100H		; TPA base address (for CP/M)
 186:			
 187:			;
 188:			; Modules equs
 189:			;
 190:				; delay
 191:	00F6'         	MSCNT		EQU	246
 192:				; mmu
 193:	000D'         	MMUTSTPAGE	EQU	0DH		; logical page used for sizing
 194:	D000'         	MMUTSTADDR	EQU	MMUTSTPAGE<<12	; logical page used for sizing
 195:			
 196:			; Conventionally all bios/monitor images start at $F000.
 197:			; Except for special cases all code is copied to ram @ $F000.
 198:			; In this case eeprom page 0 is directly mapped into logical space
 199:			; by hardware so we can initialize the system at cold boot.
 200:			;
 201:			; We assume to initialize MMU as follow:
 202:			;
 203:			; +--------+
 204:			; |  F000  |	-> $C0000  eeprom page 0
 205:			; +--------+
 206:			; +--------+
 207:			; |  EFFF  |
 208:			; +--------+
 209:			;     ...       -> $00000 to $0EFFF ram
 210:			; +--------+
 211:			; |  0000  |
 212:			; +--------+
 213:			;
 214:			
 215:			
 216:			; include	modules/hwequs.inc.asm
 217:			; Hardware equates
 218:			; ---------------------------------------------------------------------
 219:			
 220:			; ---------------------------------------------------------------------
 221:			; LX529 VIDEO BOARD:
 222:			; ---------------------------------------------------------------------
 223:	0080'         	CRTBASE		EQU	80H
 224:				; RAM0 for ascii chars & semi6. Combined with RAM1 and RAM2 for graphics
 225:	0080'         	CRTRAM0DAT	EQU	CRTBASE		; RAM0 access: PIO0 port A data register
 226:	0082'         	CRTRAM0CNT	EQU	CRTBASE+2	; RAM0 access: PIO0 port A control register
 227:				; Printer port
 228:	0081'         	CRTPRNTDAT	EQU	CRTBASE+1	; PRINTER (output): PIO0 port B data register
 229:	0083'         	CRTPRNTCNT	EQU	CRTBASE+3	; PRINTER (output): PIO0 port B control register
 230:								; STROBE is generated by hardware
 231:				; RAM1 for graphics. (pixel index by RAM0+RAM1+RAM2)
 232:	0084'         	CRTRAM1DAT	EQU	CRTBASE+4	; RAM1 access: PIO1 port A data register
 233:	0086'         	CRTRAM1CNT	EQU	CRTBASE+6	; RAM1 access: PIO1 port A control register
 234:				; Keyboard port (negated). Bit 7 is for strobe
 235:	0085'         	CRTKEYBDAT	EQU	CRTBASE+5	; KEYBOARD (input): PIO1 port B data register
 236:	0087'         	CRTKEYBCNT	EQU	CRTBASE+7	; KEYBOARD (input): PIO1 port B control register
 237:	0007'         	KEYBSTRBBIT	EQU	7		; Strobe bit
 238:				; RAM2 for graphics. (pixel index by RAM0+RAM1+RAM2)
 239:	0088'         	CRTRAM2DAT	EQU	CRTBASE+8	; RAM2 access: PIO2 port A data register
 240:	008A'         	CRTRAM2CNT	EQU	CRTBASE+10	; RAM2 access: PIO2 port A control register
 241:				; Service/User port
 242:	0089'         	CRTSERVDAT	EQU	CRTBASE+9	; Service (i/o): PIO2 port B data register
 243:	008B'         	CRTSERVCNT	EQU	CRTBASE+11	; Service (i/o): PIO2 port B control register
 244:	0000'         	PRNTBUSYBIT	EQU	0		; Printer BUSY bit		(in)	1
 245:	0001'         	CRTWIDTHBIT	EQU	1		; Set 40/80 chars per line	(out)	0
 246:	0002'         	PIO2BIT2	EQU	2		; user 1 (input)		(in)	1
 247:	0003'         	PIO2BIT3	EQU	3		; user 2 (input)		(in)	1
 248:	0004'         	PIO2BIT4	EQU	4		; user 3 (input)		(in)	1
 249:	0005'         	CLKSCLK		EQU	5		; DS1320 clock line		(out)	0
 250:	0006'         	CLKIO		EQU	6		; DS1320 I/O line		(i/o)	1
 251:	0007'         	CLKRST		EQU	7		; DS1320 RST line		(out)	0
 252:				; normal set for PIO2 (msb) 01011101 (lsb) that is hex $5D
 253:								; Other bits available to user
 254:				; RAM3 control chars/graphics attributes
 255:	008E'         	CRTRAM3PORT	EQU	CRTBASE+14	; RAM3 port
 256:	0000'         	CRTBLINKBIT	EQU	0		; Blink
 257:	0001'         	CRTREVRSBIT	EQU	1		; Reverse
 258:	0002'         	CRTUNDERBIT	EQU	2		; Underline
 259:	0003'         	CRTHILITBIT	EQU	3		; Highlight
 260:	0004'         	CRTMODEBIT	EQU	4		; ASCII/GRAPHIC mode
 261:				; Beeper port
 262:	008F'         	CRTBEEPPORT	EQU	CRTBASE+15	; Beeper port
 263:				; 6545 CRT controller ports
 264:	008C'         	CRT6545ADST	EQU	CRTBASE+12	; Address & Status register
 265:	008D'         	CRT6545DATA	EQU	CRTBASE+13	; Data register
 266:				; Cursor modes
 267:	0040'         	BLISLOWBLOK	EQU	40H		; Blink, slow, block
 268:	004A'         	BLISLOWLINE	EQU	4AH		; Blink, slow, line
 269:	0060'         	BLIFASTBLOK	EQU	60H		; Blink, fast, block
 270:	006A'         	BLIFASTLINE	EQU	6AH		; Blink, fast, line
 271:	0020'         	CURSOROFF	EQU	20H		; Off
 272:	0000'         	FIXBLOCK	EQU	00H		; Fixed, block
 273:	000A'         	CURSORON	EQU	0AH		; On
 274:			
 275:			; ---------------------------------------------------------------------
 276:			; LX390 FDC CONTROLLER:
 277:			; ---------------------------------------------------------------------
 278:	00D0'         	FDCBASE		EQU	0D0H
 279:	00D0'         	FDCCMDSTATR	EQU	FDCBASE		; Command and status register
 280:	00D1'         	FDCTRAKREG	EQU	FDCBASE+1	; Track register
 281:	00D2'         	FDCSECTREG	EQU	FDCBASE+2	; Sector register
 282:	00D7'         	FDCDATAREG	EQU	FDCBASE+7	; Data register *** Verificare che sia $d7
 283:	00D6'         	FDCDRVRCNT	EQU	FDCBASE+6	; Driver select/control register
 284:			;
 285:	0007'         	FDCRESTC	EQU	00000111b	; 1771 restore (seek to trak 0) cmd
 286:	0017'         	FDCSEEKC	EQU	00010111b	; seek cmd
 287:	0088'         	FDCREADC	EQU	10001000b	; read cmd
 288:	00A8'         	FDCWRITC	EQU	10101000b	; write cmd
 289:	00D0'         	FDCRESET	EQU	11010000b	; fdc reset immediate cmd
 290:			;
 291:			; ---------------------------------------------------------------------
 292:			; LX389: PARALLEL INTERFACE
 293:			; ---------------------------------------------------------------------
 294:			; alternate printer port
 295:	0003'         	ALTPRNPRT	EQU	03H
 296:			;
 297:			; parallel port PC link
 298:	0003'         	PPDATAP		EQU	03H		; Data port
 299:	0002'         	PPCNTRP		EQU	02H		; Control port
 300:	0000'         	PPSTROB		EQU	0		; Strobe bit
 301:	0001'         	PPAKSTB		EQU	1		; Acknowledge/Stop bit
 302:			;
 303:	0000'         	PPDINI		EQU	00H		; 00000000 Dnl Init byte
 304:	0004'         	PPDRDY		EQU	04H		; 00000100 Dnl Ready
 305:	0006'         	PPDSTP		EQU	06H		; 00000110 Dnl Stop
 306:	0002'         	PPDOKG		EQU	02H		; 00000010 Dnl Ok Go
 307:	0001'         	PPUINI		EQU	01H		; 00000001 Upl Init byte
 308:	0005'         	PPURDY		EQU	05H		; 00000101 Upl Ready
 309:	0007'         	PPUACK		EQU	07H		; 00000111 Upl Acknowledge
 310:	0003'         	PPUOKG		EQU	03H		; 00000011 Upl Ok Go
 311:			;
 312:			; virtual disks (PC-linked over parallel port)
 313:	0000'         	VDRDSEC		EQU	0		; read sector command
 314:	0001'         	VDWRSEC		EQU	1		; write sector command
 315:	000A'         	VDBUFSZ		EQU	10		; 10 bytes block
 316:			; ---------------------------------------------------------------------
 317:			; MULTF-BOARD: MMU, IDE, SERIAL, CTC
 318:			; ---------------------------------------------------------------------
 319:			; -- I/O --
 320:	0020'         	MMUPORT		EQU	20H
 321:	0021'         	MENAPRT		EQU	21H
 322:			; -- Map --
 323:	00C0'         	EEPAGE0		EQU	0C0H		; page 0 of eeprom
 324:	F000'         	EEPSTA		EQU	0F000H		; eeprom location after MMU reset
 325:	00EF'         	MMTPAPAG	EQU	(EEPSTA>>8)-1	; TPA top page (256 bytes pages)
 326:	00FF'         	IMTPAG		EQU	0FFH		; eeprom page with image table
 327:	0400'         	IMTSIZ		EQU	1024		; size
 328:	E000'         	RAMTBL		EQU	0E000H		; ram table location
 329:	0030'         	TBLBLK		EQU	48		; block size
 330:	0014'         	MAXBLK		EQU	20		; max images
 331:	03C0'         	RTBSIZ		EQU	TBLBLK * MAXBLK	; real table size
 332:								; A table block is:
 333:	0008'         	TNAMELEN	EQU	8		;	name		: 8 bytes
 334:	0002'         	TPAGELEN	EQU	2		;	page offset	: 2 bytes
 335:	0004'         	TIADDRLEN	EQU	4		;	image address	: 4 bytes
 336:	0004'         	TSIZELEN	EQU	4		;	image size	: 4 bytes
 337:	0014'         	TDESCLEN	EQU	20		;	description	: 20 bytes
 338:			; -- IDE --
 339:	00E0'         	IDEPORTA	EQU	0E0H		; lower 8 bits of IDE interface
 340:	00E1'         	IDEPORTB	EQU	0E1H		; upper 8 bits of IDE interface
 341:	00E2'         	IDEPORTC	EQU	0E2H		; control lines for IDE interface
 342:	00E3'         	IDEPORTCTRL	EQU	0E3H		; 8255 configuration port
 343:			
 344:	0092'         	READCFG8255	EQU	10010010b	; Set 8255 IDEportC to output, IDEportA/B input
 345:	0080'         	WRITECFG8255	EQU	10000000b	; Set all three 8255 ports to output mode
 346:			;IDE control lines for use with IDEportC.
 347:	0001'         	IDEA0LINE	EQU	01H		; direct from 8255 to IDE interface
 348:	0002'         	IDEA1LINE	EQU	02H		; direct from 8255 to IDE interface
 349:	0004'         	IDEA2LINE	EQU	04H		; direct from 8255 to IDE interface
 350:	0008'         	IDECS0LINE	EQU	08H		; inverter between 8255 and IDE interface
 351:	0010'         	IDECS1LINE	EQU	10H		; inverter between 8255 and IDE interface
 352:	0020'         	IDEWRLINE	EQU	20H		; inverter between 8255 and IDE interface
 353:	0040'         	IDERDLINE	EQU	40H		; inverter between 8255 and IDE interface
 354:	0080'         	IDERSTLINE	EQU	80H		; inverter between 8255 and IDE interface
 355:			;Symbolic constants for the IDE Drive registers
 356:	0008'         	REGDATA		EQU	IDECS0LINE
 357:	0009'         	REGERR		EQU	IDECS0LINE + IDEA0LINE
 358:	000A'         	REGSECCNT	EQU	IDECS0LINE + IDEA1LINE
 359:	000B'         	REGSECTOR	EQU	IDECS0LINE + IDEA1LINE + IDEA0LINE
 360:	000C'         	REGCYLLSB	EQU	IDECS0LINE + IDEA2LINE
 361:	000D'         	REGCYLMSB	EQU	IDECS0LINE + IDEA2LINE + IDEA0LINE
 362:	000E'         	REGSHD		EQU	IDECS0LINE + IDEA2LINE + IDEA1LINE		;(0EH)
 363:	000F'         	REGCOMMAND	EQU	IDECS0LINE + IDEA2LINE + IDEA1LINE + IDEA0LINE	;(0FH)
 364:	000F'         	REGSTATUS	EQU	IDECS0LINE + IDEA2LINE + IDEA1LINE + IDEA0LINE
 365:	0016'         	REGCONTROL	EQU	IDECS1LINE + IDEA2LINE + IDEA1LINE
 366:	0016'         	REGASTATUS	EQU	IDECS1LINE + IDEA2LINE + IDEA1LINE
 367:			;IDE Command Constants.
 368:	0010'         	CMDRECAL	EQU	010H
 369:	0020'         	CMDREAD		EQU	020H
 370:	0030'         	CMDWRITE	EQU	030H
 371:	0091'         	CMDINIT		EQU	091H
 372:	00EC'         	CMDID		EQU	0ECH
 373:	00E0'         	CMDSPINDOWN	EQU	0E0H
 374:	00E1'         	CMDSPINUP	EQU	0E1H
 375:			; -- 16C550 UARTS --
 376:	00C0'         	UART0BASE	EQU	0C0H		; Port base address for 0
 377:	00C8'         	UART1BASE	EQU	0C8H		; Port base address for 1
 378:	00C0'         	UART0		EQU	UART0BASE	; Select UART 0
 379:	00C8'         	UART1		EQU	UART1BASE	; Select UART 1
 380:	0000'         	R0RXTX		EQU	0		; (r/w) RXD/TXD Transmit/Receive Buffer
 381:	0000'         	R0BRDL		EQU	0		; (r/w) DLL  if bit 7 of LCR is set: Baud Rate Divisor LSB
 382:	0001'         	R1IER		EQU	1		; (r/w) IER - Interrupt Enable Register
 383:	0001'         	R1BRDM		EQU	1		; (r/w) DLM if bit 7 of LCR is set: Baud Rate Divisor MSB
 384:	0002'         	R2IIR		EQU	2		; (r)   IIR - Interrupt Identification Register
 385:	0002'         	R2FCR		EQU	2		; (w)   FCR - FIFO Control Register
 386:	0003'         	R3LCR		EQU	3		; (r/w) LCR - Line Control Register
 387:	0004'         	R4MCR		EQU	4		; (r/w) MCR - Modem Control Register
 388:	0005'         	R5LSR		EQU	5		; (r)   LSR - Line Status Register
 389:	0006'         	R6MSR		EQU	6		; (r)   MSR - Modem Status Register
 390:	0007'         	R7SPR		EQU	7		; (r/w) SPR - Scratch Pad Register
 391:				; speeds:
 392:	0060'         	UART1200	EQU	96		; = 1,843,200 / ( 16 x 1200 )
 393:	0030'         	UART2400	EQU	48		; = 1,843,200 / ( 16 x 2400 )
 394:	0018'         	UART4800	EQU	24		; = 1,843,200 / ( 16 x 4800 )
 395:	000C'         	UART9600	EQU	12		; = 1,843,200 / ( 16 x 9600 )
 396:	0006'         	UART19K2	EQU	06		; = 1,843,200 / ( 16 x 19,200 )
 397:	0003'         	UART38K4	EQU	03		; = 1,843,200 / ( 16 x 38,400 )
 398:	0002'         	UART57K6	EQU	02		; = 1,843,200 / ( 16 x 57,600 )
 399:	0001'         	UART115K2	EQU	01		; = 1,843,200 / ( 16 x 115,200 )
 400:			
 401:	0006'         	U0DEFSPEED	EQU	UART19K2	; UART 0 default speed
 402:	000C'         	U1DEFSPEED	EQU	UART9600	; UART 1 default speed
 403:			; -- Z80CTC --
 404:	00E8'         	CTCBASE		EQU	0E8H
 405:	00E8'         	CTCCHAN0	EQU	CTCBASE+0	; Channel 1 - Free
 406:	00E9'         	CTCCHAN1	EQU	CTCBASE+1	; Channel 2 - System Timer
 407:	00EA'         	CTCCHAN2	EQU	CTCBASE+2	; Channel 3 - UART 1 Interrupt
 408:	00EB'         	CTCCHAN3	EQU	CTCBASE+3	; Channel 4 - UART 0 Interrupt
 409:	0020'         	CTC0TCHI	EQU	32		; hi speed chan. 0 tc: 4Mhz / 256 / 32 = 488.28 Hz
 410:	0005'         	CTC1TC100HZ	EQU	5		; lo speed chan. 1 tc: 488.28 Hz / 5 = ~ 97.6 Hz
 411:	000A'         	CTC1TC50HZ	EQU	10		; lo speed chan. 1 tc: 488.28 Hz / 10 = ~ 48.8 Hz
 412:	0013'         	CTC1TC25HZ	EQU	19		; lo speed chan. 1 tc: 488.28 Hz / 19 = ~ 25 Hz
 413:	0030'         	CTC1TC10HZ	EQU	48		; lo speed chan. 1 tc: 488.28 Hz / 48 = ~ 10 Hz
 414:	00F4'         	CTC1TC2HZ	EQU	244		; lo speed chan. 1 tc: 488.28 Hz / 244 = ~ 2 Hz
 415:	0013'         	SYSHERTZ	EQU	CTC1TC25HZ	; System timer hertz
 416:			; -- EEPROM --
 417:	0001'         	EEP29EE		EQU	01H		; type 29EE020
 418:	0002'         	EEP29XE		EQU	02H		; type 29LE020 or 29VE020
 419:	0004'         	EEP29C		EQU	04H		; type 29C020
 420:	0008'         	EEPUNSUPP	EQU	08H		; unsupported
 421:	0010'         	EEPROGLOCK	EQU	10H		; programming locked
 422:				;
 423:	0080'         	EERINEPROM	EQU	80H		; tried to program eeprom running inside it
 424:			
 425:			;
 426:			; MMU organization
 427:			;
 428:			; MMU manage 16 4kb pages in Z80 address space (logical)
 429:			; It can assign any of 256 4k pages (physical) from its
 430:			; 1Mb address space.
 431:			;
 432:			; To load phisycal page XXh to logical page (in CPU address space) Y,
 433:			; you should consider that MMU is at a fixed address 20h and that
 434:			; logical 4K page Y is derived in the MMU by the usage of A12,A13,A14
 435:			; and A15 address lines during an I/O instruction.
 436:			;
 437:			; So to address phys. ram page 00h at the top of logical space page Fh
 438:			; you need to have Fh * on top address lines * because this address
 439:			; is the index to MMU page.
 440:			;
 441:			; So:
 442:			;
 443:			; 	LD	A,00h		<--- phis. page number	00xxxh (4k page)
 444:			; 	LD	B,F0h		<--- log. page number 	 Fxxxh (cpu page)
 445:			; 	LD	C,20h		<--- MMU I/O address
 446:			; 	OUT	(C),A
 447:			; 	RET
 448:			;
 449:			; The OUT instruction place:
 450:			; A on data lines D0-D7
 451:			; Fh (from B register) on A12-A15
 452:			; on port 20h (C register)
 453:			;
 454:			;
 455:			; Memory is organized as follow:
 456:			;
 457:			;	Slot 1	-> RAM	  -> 512k from 00000h to 7ffffh (mandatory)
 458:			;	Slot 2	-> RAM	  -> 128k from 80000h to 9ffffh (option 1)
 459:			;	Slot 2	-> RAM    -> 256k from 80000h to bffffh (option 2)
 460:			;	Slot 3	-> EEPROM -> 256k from c0000h to fffffh (mandatory)
 461:			;
 462:			
 463:			
 464:			;-------------------------------------
 465:			; Production / Testing
 466:			
 467:	FFFF'         	BBDEBUG	EQU	TRUE
 468:			
 469:			
 470:			;-------------------------------------
 471:			; Segments, pages locations
 472:			
 473:	FFFF'         	IF	BBDEBUG
 474:			
 475:	0004'         	BBIMGP	EQU	04H		; Image location (DEBUG)
 476:	000E'         	BBAPPP	EQU	0EH
 477:	000F'         	BBPAG	EQU	0FH		; Base page location
 478:			
 479:			ELSE
 485:			ENDIF
 486:			
 487:	000D'         	TRNPAG	EQU	0DH		; Page used for transient MMU ops
 488:	F000'         	BBBASE	EQU	BBPAG << 12	; non resident base address
 489:	FC00'         	BBCOMN	EQU	BBBASE + 0C00H	; resident portion address
 490:			
 491:	F000'         	SYSBASE EQU	BBBASE		; use this to have 60K TPA
 492:			; SYSBASE EQU	BBCOMN		; use this to have 63K TPA
 493:			
 494:			;-------------------------------------
**** hldrbios.asm ****
  22:			
  23:			
  24:			;---------------------------------------- DBUG
  25:			
  26:	0000'         	LDRDBG	EQU	false
  27:			
  28:			FTRACE	macro	p1
  29:				if ldrdbg
  30:				ld	(OLDSTACK),SP
  31:				ld	sp,NEWSTACK
  32:				push	af
  33:				push	bc
  34:				push	de
  35:				push	hl
  36:				call	inline
  37:				defb	p1,cr,lf,'$'
  38:				call	bbconin
  39:				pop	hl
  40:				pop	de
  41:				pop	bc
  42:				pop	af
  43:				ld	sp,(OLDSTACK)
  44:				endif
  45:				endm
  46:			
  47:			HEX16	macro	p1,p2
  48:				if ldrdbg
  49:				ld	(OLDSTACK),SP
  50:				ld	sp,NEWSTACK
  51:				push	af
  52:				push	bc
  53:				push	de
  54:				push	hl
  55:				ld	a,p1
  56:				call	phex
  57:				ld	a,p2
  58:				call	phex
  59:				ld	c,CR
  60:				call	BBCONOUT
  61:				ld	c,LF
  62:				call	BBCONOUT
  63:				pop	hl
  64:				pop	de
  65:				pop	bc
  66:				pop	af
  67:				ld	sp,(OLDSTACK)
  68:				endif
  69:				endm
  70:			
  71:			HEX8	macro	p1
  72:				if ldrdbg
  73:				ld	(OLDSTACK),SP
  74:				ld	sp,NEWSTACK
  75:				push	af
  76:				push	bc
  77:				push	de
  78:				push	hl
  79:				ld	a,p1
  80:				call	phex
  81:				ld	c,CR
  82:				call	BBCONOUT
  83:				ld	c,LF
  84:				call	BBCONOUT
  85:				pop	hl
  86:				pop	de
  87:				pop	bc
  88:				pop	af
  89:				ld	sp,(OLDSTACK)
  90:				endif
  91:				endm
  92:			
  93:			;---------------------------------------- DBUG
  94:			
  95:			
  96:			dph 	macro 	?trans,?dpb,?csize,?asize
  97:				local ?csv,?alv
  98:				dw	?trans			; translate table address
  99:				db	0,0,0,0,0,0,0,0,0	; BDOS Scratch area
 100:				db	0			; media flag
 101:				dw	?dpb			; disk parameter block
 102:				dw	csv			; checksum vector
 103:				dw	alv			; allocation vector
 104:				dw	dirbcb			; directory buffer control block
 105:				dw	databcb			; data buffer control block
 106:				dw	0ffffh			; no hashing
 107:				db	0			; hash bank
 108:				endm
 109:			
 110:				; Standard entry points
 111:			
 112:	0000' C3A001  		JP	BOOT
 113:	0003' C33C01  		JP	WBOOT
 114:	0006' C33C01  		JP	CONST
 115:	0009' C33E01  		JP	CONIN
 116:	000C' C34101  		JP	CONOUT
 117:	000F' C33C01  		JP	BLIST
 118:	0012' C33C01  		JP	AUXOUT
 119:	0015' C33E01  		JP	AUXIN
 120:	0018' C36201  		JP	HOME
 121:	001B' C34C01  		JP	SELDSK
 122:	001E' C36501  		JP	SETTRK
 123:	0021' C36D01  		JP	SETSEC
 124:	0024' C38901  		JP	SETDMA
 125:	0027' C3D901  		JP	READ
 126:	002A' C33C01  		JP	WRITE
 127:	002D' C33C01  		JP	LISTST
 128:	0030' C39101  		JP	SECTRN
 129:	0033' C34401  		JP	CONOST
 130:	0036' C33C01  		JP	AUXIST
 131:	0039' C33C01  		JP	AUXOST
 132:	003C' C33C01  		JP	DEVTBL
 133:	003F' C33C01  		JP	?CINIT
 134:	0042' C39C01  		JP	GETDRV
 135:	0045' C33C01  		JP	MULTIO
 136:	0048' C33C01  		JP	FLUSH
 137:	004B' C34701  		JP	?MOVE
 138:	004E' C33C01  		JP	?TIME
 139:	0051' C33C01  		JP	BNKSEL
 140:	0054' C33C01  		JP	SETBNK
 141:	0057' C33C01  		JP	?XMOVE
 142:	005A' C30000  		JP	0
 143:	005D' C30000  		JP	0
 144:	0060' C30000  		JP	0
 145:			
 146:			
 147:			; 	; extended disk parameter header for drive 0:
 148:	0063' 2B02    		DEFW	FDDWR			; floppy disk write routine
 149:	0065' 0002    		DEFW	FDDRD			; floppy disk read routine
 150:	0067' DD01    		DEFW	VOID			; floppy disk login procedure
 151:	0069' DD01    		DEFW	VOID			; floppy disk drive initialization routine (void)
 152:	006B' 00      		DEFB	0			; relative drive 0 on this controller
 153:	006C' 00      		DEFB	0			; media type
 154:			
 155:	006D'         	DPH0:	DPH	TRANS,FDPB,0,0
 155:	006D' 1101    		dw	TRANS			; translate table address
 155:	006F' 00000000		db	0,0,0,0,0,0,0,0,0	; bdos scratch area
	      00000000
	      00
 155:	0078' 00      		db	0			; media flag
 155:	0079' EF00    		dw	FDPB			; disk parameter block
 155:	007B' AC0A    		dw	csv			; checksum vector
 155:	007D' C406    		dw	alv			; allocation vector
 155:	007F' AC02    		dw	dirbcb			; directory buffer control block
 155:	0081' B802    		dw	databcb			; data buffer control block
 155:	0083' FFFF    		dw	0ffffh			; no hashing
 155:	0085' 00      		db	0			; hash bank
 155:	0086'         		endm
 155:			
 156:			
 157:				; extended disk parameter header for drive 2:
 158:	0086' FF01    		DEFW	IDEWRDSK		; hard disk write routine
 159:	0088' F401    		DEFW	IDERDDSK		; hard disk read routine
 160:	008A' DD01    		DEFW	VOID			; hard disk login procedure
 161:	008C' DD01    		DEFW	VOID			; hard disk drive initialization routine (void)
 162:	008E' 00      		DEFB	0			; relative drive 0 on this controller
 163:	008F' 00      		DEFB	0			; media type
 164:			
 165:	0090'         	DPH2:	DPH	0,HD8M,0,0
 165:	0090' 0000    		dw	0			; translate table address
 165:	0092' 00000000		db	0,0,0,0,0,0,0,0,0	; bdos scratch area
	      00000000
	      00
 165:	009B' 00      		db	0			; media flag
 165:	009C' 0001    		dw	HD8M			; disk parameter block
 165:	009E' AC0A    		dw	csv			; checksum vector
 165:	00A0' C406    		dw	alv			; allocation vector
 165:	00A2' AC02    		dw	dirbcb			; directory buffer control block
 165:	00A4' B802    		dw	databcb			; data buffer control block
 165:	00A6' FFFF    		dw	0ffffh			; no hashing
 165:	00A8' 00      		db	0			; hash bank
 165:	00A9'         		endm
 165:			
 166:			
 167:			; 	; extended disk parameter header for drive 14:
 168:	00A9' 2B02    		DEFW	FDDWR			; virt floppy disk write routine
 169:	00AB' 0002    		DEFW	FDDRD			; virt floppy disk read routine
 170:	00AD' DD01    		DEFW	VOID			; virt floppy disk login procedure
 171:	00AF' DD01    		DEFW	VOID			; virt floppy disk drive initialization routine (void)
 172:	00B1' 00      		DEFB	0			; relative drive 0 on this controller
 173:	00B2' 00      		DEFB	0			; media type
 174:			
 175:	00B3'         	DPH14:	DPH	TRANS,FDPB,0,0
 175:	00B3' 1101    		dw	TRANS			; translate table address
 175:	00B5' 00000000		db	0,0,0,0,0,0,0,0,0	; bdos scratch area
	      00000000
	      00
 175:	00BE' 00      		db	0			; media flag
 175:	00BF' EF00    		dw	FDPB			; disk parameter block
 175:	00C1' AC0A    		dw	csv			; checksum vector
 175:	00C3' C406    		dw	alv			; allocation vector
 175:	00C5' AC02    		dw	dirbcb			; directory buffer control block
 175:	00C7' B802    		dw	databcb			; data buffer control block
 175:	00C9' FFFF    		dw	0ffffh			; no hashing
 175:	00CB' 00      		db	0			; hash bank
 175:	00CC'         		endm
 175:			
 176:			
 177:			; extended disk parameter header for drive 15:
 178:	00CC' F301    		DEFW	HWRVDSK			; virt hard disk write routine
 179:	00CE' DE01    		DEFW	HRDVDSK			; virt hard disk read routine
 180:	00D0' DD01    		DEFW	VOID			; virt hard disk login procedure
 181:	00D2' DD01    		DEFW	VOID			; virt hard disk drive initialization routine (void)
 182:	00D4' 00      		DEFB	0			; relative drive 0 on this controller
 183:	00D5' 00      		DEFB	0			; media type
 184:			
 185:	00D6'         	DPH15:	DPH	0,HD8M,0,0
 185:	00D6' 0000    		dw	0			; translate table address
 185:	00D8' 00000000		db	0,0,0,0,0,0,0,0,0	; bdos scratch area
	      00000000
	      00
 185:	00E1' 00      		db	0			; media flag
 185:	00E2' 0001    		dw	HD8M			; disk parameter block
 185:	00E4' AC0A    		dw	csv			; checksum vector
 185:	00E6' C406    		dw	alv			; allocation vector
 185:	00E8' AC02    		dw	dirbcb			; directory buffer control block
 185:	00EA' B802    		dw	databcb			; data buffer control block
 185:	00EC' FFFF    		dw	0ffffh			; no hashing
 185:	00EE' 00      		db	0			; hash bank
 185:	00EF'         		endm
 185:			
 186:			
 187:				; Floppy drive 0
 188:			
 189:	00EF'         	FDPB:
 190:	00EF' 2C00    		DEFW	44			; SPT
 191:	00F1' 040F    		DEFB	4,15			; BSH, BLM  --> 2048 BYTES BLOCK
 192:	00F3' 00      		DEFB	0			; EXM
 193:	00F4' B101    		DEFW	433			; DSM
 194:	00F6' FF00    		DEFW	255			; DRM
 195:	00F8' F0      		DEFB	11110000B		; alloc 0
 196:	00F9' 00      		DEFB	00000000B		; alloc 1
 197:				;
 198:	00FA' 4000    		DEFW	64			; CKS
 199:				;
 200:	00FC' 0200    		DEFW	2			; OFF
 201:	00FE' 0203    		DEFB	2,3			; PSH, PHM  --> 512 BYTES PHYSICAL SECTOR
 202:			
 203:				; IDE partition 1 is 512x256x64 LBA or 8.388.608 bytes
 204:				; DPB	512,256,64,2048,1024,1,8000H
 205:			
 206:	0100'         	HD8M:
 207:	0100' 0004    		DEFW	1024			; SPT
 208:	0102' 040F    		DEFB	4,15			; BSH, BLM  --> 2048 BYTES BLOCK
 209:	0104' 00      		DEFB	0			; EXM
 210:	0105' BF0F    		DEFW	4031			; DSM
 211:	0107' FF03    		DEFW	1023			; DRM
 212:	0109' FFFF    		DEFB	0FFH,0FFH		; AL0, AL1
 213:				;
 214:	010B' 0080    		DEFW	8000H			; CKS
 215:				;
 216:	010D' 0100    		DEFW	1			; OFF
 217:	010F' 0203    		DEFB	2,3			; PSH, PHM  --> 512 BYTES PHYSICAL SECTOR
 218:			
 219:				; sector translation table for 512 bytes/11 sec. track (skew = 4)
 220:	0111' 01050902	TRANS:	DEFB	1,5,9,2 		; sectors 1,2,3,4
 221:	0115' 060A0307		DEFB	6,10,3,7	 	; sectors 5,6,7,8
 222:	0119' 0B0408  		DEFB	11,4,8			; sectors 9,10,11
 223:			
 224:	011C' 6D00    	@DTBL:	DEFW	DPH0	; A:
 225:	011E' 6D00    		DEFW	DPH0	; B:
 226:	0120' 9000    		DEFW	DPH2	; C:
 227:	0122' 9000    		DEFW	DPH2	; D:
 228:	0124' 9000    		DEFW	DPH2	; E:
 229:	0126' 9000    		DEFW	DPH2	; F:
 230:	0128' 9000    		DEFW	DPH2	; G:
 231:	012A' 9000    		DEFW	DPH2	; H:
 232:	012C' 9000    		DEFW	DPH2	; I:
 233:	012E' 9000    		DEFW	DPH2	; J:
 234:	0130' 9000    		DEFW	DPH2	; K:
 235:	0132' 9000    		DEFW	DPH2	; L:
 236:	0134' 9000    		DEFW	DPH2	; M:
 237:	0136' 9000    		DEFW	DPH2	; N:
 238:	0138' B300    		DEFW	DPH14	; O:
 239:	013A' D600    		DEFW	DPH15	; P:
 240:			
 241:			
 242:	013C'         	CONST:
 243:	013C'         	LISTST:
 244:	013C'         	AUXIST:
 245:	013C'         	AUXOST:
 246:	013C'         	FLUSH:
 247:	013C'         	BLIST:
 248:	013C'         	AUXOUT:
 249:	013C'         	DEVTBL:
 250:	013C'         	?CINIT:
 251:	013C'         	MULTIO:
 252:	013C'         	?TIME:
 253:	013C'         	BNKSEL:
 254:	013C'         	SETBNK:
 255:	013C'         	?XMOVE:
 256:	013C'         	DCBINIT:
 257:	013C'         	WRITE:
 258:	013C'         	WBOOT:
 259:	013C' AF      		XOR	A			; routine has no function in loader bios:
 260:	013D' C9      		RET				; return a false status
 261:			
 262:			
 263:	013E'         	CONIN:
 264:	013E'         	AUXIN:
 265:	013E' 3E1A    		LD	A,'Z'-40H		; routine has no function in loader bios:
 266:	0140' C9      		RET
 267:			
 268:	0141'         	CONOUT:					; routine outputs a character in [c] to the console:
 269:	0141' C39FFD  		JP	BBCONOUT
 270:			
 271:	0144'         	CONOST:					; return console output status:
 272:	0144' C3AAFD  		JP	BBCONST
 273:			
 274:	0147'         	?MOVE:
 275:	0147'         		hex16	d,e
 275:	0000'         		if ldrdbg
 275:				endif
 275:	0147'         		endm
 275:			
 276:	0147'         		hex16	h,l
 276:	0000'         		if ldrdbg
 276:				endif
 276:	0147'         		endm
 276:			
 277:	0147'         		hex16	b,c
 277:	0000'         		if ldrdbg
 277:				endif
 277:	0147'         		endm
 277:			
 278:	0147'         		FTRACE "?MOVE"
 278:	0000'         		if ldrdbg
 278:				endif
 278:	0147'         		endm
 278:			
 279:	0147' EB      		EX	DE,HL
 280:	0148' EDB0    		LDIR
 281:	014A' EB      		EX	DE,HL
 282:	014B' C9      		RET
 283:			
 284:	014C'         	SELDSK:	FTRACE "SELDSK"
 284:	0000'         		if ldrdbg
 284:				endif
 284:	014C'         		endm
 284:			
 285:	014C' 3A0400  		LD	A,(CDISK)
 286:	014F' 4F      		LD	C,A
 287:	0150' 0600    		LD	B,0
 288:	0152'         		hex8	c
 288:	0000'         		if ldrdbg
 288:				endif
 288:	0152'         		endm
 288:			
 289:	0152' CDBDFC  		CALL	BBDSKSEL
 290:	0155' 6F      		LD	L,A
 291:	0156' 2600    		LD	H,0
 292:	0158' 29      		ADD	HL,HL			; create index from drive code
 293:	0159' 011C01  		LD	BC,@DTBL
 294:	015C' 09      		ADD	HL,BC			; get pointer to dispatch table
 295:	015D' 7E      		LD	A,(HL)
 296:	015E' 23      		INC	HL
 297:	015F' 66      		LD	H,(HL)
 298:	0160' 6F      		LD	L,A			; point at disk descriptor
 299:	0161' C9      		RET
 300:			
 301:	0162'         	HOME:	FTRACE "HOME"
 301:	0000'         		if ldrdbg
 301:				endif
 301:	0162'         		endm
 301:			
 302:	0162' 010000  		LD	BC,0			; home selected drive -- treat as settrk(0):
 303:			
 304:	0165'         	SETTRK:
 305:	0165'         		FTRACE "SETTRK"
 305:	0000'         		if ldrdbg
 305:				endif
 305:	0165'         		endm
 305:			
 306:	0165' ED439B02		LD	(@TRK),BC
 307:	0169'         		hex16	b,c
 307:	0000'         		if ldrdbg
 307:				endif
 307:	0169'         		endm
 307:			
 308:	0169' CDABFC  		CALL	BBTRKSET
 309:	016C' C9      		RET
 310:			
 311:	016D'         	SETSEC:
 312:	016D'         		FTRACE "SETSEC"
 312:	0000'         		if ldrdbg
 312:				endif
 312:	016D'         		endm
 312:			
 313:	016D' 3A4500  		LD	A,(FDRVBUF)		; select...
 314:	0170' FE02    		CP	2			; is floppy ?
 315:	0172' FA8101  		JP	M,SECIN			; yes
 316:	0175' FE0E    		CP	14			; is IDE ?
 317:	0177' FA8101  		JP	M,SECIN			; yes
 318:	017A' FE0F    		CP	15			; virtual hd ?
 319:	017C' 2802    		JR	Z,SECADJ		; yes (P:)
 320:	017E' 1801    		JR	SECIN			; no, virtual floppy (O:)
 321:			
 322:	0180' 03      	SECADJ:	INC	BC			; virtual drive
 323:	0181' ED439F02	SECIN:	LD	(@SECT),BC
 324:	0185' CDB1FC  		CALL	BBSECSET
 325:	0188'         		hex16	b,c
 325:	0000'         		if ldrdbg
 325:				endif
 325:	0188'         		endm
 325:			
 326:	0188' C9      		RET
 327:			
 328:	0189'         	SETDMA:
 329:	0189'         		FTRACE "SETDMA"
 329:	0000'         		if ldrdbg
 329:				endif
 329:	0189'         		endm
 329:			
 330:	0189' ED439D02		LD	(@DMA),BC
 331:	018D' CDB7FC  		CALL	BBDMASET
 332:	0190'         		hex16	b,c
 332:	0000'         		if ldrdbg
 332:				endif
 332:	0190'         		endm
 332:			
 333:	0190' C9      		RET
 334:			
 335:			
 336:	0191'         	SECTRN:	ftrace "SECTRN"
 336:	0000'         		if ldrdbg
 336:				endif
 336:	0191'         		endm
 336:			
 337:	0191'         		hex16	b,c
 337:	0000'         		if ldrdbg
 337:				endif
 337:	0191'         		endm
 337:			
 338:	0191' 69      		LD	L,C
 339:	0192' 60      		LD	H,B
 340:	0193' 7A      		LD	A,D
 341:	0194' B3      		OR	E
 342:	0195' C8      		RET	Z
 343:	0196' EB      		EX	DE,HL
 344:	0197' 09      		ADD	HL,BC
 345:	0198' 6E      		LD	L,(HL)
 346:	0199' 2600    		LD	H,0
 347:	019B' C9      		RET
 348:			
 349:	019C'         	GETDRV:
 350:	019C' 211C01  		LD	HL,@DTBL		; return address of disk drive table:
 351:	019F' C9      		RET
 352:			
 353:			;--------------------------------------------------------------------------
 354:			;                                  BOOT
 355:			;                   ROUTINE DOES COLD BOOT INITIALIZATION:
 356:			;--------------------------------------------------------------------------
 357:			
 358:			
 359:	01A0'         	BOOT:	FTRACE "BOOT"
 359:	0000'         		if ldrdbg
 359:				endif
 359:	01A0'         		endm
 359:			
 360:			
 361:			; 	JP	$A000
 362:	01A0' 3E33    		LD	A,'3'
 363:	01A2' 322C00  		LD	(COPSYS),A		; ostype for sysbios
 364:			
 365:	01A5' CDEDFC  		CALL	BBHDINIT		; IDE init
 366:	01A8' B7      		OR	A
 367:	01A9' 2004    		JR	NZ,IDEERR
 368:	01AB' CD11FD  		CALL	BBLDPART
 369:	01AE' C9      		RET				; ret Z if no problem
 370:			
 371:			
 372:	01AF' 215A02  	IDEERR:	LD	HL,MFAIL		; initialization of IDE Drive failed
 373:	01B2' CD4E02  		CALL	PSTRING
 374:	01B5' CD94FD  		CALL	BBCONIN
 375:	01B8' C300FC  		JP	$FC00			; re-init system monitor
 376:			
 377:			;------------------------------------------------------------------------------
 378:			;	   read a sector at @trk, @sec to address at @dma, from cdisk
 379:			;------------------------------------------------------------------------------
 380:			
 381:	01BB'         	DREAD:	FTRACE "READ"
 381:	0000'         		if ldrdbg
 381:				endif
 381:	01BB'         		endm
 381:			
 382:	01BB' 2A4500  		LD	HL,(FDRVBUF)
 383:	01BE' 2600    		LD	H,0
 384:	01C0'         		hex8	l
 384:	0000'         		if ldrdbg
 384:				endif
 384:	01C0'         		endm
 384:			
 385:	01C0' 29      		ADD	HL,HL			; get drive code and double it
 386:	01C1' 111C01  		LD	DE,@DTBL
 387:	01C4' 19      		ADD	HL,DE			; make address of table entry
 388:	01C5' 7E      		LD	A,(HL)
 389:	01C6' 23      		INC	HL
 390:	01C7' 66      		LD	H,(HL)
 391:	01C8' 6F      		LD	L,A 			; fetch table entry
 392:	01C9' E5      		PUSH	HL			; save address of table
 393:	01CA' 11F8FF  		LD	DE,-8
 394:	01CD' 19      		ADD	HL,DE			; point to read routine address
 395:	01CE' 7E      		LD	A,(HL)
 396:	01CF' 23      		INC	HL
 397:	01D0' 66      		LD	H,(HL)
 398:	01D1' 6F      		LD	L,A			; get address of routine
 399:	01D2' D1      		POP	DE			; recover address of table
 400:	01D3' 1B      		DEC	DE
 401:	01D4' 1B      		DEC	DE			; point to relative drive
 402:	01D5' 1A      		LD	A,(DE)
 403:	01D6' 13      		INC	DE
 404:	01D7' 13      		INC	DE			; point to DPH again
 405:	01D8'         		HEX16	H,L
 405:	0000'         		if ldrdbg
 405:				endif
 405:	01D8'         		endm
 405:			
 406:	01D8' E9      		JP	(HL)			; leap to driver
 407:			
 408:	01D9'         	READ:
 409:	01D9' CDBB01  		CALL	DREAD
 410:	0000'         		IF LDRDBG
 413:				ENDIF
 414:	01DC' AF      		XOR	A
 415:			; 	RET
 416:			
 417:	01DD'         	VOID:					; void routine
 418:	01DD' C9      		RET
 419:			
 420:				; wrapper for virtual hd read routine
 421:	01DE'         	HRDVDSK:
 422:	01DE' DDE5    		PUSH	IX
 423:	01E0' FDE5    		PUSH	IY
 424:	01E2' 2AA802  		LD	HL,(HDSECS)
 425:	01E5' ED5BAA02		LD	DE,(HDSECS+2)
 426:	01E9' CD17FD  		CALL	BBDPRMSET
 427:	01EC' CD75FC  		CALL	BBRDVDSK
 428:	01EF' FDE1    		POP	IY
 429:	01F1' DDE1    		POP	IX
 430:			
 431:				; wrapper for virtual hd write routine
 432:	01F3'         	HWRVDSK:
 433:	01F3' C9      		RET
 434:			
 435:				; wrapper for ide hd read routine
 436:	01F4'         	IDERDDSK:
 437:	01F4' FDE5    		PUSH	IY
 438:	01F6' CDFFFC  		CALL	BBHDRD
 439:	01F9' FDE1    		POP	IY
 440:	01FB' B7      		OR	A
 441:	01FC' C8      		RET	Z
 442:	01FD' 3E01    		LD	A,1			; correct return value for BDOS
 443:			; 	RET
 444:			
 445:				; wrapper for ide hd write routine
 446:	01FF'         	IDEWRDSK:
 447:	01FF' C9      		RET
 448:			
 449:				; floppy read routine
 450:	0200'         	FDDRD:
 451:	0200' DDE5    		PUSH	IX
 452:	0202' 2AA102  		LD	HL,(FLSECS)
 453:	0205' ED5BA302		LD	DE,(FLSECS+2)
 454:	0209' CD17FD  		CALL	BBDPRMSET
 455:	020C' 3A4500  		LD	A,(FDRVBUF)		; get active drive
 456:	020F' FE02    		CP	2			; is hw floppy ?
 457:	0211' 3802    		JR	C,RDFLO			; yes
 458:	0213' 180D    		JR	RDVRT			; no, then is a virtual drive
 459:				;
 460:	0215' CD3402  	RDFLO:	CALL	CHKSID			; side select
 461:	0218' CDD5FC  		CALL	BBFDRVSEL		; activate driver
 462:	021B' CD87FC  		CALL	BBFREAD			; do read
 463:	021E' DDE1    		POP	IX
 464:	0220' 180B    		JR	FLRET
 465:				;
 466:	0222' CD75FC  	RDVRT:	CALL	BBRDVDSK		; call par. read
 467:	0225' CB47    		BIT	0,A			; adjust Z flag for error test
 468:	0227' DDE1    		POP	IX
 469:	0229' 1802    		JR	FLRET
 470:			
 471:				; floppy write routine
 472:	022B'         	FDDWR:
 473:	022B' 1805    		JR	FLOK
 474:			
 475:				; adjust return value for floppies
 476:	022D' 2803    	FLRET:	JR	Z,FLOK
 477:	022F' AF      		XOR	A
 478:	0230' 3C      		INC	A
 479:	0231' C9      		RET
 480:	0232' AF      	FLOK:	XOR	A
 481:	0233' C9      		RET
 482:			
 483:				;	test for side switch on floppies
 484:				;
 485:	0234' DD21A102	CHKSID:	LD	IX,FLSECS		; CHS infos
 486:	0238' 0E00    		LD	C,0			; side 0 by default
 487:	023A' 3A4600  		LD	A,(FTRKBUF)		; get just the 8 bit part because we don't
 488:								; have drivers with more than 255 tracks !!!
 489:	023D' DDBE05  		CP	(IX+5)			; compare with physical (8 bit)
 490:	0240' DACFFC  		JP	C,BBSIDSET		; track in range (0-39/0-79) ?
 491:	0243' 0E01    		LD	C,1			; no: side one
 492:	0245' DD9605  		SUB	(IX+5)			; real cylinder on side 1
 493:	0248' 324600  		LD	(FTRKBUF),A		; store for i/o ops
 494:	024B' C3CFFC  		JP	BBSIDSET		; ... and go to SETSID
 495:			
 496:			; Print a string in [HL] up to '$'
 497:	024E'         	PSTRING:
 498:	024E' 7E      		LD	A,(HL)
 499:	024F' FE24    		CP	'$'
 500:	0251' C8      		RET	Z
 501:	0252' 4F      		LD	C,A
 502:	0253' CD9FFD  		CALL	BBCONOUT
 503:	0256' 23      		INC	HL
 504:	0257' C34E02  		JP	PSTRING
 505:			
 506:			;---------------------------------------- DBUG
 507:	0000'         		IF LDRDBG
 774:				ENDIF
 775:			;---------------------------------------- DBUG
 776:			;-----------------------------------------------------------------------
 777:			
 778:	025A'         	MFAIL:
 779:	025A' 0D0A496E		DEFB	CR,LF,"Initilization of IDE Drive Failed.",CR,LF
	      6974696C
	      697A6174
	      696F6E20
	      6F662049
	      44452044
	      72697665
	      20466169
	      6C65642E
	      0D0A
 780:	0280' 50726573		DEFB	"Press a key to continue.",CR,LF,'$'
	      73206120
	      6B657920
	      746F2063
	      6F6E7469
	      6E75652E
	      0D0A24
 781:			
 782:	029B'         	@TRK:	DEFS	2			; 2 bytes for next track to read or write
 783:	029D'         	@DMA:	DEFS	2			; 2 bytes for next dma address
 784:	029F'         	@SECT:	DEFS	2			; 2 bytes for sector
 785:	02A1' 0B00    	FLSECS:	DEFW	11
 786:	02A3' 0002    		DEFW	512
 787:	02A5' 02      		DEFB	2			; heads
 788:	02A6' 5000    		DEFW	80			; tracks
 789:	02A8' 0001    	HDSECS:	DEFW	256
 790:	02AA' 0002    		DEFW	512
 791:			
 792:			
 793:			
 794:			
 795:				; directory buffer control block:
 796:	02AC'         	DIRBCB:
 797:	02AC' FF      		DEFB	0FFH			; drive 0
 798:	02AD'         		DEFS	3
 799:	02B0'         		DEFS	1
 800:	02B1'         		DEFS	1
 801:	02B2'         		DEFS	2
 802:	02B4'         		DEFS	2
 803:	02B6' C402    		DEFW	DIRBUF			; pointer to directory buffer
 804:			
 805:				; data buffer control block:
 806:	02B8'         	DATABCB:
 807:	02B8' FF      		DEFB	0FFH			; drive 0
 808:	02B9'         		DEFS	3
 809:	02BC'         		DEFS	1
 810:	02BD'         		DEFS	1
 811:	02BE'         		DEFS	2
 812:	02C0'         		DEFS	2
 813:	02C2' C404    		DEFW	DATABUF			; pointer to data buffer
 814:			
 815:				; directory buffer
 816:	02C4'         	DIRBUF:	DEFS	512
 817:			
 818:				; DATA BUFFER:
 819:	04C4'         	DATABUF:DEFS	512
 820:			
 821:				; drive allocation vector:
 822:	06C4'         	ALV:	DEFS	1000			; space for double bit allocation vectors
 823:			
 824:	0AAC'         	CSV:					; no checksum vector required for a hdisk
 825:	0AAC'         		DEFS	(1023/4)+1
 826:			
 827:	0BAC'         		END



Statistics:

     5	passes
     0	jr promotions
   432	symbols
     0	bytes

    23	macro calls
   970	macro bytes
     0	invented symbols



Symbol Table:

?cinit           13c'    
?move            147'    
?time            13c'    
?xmove           13c'    
@dma             29d'    
@dtbl            11c'    
@sect            29f'    
@trk             29b'    
altprnprt      =   3     
alv              6c4'    
appbuf         =  2d     
auxin            13e'    
auxist           13c'    
auxost           13c'    
auxout           13c'    
banked         =ffffffff 
bbappp         =   e     
bbbase         =f000     
bbcalret       =fd5a     
bbcbank        =   c     
bbcomn         =fc00     
bbconin        =fd94     
bbconout       =fd9f     
bbconst        =fdaa     
bbcpboot       =fcc3     
bbcrtcini      =fc03     
bbcrtfill      =fc09     
bbcstck        =   d     
bbcurset       =fc21     
bbdebug        =ffffffff 
bbdiv16        =fcdb     
bbdmaset       =fcb7     
bbdprmset      =fd17     
bbdriveid      =fcf3     
bbdsksel       =fcbd     
bbeidck        =fd23     
bbepmngr       =fd1d     
bbexec         =fd29     
bbfdrvsel      =fcd5     
bbfhome        =fc81     
bbflopio       =fc93     
bbfread        =fc87     
bbfwrite       =fc8d     
bbhdboot       =fd0b     
bbhdgeo        =fd05     
bbhdinit       =fced     
bbhdrd         =fcff     
bbhdwr         =fcf9     
bbimgp         =   4     
bbinictc       =fc57     
bbldpart       =fd11     
bbmul16        =fce1     
bboffcal       =fce7     
bbpag          =   f     
bbprcvblk      =fc6f     
bbprnchr       =fc99     
bbpsndblk      =fc63     
bbrdtime       =fca5     
bbrdvdsk       =fc75     
bbresctc       =fc5d     
bbsecset       =fcb1     
bbsidset       =fccf     
bbstack        =fec0     
bbstbase       =fe9c     
bbsttim        =fc9f     
bbtrkset       =fcab     
bbu0ini        =fc39     
bbu1ini        =fc51     
bbu1rx         =fc45     
bbu1st         =fc4b     
bbu1tx         =fc3f     
bbuplchr       =fc69     
bbvcpmbt       =fcc9     
bbvoid         =fd6a     
bbwrvdsk       =fc7b     
bldoffs        =3000     
blifastblok    =  60     
blifastline    =  6a     
blislowblok    =  40     
blislowline    =  4a     
blist            13c'    
bnksel           13c'    
boot             1a0'    
btpasiz        =   6     
cdisk          =   4     
chksid           234'    
clkio          =   6     
clkrst         =   7     
clksclk        =   5     
cmdid          =  ec     
cmdinit        =  91     
cmdread        =  20     
cmdrecal       =  10     
cmdspindown    =  e0     
cmdspinup      =  e1     
cmdwrite       =  30     
cnfbyte        =  26     
colbuf         =  4f     
conin            13e'    
conost           144'    
conout           141'    
const            13c'    
copsys         =  2c     
cr             =   d     
crt6545adst    =  8c     
crt6545data    =  8d     
crtbase        =  80     
crtbeepport    =  8f     
crtblinkbit    =   0     
crthilitbit    =   3     
crtkeybcnt     =  87     
crtkeybdat     =  85     
crtmodebit     =   4     
crtprntcnt     =  83     
crtprntdat     =  81     
crtram0cnt     =  82     
crtram0dat     =  80     
crtram1cnt     =  86     
crtram1dat     =  84     
crtram2cnt     =  8a     
crtram2dat     =  88     
crtram3port    =  8e     
crtrevrsbit    =   1     
crtservcnt     =  8b     
crtservdat     =  89     
crtunderbit    =   2     
crtwidthbit    =   1     
csv              aac'    
ctc0tc         =  29     
ctc0tchi       =  20     
ctc1tc         =  28     
ctc1tc100hz    =   5     
ctc1tc10hz     =  30     
ctc1tc25hz     =  13     
ctc1tc2hz      =  f4     
ctc1tc50hz     =   a     
ctcbase        =  e8     
ctcchan0       =  e8     
ctcchan1       =  e9     
ctcchan2       =  ea     
ctcchan3       =  eb     
curpbuf        =  48     
cursoroff      =  20     
cursoron       =   a     
cursshp        =  4a     
databcb          2b8'    
databuf          4c4'    
dcbinit          13c'    
delay          =fd85     
devtbl           13c'    
dirbcb           2ac'    
dirbuf           2c4'    
dly1           =fd89     
dly2           =fd87     
dostx          =fe6f     
dph              280     
dph0              6d'    
dph14             b3'    
dph15             d6'    
dph2              90'    
dread            1bb'    
dselbf         =  4e     
eep29c         =   4     
eep29ee        =   1     
eep29xe        =   2     
eepage0        =  c0     
eeproglock     =  10     
eepsta         =f000     
eepunsupp      =   8     
eerineprom     =  80     
esc            =  1b     
false          =   0     
fdcbase        =  d0     
fdccmdstatr    =  d0     
fdcdatareg     =  d7     
fdcdrvrcnt     =  d6     
fdcreadc       =  88     
fdcreset       =  d0     
fdcrestc       =   7     
fdcsectreg     =  d2     
fdcseekc       =  17     
fdctrakreg     =  d1     
fdcwritc       =  a8     
fddrd            200'    
fddwr            22b'    
fdpb              ef'    
fdrvbuf        =  45     
ff             =   c     
fifblok        =   b     
fifoend        =  25     
fifokb         =  1a     
fifosto        =   f     
fifou0         =   f     
fifsize        =   8     
fin            =fdc4     
fixblock       =   0     
flok             232'    
flret            22d'    
flsecs           2a1'    
flush            13c'    
fout           =fde1     
frdpbuf        =  41     
fsecbuf        =  43     
fsekbuf        =  3f     
fstat          =fdb5     
ftrace             0     
ftrkbuf        =  46     
getdrv           19c'    
hd8m             100'    
hdsecs           2a8'    
hex16             c0     
hex8             1aa     
hmempag        =   b     
home             162'    
hrdvdsk          1de'    
hwrvdsk          1f3'    
idea0line      =   1     
idea1line      =   2     
idea2line      =   4     
idecs0line     =   8     
idecs1line     =  10     
ideerr           1af'    
ideporta       =  e0     
ideportb       =  e1     
ideportc       =  e2     
ideportctrl    =  e3     
iderddsk         1f4'    
iderdline      =  40     
iderstline     =  80     
idewrdsk         1ff'    
idewrline      =  20     
imtpag         =  ff     
imtsiz         = 400     
intrdi         =fe0f     
intren         =fdfe     
iobyte         =   3     
kbdbyte        =  4d     
keybstrbbit    =   7     
ldrdbg         =   0     
lf             =   a     
listst           13c'    
maxblk         =  14     
menaprt        =  21     
mfail            25a'    
miobyte        =  4c     
mmgetp         =fd78     
mmpmap         =fd6b     
mmtpapag       =  ef     
mmuport        =  20     
mmutstaddr     =d000     
mmutstpage     =   d     
monmaj         =  33     
monmin         =  34     
mscnt          =  f6     
multio           13c'    
mzmac          =   1     
pio2bit2       =   2     
pio2bit3       =   3     
pio2bit4       =   4     
ppakstb        =   1     
ppcntrp        =   2     
ppdatap        =   3     
ppdini         =   0     
ppdokg         =   2     
ppdrdy         =   4     
ppdstp         =   6     
ppstrob        =   0     
ppuack         =   7     
ppuini         =   1     
ppuokg         =   3     
ppurdy         =   5     
prntbusybit    =   0     
prvtop         =  4f     
pstring          24e'    
r0brdl         =   0     
r0rxtx         =   0     
r1brdm         =   1     
r1ier          =   1     
r2fcr          =   2     
r2iir          =   2     
r3lcr          =   3     
r4mcr          =   4     
r5lsr          =   5     
r6msr          =   6     
r7spr          =   7     
ram0buf        =  3b     
ram1buf        =  3c     
ram2buf        =  3d     
ram3buf        =  3e     
ramtbl         =e000     
rdflo            215'    
rdvrt            222'    
read             1d9'    
readcfg8255    =  92     
regastatus     =  16     
regcommand     =   f     
regcontrol     =  16     
regcyllsb      =   c     
regcylmsb      =   d     
regdata        =   8     
regerr         =   9     
regseccnt      =   a     
regsector      =   b     
regshd         =   e     
regstatus      =   f     
rldrom         =fe85     
rsrvbuf        =  2f     
rst7sp1        =  38     
rst7sp2        =  39     
rst7sp3        =  3a     
rtbsiz         = 3c0     
sconin         =fc2d     
sconout        =fc27     
sconst         =fc33     
secadj           180'    
secin            181'    
sectrn           191'    
seldsk           14c'    
setbnk           13c'    
setdma           189'    
setsec           16d'    
settrk           165'    
sintvec        =fff0     
srxrsm         =fe6d     
srxstp         =fe69     
sysbase        =f000     
syscmlo        =fec0     
syscom         =fc00     
syshertz       =  13     
sytimr         =fe19     
tblblk         =  30     
tdesclen       =  14     
tiaddrlen      =   4     
timrcon        =  27     
tmpbyte        =  4b     
tnamelen       =   8     
tpa            = 100     
tpagelen       =   2     
trans            111'    
trnpag         =   d     
true           =ffffffff 
tsizelen       =   4     
tx0            =fe77     
tx01           =fe79     
u0defspeed     =   6     
u0isr          =fe25     
u1defspeed     =   c     
u1isr          =fe5b     
u1nul          =fe65     
uart0          =  c0     
uart0base      =  c0     
uart0br        =  2b     
uart1          =  c8     
uart115k2      =   1     
uart1200       =  60     
uart19k2       =   6     
uart1base      =  c8     
uart1br        =  2a     
uart2400       =  30     
uart38k4       =   3     
uart4800       =  18     
uart57k6       =   2     
uart9600       =   c     
uastav         =fe90     
uastkb         =fe92     
uisre          =fe50     
uisri          =fe35     
vconin         =fc15     
vconout        =fc0f     
vconst         =fc1b     
vdbufsz        =   a     
vdrdsec        =   0     
vdwrsec        =   1     
void             1dd'    
voidisr        =fe22     
wboot            13c'    
write            13c'    
writecfg8255   =  80     
xofc           =  13     
xonc           =  11     
zpm3           =   0     
