





                                Z8E USER'S MANUAL













                                 Copyright 1984
                                       by
                                  RICK SURWILO
                                 23 PLMOUTH ROAD
                           STAMFORD,CONNECTICUT 06906
                                 (203) 324-3809














































                                TABLE OF CONTENTS

                Section                                        Page
           
          I.  INTRODUCTION                                       1

         II.  INSTALLATION                                       3
                             
        III.  INVOKING Z8E AT THE CP/M COMMAND LEVEL            13
             
         IV.  INITIALIZATION                                    19
              
          V.  COMMAND INPUT                                     23

         VI.  BREAKPOINTS                                       29

        VII.  COMMANDS:

               A     Assemble                                   32
               B     Set Breakpoint                             26
               C     Clear Breakpoint                           27
               D     Dump                                       28     
               E     Examine                                    29
               F     Find                                       31
               G     Go                                         33
               H     Display Symbol Table                       34
               I     Input File                                 35
               J     Animated Full Screen Debugging             37
               K     Set Memory Window Address for J command    49
               M     Move Memory                                50
               N     Output to I/O Port without Pre-read        51
               O     Output Current Breakpoints to Console      53
               P     Examine Flag Register                      54
               Q     Query I/O Ports                            55
               R     Register                                   57
               S     Single Step                                58
               U     Save Symbol Table to Disk                  60
               V     Verify Memory                              61
               W     Write Memory Segment to Disk               62
               X     Display Machine State                      63
               Y     Fill Memory                                64 
               Z     Disassemble                                65

              APPENDIX A - Symbol File Formats                  69
              APPENDIX B - ZILOG Mnemonics                      73 
              APPENDIX C - System Memory Map                    91














        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo








                           Z8E - Z80 DEBUGGING MONITOR
         

        I. INTRODUCTION
                    
        Z8E is a professional quality interactive debugging tool designed 

              - Full screen animated display of the program under 

              - Complete Z80 inline assembler,  with labels, sym-
                                
              - Interactive  disassembly with labels and  symbols 

              - Fully  traced program execution including a  full 

              - Up to 16 user settable breakpoints with  optional 

              - True  symbolic  debugging  using the  input  from 

              - Dynamic relocation of Z8E at load time to the top 


        You  may  want to spend some time familarizing yourself with  the 





                                        1





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo





                       This Page Intentionally Left Blank.





















































                                        2





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        II.  INSTALLATION

        First make a working copy of Z8E,  then place your original disk-

        Z8E's  (E)xamine  memory  command will be used to  change  memory 

        Z8E requires an addressable cursor which can be patched  symboli-

             First instruct Z8E to load itself as well as the symbol 

                        A>Z8E Z8E.COM Z8E.SYM

             The  symbol file Z8E.SYM contains the name and  address 

             Use the (E)xamine memory command to change the required 

             *E  MXYCP <cr>

             285E   2   ~   XX   <cr>   ;XX represents your input
             285F   1B  ~   XX   <cr>   
             2860   3D  =   XX   <cr>   
             2861   00  ~   .           ;PERIOD ENDS COMMAND
             *   


             IMPORTANT:
             Always  patch using the symbolic name of the  variable; 












                                        3





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


             Listed  below are the symbolic names of  the  addresses 

             MXYCP  - Cursor addressing lead-in string.   The  first                 The string may be up to 10 bytes  long.   This 

                      Default is the two character string:
                            
                            1B (Hex), 3D (Hex)

                      ASCII ESCAPE, followed by EQUAL SIGN.  
                         
             ROWB4? - Set this byte as follows:

                      NOT ZERO - Row is sent before Column
                      ZERO     - Column is sent before Row

                      Default is NOT ZERO, row sent before column.               


             ROW    - Set  this byte to contain the value which is to  be 

                      Default is 20 Hex, ASCII space. 


             COLUMN - Set  this byte to contain the value which is to  be 


             CASE   - This  byte  controls whether  you  prefer  entering 

                      FF - lower case  (DEFAULT)
                      00 - UPPER CASE  

             MAXLEN - This  is  the maximum length of permitted  for 

                                        4





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                      takes  up  twice as much space as one  with  8 

                      If,  while  reading in the symbols from  disk, 

                            6 - Maximum Symbol Length (DEFAULT)               
                           14 - Optional Symbol Length 

        TO SAVE THE PATCHED PROGRAM:

                           *W ANYNAME.COM  (Writes the File to Disk)

        This completes the installation of Z8E.  Typing in ^C (Control C) 







































                                        5





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                             USER CODED CONSOLE I/O

        The following section provides details on a method of  optionally 

        To  modify  them use the symbol names listed below  and  assemble 


             TTYQ:      This  routine checks the status of  the  console.                          TTYQ  returns  a  zero in A to indicate  that  no 
          
             TTYI:      Read a character, waiting until one arrives.
                        Return Character in A.
          
             TTYO:      Output a character, waiting until it is sent.
                        Character passed in A.


        Listed below is the code that Z8E uses to do console I/O;  use it 






























                                        6





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                                                                                
                TTYQ:   push    bc
                        push    de
                        push    hl
                        ld      c,11     ;;Check Console Status
                        call    BDOS     ;;BDOS returns:  A = 00  No Character 
                                         ;;               A = NZ  Input Waiting
                                         ;;
                        and     a        ;;Character Here?
                        ld      c,6      ;;
                        ld      e,0ffh   ;;     
                        call    nz,BDOS  ;;If Character Here Read It...
                                         ;;   Else Fall Thru
                        pop     hl
                        pop     de
                        pop     bc
                        and     7fh             
                        ret

                        org     TTYQ+32

                TTYI:   push    bc
                        push    de
                        push    hl
                TTYI00: ld      c,06     ;;Unadorned Console Input
                        ld      e,0ffh   ;;Tell CP/M this is Input Request
                        call    BDOS     ;;
                        and     7fh      ;;Strip Parity
                        jr      z,TTYI00 ;;Loop til Input Arrives
                        pop     hl
                        pop     de
                        pop     bc
                        ret

                        org     TTYI+32


                TTYO:   push    af
                        push    bc
                        push    de
                        push    hl
                        ld      c,02     ;;
                        ld      e,a      ;;
                        call    BDOS     ;;Console Output
                        pop     hl      
                        pop     de
                        pop     bc
                        pop     af
                        ret

                        org     TTYO+32






                                        7





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        The symbols TTYQ, TTYI, and TTYO are included in Z8E.SYM.  There-


                *A TTYQ
                1F76    C5      TTYQ:   PUSH    BC




        Z8E  also contains a provision for user installed  initialization   rest of Z8E. You need not save any registers.




































                                        8





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                  SUPPLYING YOUR OWN CURSOR ADDRESSING ROUTINE


        If  your computer requires a custom cursor addressing routine  it 

        1.   Examine  the Z8E.SYM file that to determine the address 

        2.   Using your own text editor code your routine and preface  it 

                            ASEG
                            .PHASE    XXXXH

                  Where  XXXX  represents the  absolute  hexadecimal 






































                                        9





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo




             Z8E will pass the row address in the B REGISTER and the 
             Your job is to translate these two number into a cursor 

             Save  all  registers including BC.  Use  the  following 

                                 ASEG
                                 .PHASE  XXXX        ;From  Z8E.SYM 

                       YOURS:    
                                 PUSH    BC
                                 PUSH    DE
                                 PUSH    HL

                                 CURSOR ADDRESSING CODE HERE

                                 POP     HL
                                 POP     DE
                                 POP     BC
                                 RET

                                 END    
                                          
             Use  Z8E's output routine TTYO as described  above  (or 

                                 2FE2   TTYO

             then code your call statements as:

                                 CALL   2FE2H

             Z8E imposes only one restriction on the code you write. 

                                 LD     HL,1234H

             Rather, code it like this:

                                 LD     H,12H
                                 LD     L,34H


                                       10





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


             This  is  the only restriction other than  the  maximum 

        3.   Assemble  your routine with either Macro-80 or  Z80ASM. 



















































                                       11





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        4.   Load Z8E.COM using Z8E:

                  A>Z8E Z8E.COM Z8E.SYM

                  *

        5.   Now overlay Z8E's cursor address code with your own:

                  *I YOURCODE.COM,XYCP

             Z8E will load your cursor addressing routine on top its 

        6.   Save the new file using a name of your choosing:

                  *W  NEWDEBUG.COM

        7.   Exit  back  to  the  operating  system  be  entering  a 





































                                       12





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo





                       This Page Intentionally Left Blank.





















































                                       13





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        III.  INVOKING Z8E AT THE CP/M COMMAND LEVEL

        Upon  invokation at the CP/M command level Z8E loads at  the  low 

        Once  loaded Z8E determines the size of the TPA by examining  the 

        Symbols which are loaded from files are stored by Z8E in a symbol 

                   A>Z8E (32)

        In  this example the user has requested space for 32 user defined 

        Subsequent action is based on the format of the remainder of  the 


             1.    A>Z8E
                        
                           Z8E resides as a standalone program in memory.



             2.    A>Z8E  USERFILE.COM

                           USERFILE.COM is loaded at the beginning of the 

                                       14





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                           TPA  and is ready to be acted on by  Z8E  com-



             3.    A>Z8E  USERFILE.COM USERFILE.SYM [,bias]

                           USERFILE.SYM is read in by Z8E and all  symbol 

                           USERFILE.COM is loaded at the start of the TPA 
                                 


             4.    A>Z8E  USERFILE.COM  USERFILE.PRN [,bias]
                             
                           As  in  the previous example  USERFILE.COM  is 

                           USERFILE.COM is loaded at the start of the TPA 






                                       15





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


             5.    A>Z8E USERFILE.COM USERFILE.SYM [,bias] NFILE.LST [,bias]
                                      
                           The true power of Z8E's symbol loading is best s (USERFILE 


                           USERFILE.COM  is loaded  at the start  of  the 


                           Note:
                           If no bias is specified,  Z8E will use a  bias 


        If  more than one .LST or .PRN file is being  loaded,  then  each 

        Z8E  as  presently configured can build a symbol table  from  the 

            1. Microsoft   MACRO-80    V3.37  .PRN Files  May 8, 1980
            2. Microsoft   MACRO-80    V3.44  .PRN Files  Dec 9, 1981
            3. Microsoft   LINK-80     V3.44  .SYM Files  Dec 9, 1981 
            4. SLR Systems Z80ASM      V1.07  .LST Files
            5. SLR Systems SLRNK       V1.07  .SYM Files  

        Z80ASM and SLRNK may be configured for 80 or 132 column output.

        Z8E  uses the file name extension (the three characters appearing 
                 

                                       16





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        During the loading process Z8E displays status and error messages 
                   
                    STATUS  MESSAGE                  DESCRIPTION

             1. Loading: USERFILE.COM          Z8E  is attempting to open 


             2.  Number of symbols loaded:     Following  the loading  of 


             3.   Loaded: 100  YYYY            Z8E displays the  starting           

                                               "Pages:"   refers  to  the                                         and  is the count  of  256 


                  ERROR  MESSAGE                        DESCRIPTION

             1.   File not found               The  file specified in the 

             2.   Symbol table not found       The   specified  file  was 

             3.   Invalid offset - using 0000  The  user has specified an 

                                       17





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                                               bols.  This error may have 

              4.   Syntax Error                The  file name was  incor-


        After  all user files,  both symbol files and the .COM file to be 

             Total Symbols:    XXXX
             Symbol Table:     XXXX - XXXX
             Z8E relocated:    XXXX - XXXX
             Top of memory:    XXXX            



        It  is important to note that Z8E expects the files appearing  in 

        The  first  file  named  in the command  line  is  always  loaded 

        For a discussion of the format of symbol files see APPENDIX A.


















                                       18





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo





                       This Page Intentionally Left Blank.





















































                                       19





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        IV. INITIALIZATION

        Once Z8E has been loaded, and has in turn loaded all files speci-

             The  user's program counter contains address  100  hex 

             The  user's  stack pointer is set to the starting  ad-
              

             The  user  I (interrupt) register is set to the  value 



        All  input and output by Z8E is accomplished using  buffers  con-

             Note:                                           
                   When  CP/M finishes loading  any  program, 

                   For  example,  many text editing  programs 

                                       20





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                   program to edit on the CP/M command  line, 

                         A>EDIT B:FYL2EDIT.BAS

                   Once the program EDIT.COM is loaded it may  5C 

                   Now,  if  the  user was to debug the  EDIT 








                                       21





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        DEBUGGING HINT:

        It  is  not necessary to initialize the default  FCB  and/or  the 

                  Once  you  have  loaded the program  to  test 

                  Use  the W command to write out memory start-

                             *W  NEWFILE.COM  0   XXXX

                  Where XXXX is the highest address you wish to 

                              *M  100  XXXX+100  0



























                                       22





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo





                       This Page Intentionally Left Blank.





















































                                       23





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        V.  COMMAND INPUT    

        Once  file  and  symbol table loading  has  been  completed,  Z8E 




             SYMBOL:        Any  symbol previously loaded  or  previously 
             
                                                                        
             HEX:           A  16  bit  hex number may be entered  as  an 

                                *E 1E21F4

                                      If  a 16 bit argument  is  expected 


                            If  no symbol table is present in memory then 

                                       24





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                            treats DEAD as the hexadecimal number  0DEAD. 


             REGISTER:      Valid Z80 16 bit register  names are  permit-
         
                                 *D HL 8

                                      instructs  Z8E  to dump  the  first 


                            Valid 16 bit register names:
                                      
                                      AF - Accumulator and Flag
                                      BC - BC register pair
                                      DE - DE register pair
                                      HL - HL register pair
                                      SP - Stack Pointer
                                      P  - Program Counter
                                      PC - Program Counter
                                      IX - IX index register 
                                      IY - IY index register

                            Note  that the program counter may be  speci-

                            If an expression used as an argument contains 


                                 HL+4      valid expression

                                 5+DE      invalid expression - register 
                                
                                HL+BC      invalid   expression  - more 

                                       25





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                                           specified

                                 P-3       invalid   expression   - "PC" 
                                           

                            To   differentiate  between  the  hexadecimal 
         
                            Note  also that the Z80 prime register  names 


             REGISTER       Z8E allows the user to specify the data  con-

                            The  most useful application of register  in-

                                             *B (SP)

                            This  informs Z8E to set a breakpoint at  the 



             DECIMAL:       Decimal numbers in the range 0 - 65535 may be 

                                       26





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                            otherwise Z8E will treat it as a hex  number.  

                                 *E 512#  
                              
                                      instructs  Z8E  to  examine  memory 


              LITERAL:      ASCII  literals up to 78 bytes in length  are 

                                            *Z 'ABCD'

                            Z8E would begin treat 'BC' as a 16 bit number 


          ARGUMENT-         The F (find),  E (examine memory),  N  (query          ARGUMENT-STRINGS  string which combines  SYM-

                               SYMBOL,'xyZ',4F,12E4,9,21#,511#,'ABc'

                            Assuming  that SYMBOL is equal to  177H  then 
                            
                            01 77 78 79 5A 4F 12 E4 09 15 01 FF 41 42 63     

                            Again,  ARGUMENT-STRINGS  are  terminated  by 

                                       27





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                            quoted literal string.

        Z8E permits expressions using the + and - operators.   Any  argu-

        Z8E  indicates argument errors by printing a question mark.

        Arguments may  be  line-edited using the  standard  CP/M  control 

                       backspace:  erase the last character typed
                       control X:  erase the entire line 
                       control C:  return to CP/M via warm boot

        All input is truncated to the size of Z8E's input buffer which is 

        All alphabetic input to Z8E may be in uppercase or lowercase. All 

        In  this  manual the appearance of square brackets [ ] around  an 































                                       28





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo






                       This Page Intentionally Left Blank.




















































                                       29





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo



        VI. BREAKPOINTS

        Breakpoints  are  those addresses in the program  under  test  at 

        Z8E also allows you to specify a pass count to be associated with 

        Furthermore,  Z8E  does not modify any code in the  user  program 

        When  a breakpoint is reached in the user program and Z8E regains ic name of this address if one 

        The  message:     *ERROR*BP*XXXX      is displayed on the console 

        Z8E  will  allow you to single step (trace) and  set  breakpoints 

                                       30





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        in memory.   When BDOS eventually restores the stack pointer  and 




















































                                       31





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo






                       This Page Intentionally Left Blank.




















































                                       32





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        A    Assemble
        _________________________________________________________________


        The  A command permits the user to effect inline assembly of  Z80 

                *A  ARG1  <cr>

                  where  ARG1  represents the starting address  at  which 

                  ARG1 may be of any type


        Z8E  initially  prompts  the  user  by  first  disassembling  and put.  Z8E 


        Z8E expects assembler input in the following format:


                     LABEL:  opcode  [operand1] [,operand2]


        The label field is always optional, the opcode field is mandatory 

        Z8E  does not automatically reserve space within itself for  user 

        The  assembler is a one pass assembler and forward references  to 

                                       33





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        symbols  which  do  not already appear in the  symbol  table  are 

        Labels  may begin in any column,  but all labels must be followed 

             41FF 0E 04       ENTRYP: LD C,4

        Z8E would replace 23DA with 41FF.

        Assembler statements which do not contain labels may begin in any 

        Operands  appearing in the operand field of the instruction to be ing four types (with the + and - operators)  are 

                       SYMBOL  (from symbol table)
                       HEX
                       LITERAL (two bytes maximum)
                       DECIMAL


        In  addition  the  dollar sign ($) may also appear in  both  the 


                                       34





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        The  operand field of a relative jump instruction can be  entered 


                  JR  NZ,$+11       ;jump to address PC+11 (hex)     
                  
                  DJNZ  $-24#       ;jump to address PC-24 (decimal)

        The user may alternatively specify a 16 bit value in the  operand 

                  JR    C,LABEL      Assuming LABEL exists, in the symbol  

                  JR      NZ,1080    Z8E  calculates the displacement be- 


           
        Z8E indicates  error-free input by first displaying the resultant 

        Assembly errors are always indicated by a double pair of question 

                        ERROR FLAG               MEANING

                            L         Label starts with numeric character
                                         
                            O         Invalid opcode

                            S         Syntax error

                            T         Symbol table full                  

                            U         Instruction references an undefined
                                      symbol name

                            V         Value error - a 16 bit  value 

        If  an  error occurs,  Z8E will reprompt the user with  the  same 

                                       35





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        location counter address.
         
        As was mentioned previously the Z8E assmebler uses standard Zilog 

        Z8E  supports the ORG directive which allows the user  to  change it argument of any  type.   After 

        Z8E supports the DEFB,  DEFW,  and DDB directives which give  the 

        The EQU directive allows the user to assign a value to a  symbol.  










                                       36





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        B    Set Breakpoint 
        _________________________________________________________________


        Breakpoints  are  those  addresses at which the  user  wishes  to 
          


             *B ARG1[,pass count] [ARG2... ARGn] <cr>

                  where each argument represents the address in the  user 

        Normally,  that is when no pass count is specifed,  execution  of 

        Pass  counts  are specified by following the  breakpoint  address then entering a pass count immediately following 

        An existing pass count may be changed to a different value by re-
         
        To break on a multi-byte Z80 instruction the address specified as 

        Multiple breakpoints may be set with the same B command by  sepa-

        Z8E  displays  a  question mark when a attempt is made to  set  a 






                                       37





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        C    Clear Breakpoint 
        _________________________________________________________________


        The C command clears individual breakpoints previously set by a B 


                  *C  ARG1 [ARG2...ARGn] <cr>

                       where each arg may be any valid argument type 


        Multiple  breakpoints  may  be cleared by the same C  command  by 

        Z8E  displays a question mark when an attempt is made to clear  a 

        To  clear  ALL  breakpoints enter:   *C *    where  the  asterisk 


































                                       38





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        D    Dump 
        _________________________________________________________________


        The D command allows the user to dump memory in both hexadecimal 
         

                  *D  [ARG1]  [ARG2]  <cr>

                       where    ARG1 =  the starting address to dump
                                
                                ARG2 =  dictates    the    dump    format 

                       ARG1 and ARG2 may be of any argument type.

        If  ARG1  is omitted then the dump resumes from the  last  memory 

        If  ARG2 is omitted then the most recent value of ARG2 (from  the      last D command) is used.
         
        The  dump command displays the contents of memory in  hexadecimal 

        During  a  block by block dump (ARG2 < 256 signifies a  block  by 

        For  non-interactive dumps,  starting address to ending  address, 

        The  dump  command provides an especially easy way  of  examining 





                                       39





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        E    Examine Memory   
        _________________________________________________________________


        The  E  command allows the user to examine and optionally  modify 

             *E   ARG1  <cr>

                       where  ARG1 is the address of the first byte  to 

                       ARG1 may be any symbol type 
        Upon  receipt of ARG1 Z8E will read the contents of the specified 

        If  the  user  wishes to modify memory starting  at  the  current 

             *E 45F9
             45F9  42  B  'This is a string',0D,0A,13,4F,9,'More Text',05
                          ^                                             ^  

                          The user input apprears between the arrows  and 
                            
                          54 68 69 73 20 49 73 20 61 20 73 74 72 69 6E 67 
                          0D 0A 13 4F 09 4D 6F 62 65 20 74 65 78 74 05  

                          These  31  bytes  would be stored  into  memory 

             4618  23  #

        Remember  that  ARGUMENT-STRINGS may be terminated  by  either  a 

                  *E 1002
                  1002  45  E  12,8F,00 <cr>
                  1005  28  (

                                       40





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo



        The user entered an ARGUMENT-STRING 12,8F,00 which was  evaluated 

        By  terminating  the  ARGUMENT-STRING with a space the  user  can 

                  *E 1002
                  1002  45  E  12,8F,00  <space>
                  1002  12  ~

        If the user does not want to write any data to the current memory 

                          CHARACTER                     ACTION
                       
                            space               read next sequential mem-
                            
                          up arrow              read previous memory  ad-
                                                     
                            <cr>                read next sequential mem-


                           period               terminate command                                             

        The  user may also change the current memory address by  entering 

             *E 1344
             1344  89  ~  <cr>
             1345  6F  o  <cr>
             1346  52  R  =9F34 <cr>
             9F34  63  c














                                       41





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


         F    Find 
        _________________________________________________________________


        The  find command allows the user to search memory for multi-byte 

             *F   ARG1  ARG2 <cr>

                  where  ARG1  =  the  starting address at which to begin 
                         
                         ARG2  =  is  an ARGUMENT-STRING representing the 

        Z8E will display every address which contains data matching ARG2.  

        The user may elect to cancel the search at any time by depressing 

        If  ARG2 is a single argument (as opposed to an argument  string) 

        The following are examples of the FIND command:

             *F 0 SYMBOL

             Assuming  that the symbol "SYMBOL" is  associated  with 


             *F 100 87,32#,'ABCD',0C3,symbol,'p',271F

             Assuming  that the symbol "symbol" is  associated  with          

                                       42





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


             the  hex  value 3BF then Z8E would attempt to find  all 

                     87 20 41 42 43 44 C3 03 BF 70 27 1F


             Notice  that Z8E would search for the two byte  pattern 

             The two bytes which represent the address of symbol are 

             Z8E would begin its search at address 100 (ARG1). 






































                                       43





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        G    Go 
        _________________________________________________________________


        The  G command instructs Z8E to begin or resume execution of  the 

                  *G   ARG1  <cr>

                       where      ARG1   =   the  address  of  the  first 
                                             to execute.

                       ARG1 may be any argument type

        Upon  receipt of this command Z8E initializes all breakpoints  in 

        Z8E breakpoint technique has been designed such that Z8E will not  is total-


        HINT:
        When  proceeding from a breakpoint it is simplest to use the form 









                                       44





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        H    Display Symbol Table
        _________________________________________________________________


        The  H  command allows the user to view the symbol table  on  the 

                  *H   [ARG1]  <cr>

                       where ARG1 must be a symbol name


        If  ARG1  is  omitted Z8E will display the  entire  symbol  table 

        If  a  symbol name entered as ARG1 cannot be found in the  symbol 



































                                       45





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        I    Input file
        _________________________________________________________________


        The  I command allows the user to load files into the  TPA  after 

             *I   ARG1[,ARG2]  <cr>

                       ARG1 is a single unambiguous file name  con-
                       
                            - optional  drive  name followed by  a  colon  
                            - mandatory primary file name

                            - optional  secondary file name preceded by a 

                       ARG2 is an optional load address.  If ARG2 is  not 

                       NOTE:  If  no arguments are entered then Z8E  will 


        If Z8E detects a error in the file name specification the message 

        If  Z8E  is unable to locate the file on the specified drive  the 

        Z8E contains no facilties for converting .HEX (Intel Hex  format)  with the CP/M LOAD command and save the file  with  the 

        If  the  file  will  not fit into the TPA,  Z8E  will  print  the 

             Out of memory - Continue?


                                       46





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        If  the  user answers "Y",  Z8E will resume loading the  file  at 

        The  user may occasionally need to overlay a section of code in a 



































                                       47





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        J    Animated Full Screen Debugger
        ________________________________________________________________

        The  J command provides the user with the ability to "see" inside 

                  *J   [/] [*] [ARG1] [ARG2]


                       USE  OF  THE  J  COMMAND FOR  SINGLE  STEPPING  IS 

                       ARG1  is  the starting address of the display  and 

                       The  slash and star control subroutine tracing  as 

                       "/"  Slash  informs  Z8E not to trace any  subrou-
                 
                       "*"  Asterisk informs Z8E not to trace any subrou-  This feature is intended to  screen 
                       
                       ARG2 represents an optional timeout paramter which 

        Once  the J command commences,  Z8E takes over the Z80  and  fur-

                                       48





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        top  two  lines  of the screen along with the contents of  the  F 

        Execution of the user program continues until any non-numeric key 

        The command also terminates whenever a user defined breakpoint is 

        USING THE J COMMAND FOR SINGLE STEPPING

        Z8E  permits  the  user to single-step through  a  program  while 

                  *J   [/]  [*] 

                            / instructs Z8E not to trace any  subroutines 

                            *  instructs Z8E not to trace any subroutines 

                            Note  that  this version of the J command  is 

        This  version allows the user to execute one instruction  in  his he Z8E command  level.   Z8E 

        The / and * options are only valid if the next instruction to  be 



                                       49





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        K    Set Memory Window Parameters for Use With the J Command
        ________________________________________________________________

        The  K  command sets the starting address and block size  of  the 

                  *K  ARG1 [,ARG2]

                  ARG1  represents  the starting address  of  the  memory 

                  ARG2 is an optional size paramter, if omitted the block 

        The  maximum  block size is 144 decimal which  is  90  hex.   The 







































                                       50





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        M    Move Memory 
        _________________________________________________________________


        The  M  command allows the user to move blocks of date  from  any 

                  *M   ARG1  ARG2  ARG3  

                       where   ARG1  =  the   starting  address  of   the 
                               
                               ARG2  =  the  ending address of the source 

                               ARG3  =  the   starting  address  of   the 



        Z8E automatically decides whether a head-to-head or  tail-to-tail 

        On  the other hand,  if a tail-to-tail move is necessary Z8E will 

        A  tail to tail move would be necessary in the following  example 

                  *M  1000 100F 1008















                                       51





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        N    Output to I/O Ports Without Pre-Read
        _________________________________________________________________


        This  command allows the user to output data to an I/O port with-
         format of the command is:

                        *N   [ARG1]

                               where ARG1 is the port number to which the 

                                     If ARG1 is omitted then Z8E uses the 

        Z8E will prompt the user by displaying the current port number on 

                        *N 80
                        80  'T',00,12#,998

                        This  ARGUMENT-STRING would be evaluated into the 

        After the data has been entered and after it has been sent to the 















                                       52





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo



                CARRIAGE    The next sequential port number in  ascending 

                UP ARROW    The next sequential port number in descending 

                 =ARG       Any argument appearing immediately after  the 

                PERIOD      Terminate command


        The  user  can  also monitor an I/O port with the  N  command  by 





































                                       53





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        O    Output Current Breakpoints to Console
        _________________________________________________________________


        The  O command allows the user to view all breakpoints  currently 

                  *O  

                       no arguments are required

        If  Z8E  finds  a symbol name corresponding to the  absolute  hex 

        If  any  pass counts are currently in effect they  are  displayed s with which they are associated.






































                                       54





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        P    Examine/Modify PSW (Flag Register)
        _________________________________________________________________


        The  P  command  provides a convenient method  of  examining  and 

             *P

                  no arguments are required on the command line

        Upon  receipt of the P command Z8E displays the mnemonics corres-


             MNEMONIC            MEANING             BIT STATUS

                P                positive               reset
                M                 minus                  set

                NC               no carry               reset
                C                 carry                  set

                PO              parity odd              reset
                PE              parity even              set

                NZ               not zero               reset
                Z                  zero                  set 


        Z8E  prints  the mnemonic corresponding to the current  state  of 

        If  no mnemonics are entered,  no flags bits are altered and  the 

        If an invalid flag bit mnemonic is entered Z8E prints a  question 













                                       55





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        Q    Query I/O Ports
        _________________________________________________________________

        The  Q  command allows the user flexible access to I/O  ports  by 
         
             *Q   [(] [ARG1] [)]

                       where ARG1 is an 8 bit port address in the range
                       0 - 255

                       ARG1 may be any symbol type,  however if a 16  bit 

                       If  no  argument is given Z8E will  use  the  most 

                       If  ARG1 is enclosed in parentheses Z8E will enter 


        Upon  receipt  of ARG1 Z8E will read the specified I/O  port  and 

                                                                                         

                By  entering  a SPACE immediately  following  the 

                               *Q EE
                               EE   24  $  <space>
                               EE   24  $
                          
                
                By  entering a CARRIAGE RETURN following the dis-

                               *Q EE
                               EE   24  $  <cr>
                               EF   C1  A


                By  entering a caret "^" following the  displayed 

                                       56





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                Z8E  to read the previous port number (descending 

                               *Q EE
                               EE   24  $  ^  (up arrow entered by user)
                               ED   06  ~                       


                By entering an equal sign "=" followed by a valid 

                               *Q EE
                               EE   24  '$'  =90 
                               90   BF  '?'             


             CONTINUOUS INPUT (MONITOR MODE)

                Z8E provides the user with the ability to monitor 
                keyboard exits monitor mode.    

             MULTI-BYTE OUTPUT 

                Following  the  read of an I/O port the user  may 

                        *Q 50
                        50  44  'D' 23,9,'B2E',00,F723,81
                                    ^                   ^
                                    string  as entered by 

                The  data as entered by the user in this  example 
                           23 09 42 32 45 00 F7 23 81

                These  9 bytes would then be sent to port 50  one 







                                       57





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        R    Examine/Modify Register Contents
        _________________________________________________________________


        The  R  command allows the user to examine and optionally  modify 

                  *R   ARG1  <cr> or space

                       where  ARG1  is any of the 22  register  mnemonics 

                             A    B    C    D    E    H    L
                             AF   BC   DE   HL   IX   IY   SP
                             AF'  BC'  DE'  HL'  I    R    P    PC

                            (the  program  counter may  be  specified  as 

        To  examine a register the user enters a mnemonic from the  above ter or register  pair  are  to  be 

        If  the user specifies a 16 bit value as the new contents of an 8 

        The command terminates when a carriage return or space is entered 






















                                       58





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        S    Single Step
        _________________________________________________________________

                                      
        The S command allows the user to execute a program instruction by 

             *S   [/] [ARG1]  <cr>
                       
                       where  ARG1 is the number of instructions to  exe-
                       
                       ARG1 may be of any type

        The slash "/" allows the user control over the tracing of subrou-

                            *S /

                  1000  CD 56 30  RASRTN: CALL  ANYSUB
                  1003  FE 04             CP    4
                  1005  CA 17 10          JP    Z,AHEAD


        will  cause  the  entire  subroutine ANYSUB to  be  executed  and 

        If ARG1 is omitted Z8E will transfer control to the user  program 

        The  user may optionally indicate that more than one  instruction 

        The  single  step command always causes the execution of the  in-

                                       59





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        bled  form  as  part of the output of the  "X"  command  (display  the user desires to single step at 

        Allowing  the  convenience of entering "S" <cr>  to  execute  one 

        During  block  tracing (ARG1 greater than 1) the command  may  be 

        The  S command does not relocate instructions before execution as 



































                                       60





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        U    Write Symbol Table to Disk
        _________________________________________________________________


        The  U command allows the user to write the current symbol  table 

                  
             *U   ARG1

                       ARG1  is the name of the file to which the  symbol 

        This  command is useful to save any symbol names entered  by  the 

        Note  that since the file is stored as a .SYM formatted file  the 

        If  a file with the name ARG1 already exists on disk it  will  be 





























                                       61





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        V    Verify two memory blocks
        _________________________________________________________________


        The  V  command allows the user to compare two blocks of  memory. 

             *V   ARG1  ARG2  ARG3

                  where  ARG1  =  the starting address of memory block 1

                         ARG2  =  the ending address of memory block 1

                         ARG3  =  the starting address of memory block 2

        Z8E compares memory block 1 to memory block 2 byte by byte.  If a 

        The  user may halt the command at any time by depressing any  key 

































                                       62





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        W    write memory to disk
        _________________________________________________________________


        The  W command allows the user to write the contents of memory to 

                  *W  arg1 [arg2  arg3]

                       ARG1  is the name of a file to which writing  will 

                       ARG2 and ARG3 are the optional starting and ending 


        Z8E  always  deletes any file on disk whose name is the  same  as 

        Z8E will echo the starting memory address and continually  update 






























                                       63





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        X    display machine state
        _________________________________________________________________


        The   X  command  displays  the  current  contents  of  all  user 

                  *X   

                       no arguments are required

        Z8E  displays displays all registers,  except the I register  and 

        To inspect the I or R registers use the R command.






































                                       64





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        Y    fill memory
        _________________________________________________________________


        The  Y command fills a user specified block of memory with a user 

                  *Y  ARG1  ARG2  ARG3  <cr>

                       where  ARG1  =  the  starting address of the block 

                              ARG2  =  the ending address of the block to 

                              ARG3  =  is the data pattern to be  written 


        The Y command gives the user the capability to initialize memory 

                  *Y 1000 127C 'abcd',16,77

        Z8E  would  begin writing the 6 byte pattern  (61 62 63 64 16 77) ed  as ARG3 starting at address 1000.   This  pattern  would 

        The command ends after a byte is written to the ARG2 address even 
















                                       65





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        Z    disassemble command
        _________________________________________________________________


        The  Z  command allows the user to disassemble a block  of  data.  

                  *Z  ARG1 [ARG2 ARG3]  <cr>

                       where   ARG1  =   the start address at which disa-

                               ARG2  =   is  optional and represents  the 

                               ARG3  =   is  an optional file name speci-

                       ARG1 may be of any argument type.  

                       ARG2  is  treated in one of two ways depending  on 

                         1) If  ARG2 evaluates to a number between 1  and 

                            
                            Whenever ARG2 equals 1,  either explicitly or 

                         2) If  ARG2 evaluates to a number  greater  than 


                                       66





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


                       the  named file.   If the file is found,  then all 

                       NOTE:  If  ARG3 is present ARG2 must be explicitly 

        Z8E outputs to the console using the following format:

             ADDRESS      OBJECT CODE      LABEL:   OPCODE    OPERAND


        Z8E writes to disk using the following formart:
                                           
                                           LABEL:   OPCODE    OPERAND

        Z8E  disassembles  memory block by block in  the  user  specified 

        Z8E's  disassembler is especially powerful when used in  conjunc-

        If  Z8E cannot match  an operand in the disassembled  instruction 

        If multiple symbols in the symbol table are equal to the same  16 

        Z8E  does not substitute symbol names in those  Z80  instructions 

        Output by Z8E to a disk file is instantly assemblable by most any 

                                       67





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


        assembler which accepts Zilog mnemonics without any modifications 

        When  disassembling a block of memory (starting address to ending 

        Interactive  disassembly allows the user to specify the format of 


            CHARACTER            OUTPUT FORMAT         EXAMPLE

             
                A                 ASCII DEFB          DEFB   'Q'

                B                  HEX DEFB           DEFB   23H    

                C                    CODE             EX     DE,HL

                D                  HEX DEFW           DEFW   02FCH  or    
                                                      DEFW   LABEL

                ;                 add COMMENT         ;This is a Comment     

             carriage           (terminate command)
              return
           
             any other           PROCEED TO THE
             character          NEXT INSTRUCTION     


             ASCII DEFB:
             The  contents of memory at the current disassembly  ad-

             HEX DEFB:
             The 8 bit contents of memory at the current disassembly 

             CODE:
             This  is the normal default for  disassembly.   As  Z8E 


                                       68





        Z8E - Z80 DEBUG MONITOR                              Rick Surwilo


             HEX DEFW:
             The contents of the two bytes of memory starting at the 

             NOTE:
                    If  Z8E had just disassembled  a  multi-

             ADDING COMMENTS
             Z8E  allows  the  user to add one comment per  line  of 


        If  during  disassembly,  Z8E  encounters data  which  cannot  be 


























                                       69





                                   APPENDIX A









        FILE FORMAT FOR
#                       69





                                  